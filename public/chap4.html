<!DOCTYPE html>
<html lang="en">
<head>
    <!-- IMPORTANT: Make sure your text editor saves this file with UTF-8 Encoding! -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moral and Citizenship Education Quiz - Chapter 4</title> <!-- Updated Title -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="email"], input[type="tel"], input[type="password"] { width: 100%; padding: 8px; box-sizing: border-box; }
        input[type="radio"] { margin-right: 5px; }
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; cursor: pointer; margin-right: 10px; border-radius: 5px; }
        button:hover { background-color: #0056b3; }
        .hidden { display: none; }
        #error-message, #password-error, #login-error { color: red; font-size: 1.2em; text-align: center; }
        #success-message { color: green; font-size: 1.2em; text-align: center; }
        #results, #review-section, #submission-copy { margin-top: 20px; text-align: left; border: 1px solid #ccc; padding: 15px; border-radius: 5px; background-color: #f9f9f9;}
        #password-section, #login-section { text-align: center; max-width: 400px; margin: 20px auto; padding: 20px; border: 1px solid #ccc; border-radius: 5px; background-color: #f9f9f9;}
        #password-section input[type="password"], #login-section input[type="text"], #login-section input[type="password"] { width: calc(100% - 18px); }
        .question-result { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        #download-pdf, #download-response { margin-top: 10px; }
        #score { font-weight: bold; text-align: center; color: green; font-size: 1.4em; margin-top: 20px; }
        #review-section h2, #submission-copy h2, #results h1 { margin-bottom: 15px; text-align: center; color: #007bff;}
        #review-section button, #submission-copy button, #password-section button, #login-section button, #results button { margin-top: 15px; }
        .choices p { margin: 2px 0 2px 20px; }
    </style>
</head>
<body>
    <div id="login-section">
        <h1>Login to Access Quiz</h1>
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" placeholder="Enter username" required>
        </div>
        <div class="form-group">
            <label for="login-password">Password:</label>
            <input type="password" id="login-password" placeholder="Enter password" required>
        </div>
        <button onclick="checkLogin()">Login</button>
        <p id="login-error" class="hidden">Incorrect username or password. Please try again.</p>
    </div>

    <div id="quiz-form" class="hidden">
        <h1>Moral and Citizenship Education Quiz - Chapter 4</h1> <!-- Updated Title -->
        <form id="mcie-quiz" method="POST">
            <!-- Student Information -->
            <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="id_number">ID Number:</label>
                <input type="text" id="id_number" name="id_number" required>
            </div>
            <div class="form-group">
                <label for="section">Section:</label>
                <input type="text" id="section" name="section" required>
            </div>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="phone">Phone Number:</label>
                <input type="tel" id="phone" name="phone" required>
            </div>

            <!-- MCIE Multiple-Choice Questions (Chapter 4 SET - 50 Questions) -->
             <div class="form-group">
                 <label>1. The idealist perspective, influenced by Hegel, views the state as:</label>
                 <input type="radio" name="q1" value="A" required> A) An instrument of class oppression.<br>
                 <input type="radio" name="q1" value="B"> B) An ethical community representing universal altruism.<br>
                 <input type="radio" name="q1" value="C"> C) A minimal night watchman.<br>
                 <input type="radio" name="q1" value="D"> D) An actor primarily focused on international relations.
             </div>
             <div class="form-group">
                 <label>2. Functionalist approaches define the state based on its:</label>
                 <input type="radio" name="q2" value="A" required> A) Institutional structure.<br>
                 <input type="radio" name="q2" value="B"> B) Role in maintaining social order.<br>
                 <input type="radio" name="q2" value="C"> C) Historical origins.<br>
                 <input type="radio" name="q2" value="D"> D) Relationship with civil society.
             </div>
             <div class="form-group">
                 <label>3. The organizational view defines the state as:</label>
                 <input type="radio" name="q3" value="A" required> A) A philosophical idea.<br>
                 <input type="radio" name="q3" value="B"> B) The apparatus of government in its broadest sense (public institutions).<br>
                 <input type="radio" name="q3" value="C"> C) The dominant economic class.<br>
                 <input type="radio" name="q3" value="D"> D) A voluntary association of individuals.
             </div>
             <div class="form-group">
                 <label>4. The international approach primarily views the state as:</label>
                 <input type="radio" name="q4" value="A" required> A) A collection of bureaucratic institutions.<br>
                 <input type="radio" name="q4" value="B"> B) A reflection of social class structures.<br>
                 <input type="radio" name="q4" value="C"> C) An actor on the world stage.<br>
                 <input type="radio" name="q4" value="D"> D) A provider of social welfare.
             </div>
             <div class="form-group">
                 <label>5. According to the Montevideo Convention (1933), which is NOT one of the four essential features of a state?</label>
                 <input type="radio" name="q5" value="A" required> A) A defined territory<br>
                 <input type="radio" name="q5" value="B"> B) A permanent population<br>
                 <input type="radio" name="q5" value="C"> C) An effective government<br>
                 <input type="radio" name="q5" value="D"> D) A recognized national currency
             </div>
             <div class="form-group">
                 <label>6. The highest power of the state, distinguishing it from other associations and involving internal and external aspects, is known as:</label>
                 <input type="radio" name="q6" value="A" required> A) Legitimacy<br>
                 <input type="radio" name="q6" value="B"> B) Authority<br>
                 <input type="radio" name="q6" value="C"> C) Sovereignty<br>
                 <input type="radio" name="q6" value="D"> D) Government
             </div>
             <div class="form-group">
                 <label>7. The attribute considered by contemporary theorists as the fifth essential feature for a state to possess an 'international personality' is:</label>
                 <input type="radio" name="q7" value="A" required> A) A large military<br>
                 <input type="radio" name="q7" value="B"> B) Economic self-sufficiency<br>
                 <input type="radio" name="q7" value="C"> C) Recognition by other states<br>
                 <input type="radio" name="q7" value="D"> D) A homogeneous population
             </div>
             <div class="form-group">
                 <label>8. The Pluralist theory views the state primarily as:</label>
                 <input type="radio" name="q8" value="A" required> A) An instrument of the dominant class.<br>
                 <input type="radio" name="q8" value="B"> B) A self-serving 'leviathan'.<br>
                 <input type="radio" name="q8" value="C"> C) A neutral arbiter or 'umpire' among competing interests.<br>
                 <input type="radio" name="q8" value="D"> D) A patriarchal institution.
             </div>
             <div class="form-group">
                 <label>9. Neo-pluralists, like Dahl and Lindblom, acknowledged that which group enjoys a 'privileged position' in influencing the state?</label>
                 <input type="radio" name="q9" value="A" required> A) Trade unions<br>
                 <input type="radio" name="q9" value="B"> B) Environmental groups<br>
                 <input type="radio" name="q9" value="C"> C) Business<br>
                 <input type="radio" name="q9" value="D"> D) Academia
             </div>
             <div class="form-group">
                 <label>10. Marxist theory traditionally views the state in capitalist societies as:</label>
                 <input type="radio" name="q10" value="A" required> A) A neutral referee.<br>
                 <input type="radio" name="q10" value="B"> B) An instrument for managing the affairs of the bourgeoisie.<br>
                 <input type="radio" name="q10" value="C"> C) A product of voluntary social contract.<br>
                 <input type="radio" name="q10" value="D"> D) An entity pursuing its own bureaucratic interests separate from class.
             </div>
             <div class="form-group">
                 <label>11. Marx's concept of 'relative autonomy' suggests the state can:</label>
                 <input type="radio" name="q11" value="A" required> A) Always act independently of the economic base.<br>
                 <input type="radio" name="q11" value="B"> B) Sometimes mediate between classes while ultimately preserving the system.<br>
                 <input type="radio" name="q11" value="C"> C) Only ever serve the interests of the proletariat.<br>
                 <input type="radio" name="q11" value="D"> D) Be completely neutral in class conflicts.
             </div>
             <div class="form-group">
                 <label>12. Gramsci's concept of 'hegemony' emphasizes ruling class domination through:</label>
                 <input type="radio" name="q12" value="A" required> A) Solely open coercion and force.<br>
                 <input type="radio" name="q12" value="B"> B) Economic control exclusively.<br>
                 <input type="radio" name="q12" value="C"> C) Ideological manipulation and cultural leadership.<br>
                 <input type="radio" name="q12" value="D"> D) Electoral fraud.
             </div>
             <div class="form-group">
                 <label>13. The 'Leviathan state' perspective, associated with the New Right, views the state as:</label>
                 <input type="radio" name="q13" value="A" required> A) A necessary evil for maintaining order.<br>
                 <input type="radio" name="q13" value="B"> B) A neutral facilitator of individual goals.<br>
                 <input type="radio" name="q13" value="C"> C) A parasitic entity prone to expansion and interference.<br>
                 <input type="radio" name="q13" value="D"> D) An instrument of social justice.
             </div>
             <div class="form-group">
                 <label>14. Public-choice theorists often explain state expansion (the 'oversupply thesis') by arguing that:</label>
                 <input type="radio" name="q14" value="A" required> A) Citizens demand ever-increasing services.<br>
                 <input type="radio" name="q14" value="B"> B) Bureaucrats and politicians act in their own rationally self-interested ways to expand their power/budgets.<br>
                 <input type="radio" name="q14" value="C"> C) International pressures force states to grow.<br>
                 <input type="radio" name="q14" value="D"> D) The common good requires a larger state.
             </div>
             <div class="form-group">
                 <label>15. Radical feminist theory often views the state as:</label>
                 <input type="radio" name="q15" value="A" required> A) A neutral entity capable of reform towards gender equality.<br>
                 <input type="radio" name="q15" value="B"> B) An instrument reflecting and upholding patriarchy.<br>
                 <input type="radio" name="q15" value="C"> C) Primarily concerned with economic class struggle.<br>
                 <input type="radio" name="q15" value="D"> D) A minimal protector of individual rights.
             </div>
             <div class="form-group">
                 <label>16. A 'minimal state' (night watchman state) primarily performs which functions?</label>
                 <input type="radio" name="q16" value="A" required> A) Economic planning and wealth redistribution.<br>
                 <input type="radio" name="q16" value="B"> B) Maintaining domestic order, enforcing contracts, and external defense.<br>
                 <input type="radio" name="q16" value="C"> C) Providing comprehensive social welfare and education.<br>
                 <input type="radio" name="q16" value="D"> D) Controlling culture and ideology.
             </div>
             <div class="form-group">
                 <label>17. A 'developmental state' is characterized by:</label>
                 <input type="radio" name="q17" value="A" required> A) Minimal intervention in the economy.<br>
                 <input type="radio" name="q17" value="B"> B) State intervention specifically aimed at promoting industrial growth and economic development.<br>
                 <input type="radio" name="q17" value="C"> C) Complete state control over all means of production.<br>
                 <input type="radio" name="q17" value="D"> D) Prioritizing social welfare over economic growth.
             </div>
             <div class="form-group">
                 <label>18. Social-democratic states typically prioritize:</label>
                 <input type="radio" name="q18" value="A" required> A) Abolishing private property.<br>
                 <input type="radio" name="q18" value="B"> B) Minimal government intervention.<br>
                 <input type="radio" name="q18" value="C"> C) Rectifying market injustices and promoting social welfare (fairness, equality).<br>
                 <input type="radio" name="q18" value="D"> D) National security above all else.
             </div>
             <div class="form-group">
                 <label>19. 'Collectivized states', like the former USSR, aimed to:</label>
                 <input type="radio" name="q19" value="A" required> A) Create a partnership between state and private enterprise.<br>
                 <input type="radio" name="q19" value="B"> B) Minimize the role of the state in the economy.<br>
                 <input type="radio" name="q19" value="C"> C) Bring the entire economy under state control through central planning.<br>
                 <input type="radio" name="q19" value="D"> D) Focus primarily on religious doctrines.
             </div>
             <div class="form-group">
                 <label>20. Totalitarian states are distinguished by:</label>
                 <input type="radio" name="q20" value="A" required> A) A limited government respecting a private sphere.<br>
                 <input type="radio" name="q20" value="B"> B) An all-embracing state controlling nearly every aspect of life.<br>
                 <input type="radio" name="q20" value="C"> C) A focus on free-market principles.<br>
                 <input type="radio" name="q20" value="D"> D) Power being dispersed among many groups.
             </div>
             <div class="form-group">
                 <label>21. Religious states, driven by fundamentalism, often challenge the principle of:</label>
                 <input type="radio" name="q21" value="A" required> A) National sovereignty.<br>
                 <input type="radio" name="q21" value="B"> B) Economic development.<br>
                 <input type="radio" name="q21" value="C"> C) Separation of church/religion and state (the public/private divide).<br>
                 <input type="radio" name="q21" value="D"> D) Military preparedness.
             </div>
             <div class="form-group">
                 <label>22. Government, in the context of the state, refers to:</label>
                 <input type="radio" name="q22" value="A" required> A) The entire population of a country.<br>
                 <input type="radio" name="q22" value="B"> B) The territory controlled by the state.<br>
                 <input type="radio" name="q22" value="C"> C) The machinery or institutions that administer the state and make/enforce decisions.<br>
                 <input type="radio" name="q22" value="D"> D) The concept of sovereignty.
             </div>
             <div class="form-group">
                 <label>23. Authority is best defined as:</label>
                 <input type="radio" name="q23" value="A" required> A) Raw physical power.<br>
                 <input type="radio" name="q23" value="B"> B) The ability to influence others.<br>
                 <input type="radio" name="q23" value="C"> C) Legitimate power (the right to rule).<br>
                 <input type="radio" name="q23" value="D"> D) Popularity among citizens.
             </div>
             <div class="form-group">
                 <label>24. Legitimacy refers to:</label>
                 <input type="radio" name="q24" value="A" required> A) The effectiveness of government policies.<br>
                 <input type="radio" name="q24" value="B"> B) The military strength of a state.<br>
                 <input type="radio" name="q24" value="C"> C) The rightfulness of a government's rule, leading to acknowledged authority.<br>
                 <input type="radio" name="q24" value="D"> D) The amount of wealth a government controls.
             </div>
             <div class="form-group">
                 <label>25. Which of the following is listed as a primary purpose/function of government?</label>
                 <input type="radio" name="q25" value="A" required> A) Maximizing profits for corporations.<br>
                 <input type="radio" name="q25" value="B"> B) Self-preservation (maintaining order and defense).<br>
                 <input type="radio" name="q25" value="C"> C) Promoting a single religious doctrine.<br>
                 <input type="radio" name="q25" value="D"> D) Eliminating all forms of private property.
             </div>
             <div class="form-group">
                 <label>26. Citizenship, at a formal level, denotes:</label>
                 <input type="radio" name="q26" value="A" required> A) A feeling of patriotism.<br>
                 <input type="radio" name="q26" value="B"> B) Active political participation.<br>
                 <input type="radio" name="q26" value="C"> C) The network of legal relationships and rules between the state and the individual.<br>
                 <input type="radio" name="q26" value="D"> D) A shared cultural identity.
             </div>
             <div class="form-group">
                 <label>27. T.H. Marshall identified which three types of citizenship rights evolving historically?</label>
                 <input type="radio" name="q27" value="A" required> A) Natural, legal, social<br>
                 <input type="radio" name="q27" value="B"> B) Civil, political, social<br>
                 <input type="radio" name="q27" value="C"> C) Economic, cultural, environmental<br>
                 <input type="radio" name="q27" value="D"> D) Individual, group, state
             </div>
             <div class="form-group">
                 <label>28. According to Hohfeld, a 'Liberty Right' (privilege) implies:</label>
                 <input type="radio" name="q28" value="A" required> A) A duty on others to provide something.<br>
                 <input type="radio" name="q28" value="B"> B) A freedom for the right-holder to act without obligation on others to aid.<br>
                 <input type="radio" name="q28" value="C"> C) The power to change others' rights.<br>
                 <input type="radio" name="q28" value="D"> D) Protection from others changing one's rights.
             </div>
             <div class="form-group">
                 <label>29. A 'Claim Right' implies:</label>
                 <input type="radio" name="q29" value="A" required> A) Only freedom for the holder.<br>
                 <input type="radio" name="q29" value="B"> B) A corresponding duty on another party.<br>
                 <input type="radio" name="q29" value="C"> C) The ability to alter primary rules.<br>
                 <input type="radio" name="q29" value="D"> D) Immunity from legal process.
             </div>
             <div class="form-group">
                 <label>30. The Hohfeldian incident allowing a right-holder to alter their own or others' legal entitlements is a:</label>
                 <input type="radio" name="q30" value="A" required> A) Liberty Right<br>
                 <input type="radio" name="q30" value="B"> B) Claim Right<br>
                 <input type="radio" name="q30" value="C"> C) Power Right<br>
                 <input type="radio" name="q30" value="D"> D) Immunity Right
             </div>
             <div class="form-group">
                 <label>31. An 'Immunity Right' protects the holder from:</label>
                 <input type="radio" name="q31" value="A" required> A) Having duties imposed.<br>
                 <input type="radio" name="q31" value="B"> B) Others having the power to alter their normative situation.<br>
                 <input type="radio" name="q31" value="C"> C) Needing to participate in politics.<br>
                 <input type="radio" name="q31" value="D"> D) Economic hardship.
             </div>
             <div class="form-group">
                 <label>32. A minimalist approach to citizenship emphasizes:</label>
                 <input type="radio" name="q32" value="A" required> A) Active, broad participation in state affairs.<br>
                 <input type="radio" name="q32" value="B"> B) Basic passive compliance with laws.<br>
                 <input type="radio" name="q32" value="C"> C) Strong group identity over individual rights.<br>
                 <input type="radio" name="q32" value="D"> D) Constant engagement in protest.
             </div>
             <div class="form-group">
                 <label>33. The concept of "corporate citizenship" relates ideas of rights and responsibilities to:</label>
                 <input type="radio" name="q33" value="A" required> A) Individual persons only.<br>
                 <input type="radio" name="q33" value="B"> B) Government institutions.<br>
                 <input type="radio" name="q33" value="C"> C) Corporations and businesses.<br>
                 <input type="radio" name="q33" value="D"> D) Non-governmental organizations.
             </div>
             <div class="form-group">
                 <label>34. Liberal citizenship theory places primary emphasis on:</label>
                 <input type="radio" name="q34" value="A" required> A) The community and shared values.<br>
                 <input type="radio" name="q34" value="B"> B) The individual person and their rights/liberty.<br>
                 <input type="radio" name="q34" value="C"> C) Civic virtue and participation.<br>
                 <input type="radio" name="q34" value="D"> D) Group rights based on culture.
             </div>
             <div class="form-group">
                 <label>35. A major criticism of liberal citizenship is its potential neglect of:</label>
                 <input type="radio" name="q35" value="A" required> A) Individual freedom.<br>
                 <input type="radio" name="q35" value="B"> B) The importance of community and social context in shaping individuals.<br>
                 <input type="radio" name="q35" value="C"> C) Property rights.<br>
                 <input type="radio" name="q35" value="D"> D) Due process.
             </div>
             <div class="form-group">
                 <label>36. Communitarian citizenship theory emphasizes:</label>
                 <input type="radio" name="q36" value="A" required> A) The autonomous individual as the starting point.<br>
                 <input type="radio" name="q36" value="B"> B) That individual identity is deeply shaped by community membership and shared good.<br>
                 <input type="radio" name="q36" value="C"> C) Universal, abstract rights over local traditions.<br>
                 <input type="radio" name="q36" value="D"> D) A minimal role for the state.
             </div>
             <div class="form-group">
                 <label>37. Republican citizenship thought stresses the importance of:</label>
                 <input type="radio" name="q37" value="A" required> A) Individual self-interest above all.<br>
                 <input type="radio" name="q37" value="B"> B) Passive acceptance of state authority.<br>
                 <input type="radio" name="q37" value="C"> C) Active participation, civic virtue, and commitment to the common good.<br>
                 <input type="radio" name="q37" value="D"> D) Cultural group rights.
             </div>
             <div class="form-group">
                 <label>38. Multicultural citizenship advocates for:</label>
                 <input type="radio" name="q38" value="A" required> A) A single, homogeneous national culture.<br>
                 <input type="radio" name="q38" value="B"> B) Ignoring group differences in favor of universal individual rights only.<br>
                 <input type="radio" name="q38" value="C"> C) Recognizing group differences and potentially granting differentiated rights.<br>
                 <input type="radio" name="q38" value="D"> D) Prioritizing the majority culture.
             </div>
             <div class="form-group">
                 <label>39. Acquiring citizenship based on being born within a state's territory is the principle of:</label>
                 <input type="radio" name="q39" value="A" required> A) Jus Sanguinis<br>
                 <input type="radio" name="q39" value="B"> B) Jus Soli<br>
                 <input type="radio" name="q39" value="C"> C) Naturalization<br>
                 <input type="radio" name="q39" value="D"> D) Recognition
             </div>
             <div class="form-group">
                 <label>40. Acquiring citizenship based on the citizenship of one's parents is the principle of:</label>
                 <input type="radio" name="q40" value="A" required> A) Jus Soli<br>
                 <input type="radio" name="q40" value="B"> B) Jus Sanguinis<br>
                 <input type="radio" name="q40" value="C"> C) Territoriality<br>
                 <input type="radio" name="q40" value="D"> D) Grant on application
             </div>
             <div class="form-group">
                 <label>41. The legal process by which a foreigner becomes a citizen is called:</label>
                 <input type="radio" name="q41" value="A" required> A) Jus Soli<br>
                 <input type="radio" name="q41" value="B"> B) Jus Sanguinis<br>
                 <input type="radio" name="q41" value="C"> C) Naturalization<br>
                 <input type="radio" name="q41" value="D"> D) Deprivation
             </div>
             <div class="form-group">
                 <label>42. According to the 2003 Ethiopian Nationality Proclamation, Ethiopian citizenship at birth is primarily based on:</label>
                 <input type="radio" name="q42" value="A" required> A) Jus Soli (being born in Ethiopia)<br>
                 <input type="radio" name="q42" value="B"> B) Jus Sanguinis (descent from an Ethiopian parent)<br>
                 <input type="radio" name="q42" value="C"> C) Marriage to an Ethiopian<br>
                 <input type="radio" name="q42" value="D"> D) Adoption by an Ethiopian
             </div>
             <div class="form-group">
                 <label>43. Granting citizenship to an alien based on meeting requirements like residency, age, and income is acquisition by:</label>
                 <input type="radio" name="q43" value="A" required> A) Descent<br>
                 <input type="radio" name="q43" value="B"> B) Marriage<br>
                 <input type="radio" name="q43" value="C"> C) Adoption<br>
                 <input type="radio" name="q43" value="D"> D) Application (registration)
             </div>
             <div class="form-group">
                 <label>44. Does the 2003 Ethiopian Nationality Proclamation generally permit Ethiopian nationals to hold dual citizenship?</label>
                 <input type="radio" name="q44" value="A" required> A) Yes, explicitly.<br>
                 <input type="radio" name="q44" value="B"> B) Yes, under special circumstances only.<br>
                 <input type="radio" name="q44" value="C"> C) No, voluntary acquisition of another nationality implies renunciation of Ethiopian nationality.<br>
                 <input type="radio" name="q44" value="D"> D) No, but only for those born outside Ethiopia.
             </div>
             <div class="form-group">
                 <label>45. The voluntary act of giving up one's citizenship is known as:</label>
                 <input type="radio" name="q45" value="A" required> A) Deprivation<br>
                 <input type="radio" name="q45" value="B"> B) Lapse<br>
                 <input type="radio" name="q45" value="C"> C) Renunciation<br>
                 <input type="radio" name="q45" value="D"> D) Substitution
             </div>
             <div class="form-group">
                 <label>46. An involuntary loss of citizenship initiated by government authorities is:</label>
                 <input type="radio" name="q46" value="A" required> A) Renunciation<br>
                 <input type="radio" name="q46" value="B"> B) Lapse<br>
                 <input type="radio" name="q46" value="C"> C) Deprivation<br>
                 <input type="radio" name="q46" value="D"> D) Adoption
             </div>
             <div class="form-group">
                 <label>47. The condition of having no citizenship in any country is called:</label>
                 <input type="radio" name="q47" value="A" required> A) Dual Citizenship<br>
                 <input type="radio" name="q47" value="B"> B) Naturalization<br>
                 <input type="radio" name="q47" value="C"> C) Statelessness<br>
                 <input type="radio" name="q47" value="D"> D) Alienage
             </div>
             <div class="form-group">
                 <label>48. Liberal theory's emphasis on individual choice potentially leads to which problem concerning shared resources?</label>
                 <input type="radio" name="q48" value="A" required> A) State over-regulation<br>
                 <input type="radio" name="q48" value="B"> B) Tragedy of the commons / Free-riding<br>
                 <input type="radio" name="q48" value="C"> C) Excessive civic participation<br>
                 <input type="radio" name="q48" value="D"> D) Strong community bonds
             </div>
             <div class="form-group">
                 <label>49. Which citizenship theory most strongly suggests that the "self" is socially embedded and defined by its community?</label>
                 <input type="radio" name="q49" value="A" required> A) Liberalism<br>
                 <input type="radio" name="q49" value="B"> B) Republicanism<br>
                 <input type="radio" name="q49" value="C"> C) Communitarianism<br>
                 <input type="radio" name="q49" value="D"> D) Multiculturalism
             </div>
             <div class="form-group">
                 <label>50. A state intervening to provide affordable health care and effective public safety aligns most closely with the principles of the:</label>
                 <input type="radio" name="q50" value="A" required> A) Minimal State<br>
                 <input type="radio" name="q50" value="B"> B) Rights Approach<br>
                 <input type="radio" name="q50" value="C"> C) Common Good Approach<br>
                 <input type="radio" name="q50" value="D"> D) Leviathan State
             </div>
            <!-- End of Chapter 4 Questions -->

            <button type="button" onclick="showReview()">Submit</button>
        </form>
        <div id="error-message" class="hidden">
            <p>Something went wrong. Please try again.</p>
        </div>
    </div>

    <div id="review-section" class="hidden">
        <h2>Review Your Answers</h2>
        <div id="review-content"></div>
        <button onclick="editForm()">Edit</button>
        <button onclick="downloadResponse()" id="download-response">Download My Response</button>
        <button onclick="confirmSubmission()">Confirm Submission</button>
    </div>

    <div id="submission-copy" class="hidden">
        <h2>Your Submitted Answers (Chapter 4)</h2> <!-- Updated Title -->
        <div id="submission-content"></div>
        <button onclick="proceedToPassword()">Proceed</button>
    </div>

    <div id="password-section" class="hidden">
        <h1 id="success-message">Your response has been submitted</h1>
        <p>You can view your result (score) by entering the password.</p>
        <input type="password" id="password" placeholder="Enter password">
        <button onclick="checkPassword()">Submit</button>
        <p id="password-error" class="hidden">Incorrect password. Please try again.</p>
    </div>

    <div id="results" class="hidden">
        <h1>Quiz Results - Chapter 4</h1> <!-- Updated Title -->
        <p id="student-info"></p>
        <div id="answers"></div>
        <p id="score"></p>
        <button id="download-pdf" onclick="downloadPDF()">Download Results PDF</button>
    </div>

    <script>
        let quizData = null;
        let formData = null;
        const { jsPDF } = window.jspdf;
        const TOTAL_QUESTIONS = 50; // *** UPDATED: Back to 50 questions ***

        // Valid login credentials
        const validCredentials = [
            { username: 'section19', password: '123' },
            { username: 'section20', password: '123' },
            { username: 'muzemuza', password: 'moh' },
            { username: 'section21', password: '123' }
        ];

        // *** UPDATED: Structure holding question texts and choices (CHAPTER 4 SET) ***
        const allQuestionsData = {
             q1: { text: 'The idealist perspective, influenced by Hegel, views the state as:', choices: { A: 'An instrument of class oppression.', B: 'An ethical community representing universal altruism.', C: 'A minimal night watchman.', D: 'An actor primarily focused on international relations.' } },
             q2: { text: 'Functionalist approaches define the state based on its:', choices: { A: 'Institutional structure.', B: 'Role in maintaining social order.', C: 'Historical origins.', D: 'Relationship with civil society.' } },
             q3: { text: 'The organizational view defines the state as:', choices: { A: 'A philosophical idea.', B: 'The apparatus of government in its broadest sense (public institutions).', C: 'The dominant economic class.', D: 'A voluntary association of individuals.' } },
             q4: { text: 'The international approach primarily views the state as:', choices: { A: 'A collection of bureaucratic institutions.', B: 'A reflection of social class structures.', C: 'An actor on the world stage.', D: 'A provider of social welfare.' } },
             q5: { text: 'According to the Montevideo Convention (1933), which is NOT one of the four essential features of a state?', choices: { A: 'A defined territory', B: 'A permanent population', C: 'An effective government', D: 'A recognized national currency' } },
             q6: { text: 'The highest power of the state, distinguishing it from other associations and involving internal and external aspects, is known as:', choices: { A: 'Legitimacy', B: 'Authority', C: 'Sovereignty', D: 'Government' } },
             q7: { text: 'The attribute considered by contemporary theorists as the fifth essential feature for a state to possess an \'international personality\' is:', choices: { A: 'A large military', B: 'Economic self-sufficiency', C: 'Recognition by other states', D: 'A homogeneous population' } },
             q8: { text: 'The Pluralist theory views the state primarily as:', choices: { A: 'An instrument of the dominant class.', B: 'A self-serving \'leviathan\'.', C: 'A neutral arbiter or \'umpire\' among competing interests.', D: 'A patriarchal institution.' } },
             q9: { text: 'Neo-pluralists, like Dahl and Lindblom, acknowledged that which group enjoys a \'privileged position\' in influencing the state?', choices: { A: 'Trade unions', B: 'Environmental groups', C: 'Business', D: 'Academia' } },
             q10: { text: 'Marxist theory traditionally views the state in capitalist societies as:', choices: { A: 'A neutral referee.', B: 'An instrument for managing the affairs of the bourgeoisie.', C: 'A product of voluntary social contract.', D: 'An entity pursuing its own bureaucratic interests separate from class.' } },
             q11: { text: 'Marx\'s concept of \'relative autonomy\' suggests the state can:', choices: { A: 'Always act independently of the economic base.', B: 'Sometimes mediate between classes while ultimately preserving the system.', C: 'Only ever serve the interests of the proletariat.', D: 'Be completely neutral in class conflicts.' } },
             q12: { text: 'Gramsci\'s concept of \'hegemony\' emphasizes ruling class domination through:', choices: { A: 'Solely open coercion and force.', B: 'Economic control exclusively.', C: 'Ideological manipulation and cultural leadership.', D: 'Electoral fraud.' } },
             q13: { text: 'The \'Leviathan state\' perspective, associated with the New Right, views the state as:', choices: { A: 'A necessary evil for maintaining order.', B: 'A neutral facilitator of individual goals.', C: 'A parasitic entity prone to expansion and interference.', D: 'An instrument of social justice.' } },
             q14: { text: 'Public-choice theorists often explain state expansion (the \'oversupply thesis\') by arguing that:', choices: { A: 'Citizens demand ever-increasing services.', B: 'Bureaucrats and politicians act in their own rationally self-interested ways to expand their power/budgets.', C: 'International pressures force states to grow.', D: 'The common good requires a larger state.' } },
             q15: { text: 'Radical feminist theory often views the state as:', choices: { A: 'A neutral entity capable of reform towards gender equality.', B: 'An instrument reflecting and upholding patriarchy.', C: 'Primarily concerned with economic class struggle.', D: 'A minimal protector of individual rights.' } },
             q16: { text: 'A \'minimal state\' (night watchman state) primarily performs which functions?', choices: { A: 'Economic planning and wealth redistribution.', B: 'Maintaining domestic order, enforcing contracts, and external defense.', C: 'Providing comprehensive social welfare and education.', D: 'Controlling culture and ideology.' } },
             q17: { text: 'A \'developmental state\' is characterized by:', choices: { A: 'Minimal intervention in the economy.', B: 'State intervention specifically aimed at promoting industrial growth and economic development.', C: 'Complete state control over all means of production.', D: 'Prioritizing social welfare over economic growth.' } },
             q18: { text: 'Social-democratic states typically prioritize:', choices: { A: 'Abolishing private property.', B: 'Minimal government intervention.', C: 'Rectifying market injustices and promoting social welfare (fairness, equality).', D: 'National security above all else.' } },
             q19: { text: '\'Collectivized states\', like the former USSR, aimed to:', choices: { A: 'Create a partnership between state and private enterprise.', B: 'Minimize the role of the state in the economy.', C: 'Bring the entire economy under state control through central planning.', D: 'Focus primarily on religious doctrines.' } },
             q20: { text: 'Totalitarian states are distinguished by:', choices: { A: 'A limited government respecting a private sphere.', B: 'An all-embracing state controlling nearly every aspect of life.', C: 'A focus on free-market principles.', D: 'Power being dispersed among many groups.' } },
             q21: { text: 'Religious states, driven by fundamentalism, often challenge the principle of:', choices: { A: 'National sovereignty.', B: 'Economic development.', C: 'Separation of church/religion and state (the public/private divide).', D: 'Military preparedness.' } },
             q22: { text: 'Government, in the context of the state, refers to:', choices: { A: 'The entire population of a country.', B: 'The territory controlled by the state.', C: 'The machinery or institutions that administer the state and make/enforce decisions.', D: 'The concept of sovereignty.' } },
             q23: { text: 'Authority is best defined as:', choices: { A: 'Raw physical power.', B: 'The ability to influence others.', C: 'Legitimate power (the right to rule).', D: 'Popularity among citizens.' } },
             q24: { text: 'Legitimacy refers to:', choices: { A: 'The effectiveness of government policies.', B: 'The military strength of a state.', C: 'The rightfulness of a government\'s rule, leading to acknowledged authority.', D: 'The amount of wealth a government controls.' } },
             q25: { text: 'Which of the following is listed as a primary purpose/function of government?', choices: { A: 'Maximizing profits for corporations.', B: 'Self-preservation (maintaining order and defense).', C: 'Promoting a single religious doctrine.', D: 'Eliminating all forms of private property.' } },
             q26: { text: 'Citizenship, at a formal level, denotes:', choices: { A: 'A feeling of patriotism.', B: 'Active political participation.', C: 'The network of legal relationships and rules between the state and the individual.', D: 'A shared cultural identity.' } },
             q27: { text: 'T.H. Marshall identified which three types of citizenship rights evolving historically?', choices: { A: 'Natural, legal, social', B: 'Civil, political, social', C: 'Economic, cultural, environmental', D: 'Individual, group, state' } },
             q28: { text: 'According to Hohfeld, a \'Liberty Right\' (privilege) implies:', choices: { A: 'A duty on others to provide something.', B: 'A freedom for the right-holder to act without obligation on others to aid.', C: 'The power to change others\' rights.', D: 'Protection from others changing one\'s rights.' } },
             q29: { text: 'A \'Claim Right\' implies:', choices: { A: 'Only freedom for the holder.', B: 'A corresponding duty on another party.', C: 'The ability to alter primary rules.', D: 'Immunity from legal process.' } },
             q30: { text: 'The Hohfeldian incident allowing a right-holder to alter their own or others\' legal entitlements is a:', choices: { A: 'Liberty Right', B: 'Claim Right', C: 'Power Right', D: 'Immunity Right' } },
             q31: { text: 'An \'Immunity Right\' protects the holder from:', choices: { A: 'Having duties imposed.', B: 'Others having the power to alter their normative situation.', C: 'Needing to participate in politics.', D: 'Economic hardship.' } },
             q32: { text: 'A minimalist approach to citizenship emphasizes:', choices: { A: 'Active, broad participation in state affairs.', B: 'Basic passive compliance with laws.', C: 'Strong group identity over individual rights.', D: 'Constant engagement in protest.' } },
             q33: { text: 'The concept of "corporate citizenship" relates ideas of rights and responsibilities to:', choices: { A: 'Individual persons only.', B: 'Government institutions.', C: 'Corporations and businesses.', D: 'Non-governmental organizations.' } },
             q34: { text: 'Liberal citizenship theory places primary emphasis on:', choices: { A: 'The community and shared values.', B: 'The individual person and their rights/liberty.', C: 'Civic virtue and participation.', D: 'Group rights based on culture.' } },
             q35: { text: 'A major criticism of liberal citizenship is its potential neglect of:', choices: { A: 'Individual freedom.', B: 'The importance of community and social context in shaping individuals.', C: 'Property rights.', D: 'Due process.' } },
             q36: { text: 'Communitarian citizenship theory emphasizes:', choices: { A: 'The autonomous individual as the starting point.', B: 'That individual identity is deeply shaped by community membership and shared good.', C: 'Universal, abstract rights over local traditions.', D: 'A minimal role for the state.' } },
             q37: { text: 'Republican citizenship thought stresses the importance of:', choices: { A: 'Individual self-interest above all.', B: 'Passive acceptance of state authority.', C: 'Active participation, civic virtue, and commitment to the common good.', D: 'Cultural group rights.' } },
             q38: { text: 'Multicultural citizenship advocates for:', choices: { A: 'A single, homogeneous national culture.', B: 'Ignoring group differences in favor of universal individual rights only.', C: 'Recognizing group differences and potentially granting differentiated rights.', D: 'Prioritizing the majority culture.' } },
             q39: { text: 'Acquiring citizenship based on being born within a state\'s territory is the principle of:', choices: { A: 'Jus Sanguinis', B: 'Jus Soli', C: 'Naturalization', D: 'Recognition' } },
             q40: { text: 'Acquiring citizenship based on the citizenship of one\'s parents is the principle of:', choices: { A: 'Jus Soli', B: 'Jus Sanguinis', C: 'Territoriality', D: 'Grant on application' } },
             q41: { text: 'The legal process by which a foreigner becomes a citizen is called:', choices: { A: 'Jus Soli', B: 'Jus Sanguinis', C: 'Naturalization', D: 'Deprivation' } },
             q42: { text: 'According to the 2003 Ethiopian Nationality Proclamation, Ethiopian citizenship at birth is primarily based on:', choices: { A: 'Jus Soli (being born in Ethiopia)', B: 'Jus Sanguinis (descent from an Ethiopian parent)', C: 'Marriage to an Ethiopian', D: 'Adoption by an Ethiopian' } },
             q43: { text: 'Granting citizenship to an alien based on meeting requirements like residency, age, and income is acquisition by:', choices: { A: 'Descent', B: 'Marriage', C: 'Adoption', D: 'Application (registration)' } },
             q44: { text: 'Does the 2003 Ethiopian Nationality Proclamation generally permit Ethiopian nationals to hold dual citizenship?', choices: { A: 'Yes, explicitly.', B: 'Yes, under special circumstances only.', C: 'No, voluntary acquisition of another nationality implies renunciation of Ethiopian nationality.', D: 'No, but only for those born outside Ethiopia.' } },
             q45: { text: 'The voluntary act of giving up one\'s citizenship is known as:', choices: { A: 'Deprivation', B: 'Lapse', C: 'Renunciation', D: 'Substitution' } },
             q46: { text: 'An involuntary loss of citizenship initiated by government authorities is:', choices: { A: 'Renunciation', B: 'Lapse', C: 'Deprivation', D: 'Adoption' } },
             q47: { text: 'The condition of having no citizenship in any country is called:', choices: { A: 'Dual Citizenship', B: 'Naturalization', C: 'Statelessness', D: 'Alienage' } },
             q48: { text: 'Liberal theory\'s emphasis on individual choice potentially leads to which problem concerning shared resources?', choices: { A: 'State over-regulation', B: 'Tragedy of the commons / Free-riding', C: 'Excessive civic participation', D: 'Strong community bonds' } },
             q49: { text: 'Which citizenship theory most strongly suggests that the "self" is socially embedded and defined by its community?', choices: { A: 'Liberalism', B: 'Republicanism', C: 'Communitarianism', D: 'Multiculturalism' } },
             q50: { text: 'A state intervening to provide affordable health care and effective public safety aligns most closely with the principles of the:', choices: { A: 'Minimal State', B: 'Rights Approach', C: 'Common Good Approach', D: 'Leviathan State' } }
        };

        // *** UPDATED: Correct answers mapped to letters (CHAPTER 4 SET) ***
        const correctAnswersMap = {
            q1: 'B', q2: 'B', q3: 'B', q4: 'C', q5: 'D',
            q6: 'C', q7: 'C', q8: 'C', q9: 'C', q10: 'B',
            q11: 'B', q12: 'C', q13: 'C', q14: 'B', q15: 'B',
            q16: 'B', q17: 'B', q18: 'C', q19: 'C', q20: 'B',
            q21: 'C', q22: 'C', q23: 'C', q24: 'C', q25: 'B',
            q26: 'C', q27: 'B', q28: 'B', q29: 'B', q30: 'C',
            q31: 'B', q32: 'B', q33: 'C', q34: 'B', q35: 'B',
            q36: 'B', q37: 'C', q38: 'C', q39: 'B', q40: 'B',
            q41: 'C', q42: 'B', q43: 'D', q44: 'C', q45: 'C',
            q46: 'C', q47: 'C', q48: 'B', q49: 'C', q50: 'C'
        };

        // --- Functions ---

        function checkLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            const errorMessage = document.getElementById('login-error');
            const loginSection = document.getElementById('login-section');
            const quizForm = document.getElementById('quiz-form');

            const isValid = validCredentials.some(cred =>
                cred.username === username && cred.password === password
            );

            if (isValid) {
                errorMessage.classList.add('hidden');
                loginSection.classList.add('hidden');
                quizForm.classList.remove('hidden');
            } else {
                errorMessage.classList.remove('hidden');
            }
        }

        function showReview() {
            const form = document.getElementById('mcie-quiz');
            formData = new FormData(form);
            const data = Object.fromEntries(formData);

             // Check if all questions are answered (Loops up to TOTAL_QUESTIONS = 50)
             let allAnswered = true;
             for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 if (!data[`q${i}`]) {
                     allAnswered = false;
                     break;
                 }
             }

             if (!data.name || !data.id_number || !data.section || !data.email || !data.phone || !allAnswered) {
                 alert('Please fill in all personal information and answer all questions before submitting.');
                 return;
             }

            quizData = {
                name: data.name,
                id_number: data.id_number,
                section: data.section,
                email: data.email,
                phone: data.phone,
                answers: {},
                questions: allQuestionsData
            };

            let reviewHTML = `
                <p><strong>Name:</strong> ${data.name}</p>
                <p><strong>ID Number:</strong> ${data.id_number}</p>
                <p><strong>Section:</strong> ${data.section}</p>
                <p><strong>Email:</strong> ${data.email}</p>
                <p><strong>Phone Number:</strong> ${data.phone}</p>
                <hr>
                <h3>Your Answers:</h3>
            `;

            // Loop up to TOTAL_QUESTIONS = 50
            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                const qKey = `q${i}`;
                const userAnswer = data[qKey];
                quizData.answers[qKey] = userAnswer;
                const questionInfo = allQuestionsData[qKey];
                const answerText = questionInfo.choices[userAnswer] || 'Not Answered';
                reviewHTML += `<p><strong>Question ${i}:</strong> ${questionInfo.text}<br>Your answer: ${userAnswer}) ${answerText}</p>`;
            }

            const reviewContent = document.getElementById('review-content');
            reviewContent.innerHTML = reviewHTML;
            document.getElementById('quiz-form').classList.add('hidden');
            document.getElementById('review-section').classList.remove('hidden');
        }

        function editForm() {
            document.getElementById('review-section').classList.add('hidden');
            document.getElementById('quiz-form').classList.remove('hidden');
        }

        function downloadResponse() {
            if (!quizData) return;
            const doc = new jsPDF();
            let y = 10;
            const pageHeight = doc.internal.pageSize.height;
            const pageWidth = doc.internal.pageSize.width;
            const margin = 10;
            const effectiveWidth = pageWidth - margin * 2;

            doc.setFontSize(16);
            doc.text('MCIE Quiz Response - Chapter 4', pageWidth / 2, y, { align: 'center' }); // Updated Title
            y += 10;

            doc.setFontSize(12);
            doc.text(`Name: ${quizData.name}`, margin, y); y += 7;
            doc.text(`ID: ${quizData.id_number}`, margin, y); y += 7;
            doc.text(`Section: ${quizData.section}`, margin, y); y += 7;
            doc.text(`Email: ${quizData.email}`, margin, y); y += 7;
            doc.text(`Phone: ${quizData.phone}`, margin, y); y += 10;

             // Loop up to TOTAL_QUESTIONS = 50
            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const question = quizData.questions[qKey];
                 const userAnswer = quizData.answers[qKey];
                 const answerText = question.choices[userAnswer] || 'Not Answered';
                 const questionText = question.text;

                 const questionLines = doc.splitTextToSize(`Question ${i}: ${questionText}`, effectiveWidth);
                 const answerLines = doc.splitTextToSize(`Your answer: ${userAnswer}) ${answerText}`, effectiveWidth);
                 const spaceNeeded = (questionLines.length * 5) + 2 + (answerLines.length * 5) + 5;

                 if (y + spaceNeeded > pageHeight - margin) {
                    doc.addPage();
                    y = margin;
                 }
                doc.setFont('helvetica', 'bold');
                doc.text(questionLines, margin, y);
                y += (questionLines.length * 5) + 2;
                doc.setFont('helvetica', 'normal');
                if (y > pageHeight - margin) { doc.addPage(); y = margin; }
                doc.text(answerLines, margin, y);
                y += (answerLines.length * 5) + 5;
            }
            doc.save(`quiz_response_${quizData.id_number}_ch4.pdf`); // Updated filename
        }

        async function confirmSubmission() {
            // *** This function SUBMITS TO YOUR BACKEND (/submit-quiz) ***
            if (confirm('Are you sure you want to submit your answers?')) {
                if (!quizData || !formData) {
                     console.error("Quiz data or form data is missing.");
                     alert("Error: Cannot submit. Please try filling the form again.");
                     editForm();
                     return;
                }
                const data = Object.fromEntries(formData);
                let score = 0;
                // Loop up to TOTAL_QUESTIONS = 50
                for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                    const qKey = `q${i}`;
                    if (data[qKey] === correctAnswersMap[qKey]) {
                        score++;
                    }
                }
                quizData.score = score;

                // Prepare data for YOUR backend (/submit-quiz)
                const submissionData = {
                    name: data.name,
                    id_number: data.id_number,
                    section: data.section,
                    email: data.email,
                    phone: data.phone,
                    score: score,
                    totalQuestions: TOTAL_QUESTIONS // Sends 50
                    // quizChapter: 'Chapter 4' // Optional: Add if backend uses it
                };

                try {
                    // *** FETCH URL points to YOUR server's backend endpoint ***
                    const response = await fetch('/submit-quiz', { // <--- CORRECT URL for backend
                        method: 'POST',
                        body: JSON.stringify(submissionData),
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const result = await response.json();
                        console.log("Backend submission successful:", result);

                        const submissionContent = document.getElementById('submission-content');
                         let submissionHTML = `
                            <p><strong>Name:</strong> ${quizData.name}</p>
                            <p><strong>ID Number:</strong> ${quizData.id_number}</p>
                            <p><strong>Section:</strong> ${quizData.section}</p>
                            <p><strong>Email:</strong> ${quizData.email}</p>
                            <p><strong>Phone Number:</strong> ${quizData.phone}</p>
                            <hr>
                            <h3>Submitted Answers (Chapter 4):</h3>
                        `;
                         // Loop up to TOTAL_QUESTIONS = 50
                         for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                             const qKey = `q${i}`;
                             const questionInfo = quizData.questions[qKey];
                             const userAnswer = quizData.answers[qKey];
                             const answerText = questionInfo.choices[userAnswer] || 'Not Answered';
                             submissionHTML += `<p><strong>Question ${i}:</strong> ${questionInfo.text}<br>Your answer: ${userAnswer}) ${answerText}</p>`;
                         }
                        submissionContent.innerHTML = submissionHTML;

                        document.getElementById('review-section').classList.add('hidden');
                        document.getElementById('submission-copy').classList.remove('hidden');

                    } else {
                        // Handle ERROR response from your backend
                        let errorMsg = `Submission failed with status: ${response.status}`;
                        try {
                            const errorData = await response.json();
                            errorMsg = errorData.error || errorMsg;
                        } catch(e) { /* Ignore if response isn't JSON */ }
                        console.error('Backend submission error:', errorMsg);
                        document.getElementById('error-message').innerHTML = `<p>Submission failed: ${errorMsg}. Please check server logs and try again.</p>`;
                        document.getElementById('error-message').classList.remove('hidden');
                        document.getElementById('review-section').classList.add('hidden');
                    }
                } catch (error) {
                    // Handle NETWORK errors
                    console.error('Network/Fetch error:', error);
                    document.getElementById('error-message').innerHTML = `<p>An network error occurred during submission. Is the server running? Please check your connection and try again.</p>`;
                    document.getElementById('error-message').classList.remove('hidden');
                    document.getElementById('review-section').classList.add('hidden');
                }
            }
        }


        function proceedToPassword() {
            document.getElementById('submission-copy').classList.add('hidden');
            document.getElementById('password-section').classList.remove('hidden');
        }

        function checkPassword() {
            const passwordInput = document.getElementById('password').value;
            const correctPassword = 'password';
            const errorMessage = document.getElementById('password-error');
            const passwordSection = document.getElementById('password-section');
            const results = document.getElementById('results');

            if (passwordInput === correctPassword) {
                errorMessage.classList.add('hidden');
                passwordSection.classList.add('hidden');
                results.classList.remove('hidden');
                displayResults();
            } else {
                errorMessage.classList.remove('hidden');
            }
        }

        function displayResults() {
            if (!quizData) {
                document.getElementById('results').innerHTML = '<p>Error: No quiz data found. Please complete the quiz first.</p>';
                return;
            }

             const displayCorrectAnswers = {};
              // Loop up to TOTAL_QUESTIONS = 50
             for(let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const correctLetter = correctAnswersMap[qKey];
                 const correctText = allQuestionsData[qKey].choices[correctLetter];
                 displayCorrectAnswers[qKey] = `${correctLetter}) ${correctText}`;
             }

            document.getElementById('student-info').innerHTML = `<strong>Name:</strong> ${quizData.name}<br><strong>ID:</strong> ${quizData.id_number}<br><strong>Section:</strong> ${quizData.section}<br><strong>Email:</strong> ${quizData.email}<br><strong>Phone:</strong> ${quizData.phone}`;

            const answersDiv = document.getElementById('answers');
            let answersHTML = '<h3>Detailed Results (Chapter 4):</h3>'; // Updated heading

             // Loop up to TOTAL_QUESTIONS = 50
            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const question = quizData.questions[qKey];
                 const userAnswer = quizData.answers[qKey];
                 const userAnswerText = question.choices[userAnswer] || 'Not Answered';
                 const isCorrect = userAnswer === correctAnswersMap[qKey];

                 answersHTML += `
                    <div class="question-result">
                        <p><strong>Question ${i}:</strong> ${question.text}</p>
                        <div class="choices" style="font-size:0.9em; margin-left: 15px;">
                            <p>A) ${question.choices.A}</p>
                            <p>B) ${question.choices.B}</p>
                            <p>C) ${question.choices.C}</p>
                            <p>D) ${question.choices.D}</p>
                        </div>
                        <p>Your answer: ${userAnswer}) ${userAnswerText} ${isCorrect ? '<span style="color:green; font-weight:bold;">(Correct)</span>' : '<span style="color:red; font-weight:bold;">(Incorrect)</span>'}</p>
                        ${!isCorrect ? `<p style="color:blue;">Correct answer: ${displayCorrectAnswers[qKey]}</p>` : ''}
                    </div>
                `;
            }
            answersDiv.innerHTML = answersHTML;

            document.getElementById('score').textContent = `Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`;
        }

        function downloadPDF() {
            if (!quizData) return;
            const doc = new jsPDF();
            let y = 10;
            const pageHeight = doc.internal.pageSize.height;
            const pageWidth = doc.internal.pageSize.width;
            const margin = 10;
            const effectiveWidth = pageWidth - margin * 2;

             const displayCorrectAnswers = {};
              // Loop up to TOTAL_QUESTIONS = 50
             for(let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const correctLetter = correctAnswersMap[qKey];
                 const correctText = allQuestionsData[qKey].choices[correctLetter];
                 displayCorrectAnswers[qKey] = `${correctLetter}) ${correctText}`;
             }

            doc.setFontSize(16);
            doc.text('MCIE Quiz Results - Chapter 4', pageWidth / 2, y, { align: 'center' }); // Updated Title
            y += 10;

            doc.setFontSize(12);
            doc.text(`Name: ${quizData.name}`, margin, y); y += 7;
            doc.text(`ID: ${quizData.id_number}`, margin, y); y += 7;
            doc.text(`Section: ${quizData.section}`, margin, y); y += 7;
            doc.text(`Email: ${quizData.email}`, margin, y); y += 7;
            doc.text(`Phone: ${quizData.phone}`, margin, y); y += 10;

            doc.setFont('helvetica', 'bold');
            doc.text(`Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`, pageWidth / 2, y, { align: 'center' });
            y += 10;
            doc.setFont('helvetica', 'normal');

             // Loop up to TOTAL_QUESTIONS = 50
            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const question = quizData.questions[qKey];
                 const userAnswer = quizData.answers[qKey];
                 const userAnswerText = question.choices[userAnswer] || 'Not Answered';
                 const isCorrect = userAnswer === correctAnswersMap[qKey];
                 const questionText = question.text;
                 const correctAnswerFull = displayCorrectAnswers[qKey];

                 const qLines = doc.splitTextToSize(`Question ${i}: ${questionText}`, effectiveWidth);
                 const choicesLines = 4 * 5;
                 const yourAnsLines = doc.splitTextToSize(`Your answer: ${userAnswer}) ${userAnswerText} ${isCorrect ? '(Correct)' : '(Incorrect)'}`, effectiveWidth);
                 const correctAnsLines = isCorrect ? 0 : doc.splitTextToSize(`Correct answer: ${correctAnswerFull}`, effectiveWidth).length * 5;
                 const spaceNeeded = (qLines.length * 5) + 2 + choicesLines + 7 + (yourAnsLines.length * 5) + 7 + correctAnsLines + 5;

                 if (y + spaceNeeded > pageHeight - margin) {
                    doc.addPage();
                    y = margin;
                }
                doc.setFont('helvetica', 'bold');
                doc.text(qLines, margin, y);
                y += (qLines.length * 5) + 2;
                doc.setFont('helvetica', 'normal');
                if (y > pageHeight - margin * 3) { doc.addPage(); y = margin; }
                doc.setFontSize(10);
                doc.text(`  A) ${question.choices.A}`, margin + 5, y); y += 5;
                doc.text(`  B) ${question.choices.B}`, margin + 5, y); y += 5;
                doc.text(`  C) ${question.choices.C}`, margin + 5, y); y += 5;
                doc.text(`  D) ${question.choices.D}`, margin + 5, y); y += 7;
                doc.setFontSize(12);
                if (y > pageHeight - margin * 2) { doc.addPage(); y = margin; }
                doc.text(`Your answer: ${userAnswer}) ${userAnswerText} ${isCorrect ? '(Correct)' : '(Incorrect)'}`, margin, y); y += 7;
                if (!isCorrect) {
                    doc.setTextColor(0, 0, 255);
                    doc.text(`Correct answer: ${correctAnswerFull}`, margin, y); y += 7;
                    doc.setTextColor(0, 0, 0);
                }
                y += 5;
            }

            if (y > pageHeight - margin) { doc.addPage(); y = margin; }
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(14);
            doc.text(`Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`, pageWidth / 2, y, { align: 'center' });

            doc.save(`quiz_results_${quizData.id_number}_ch4.pdf`); // Updated filename
        }

    </script>
</body>
</html>