<!DOCTYPE html>
<html lang="en">
<head>
    <!-- IMPORTANT: Make sure your text editor saves this file with UTF-8 Encoding! -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>State, Government & Citizenship Quiz - Chapter 4</title> <!-- Changed Title -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="email"], input[type="tel"], input[type="password"] { width: 100%; padding: 8px; box-sizing: border-box; }
        input[type="radio"] { margin-right: 5px; }
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; cursor: pointer; margin-right: 10px; border-radius: 5px; }
        button:hover { background-color: #0056b3; }
        .hidden { display: none; }
        #error-message, #password-error, #login-error { color: red; font-size: 1.2em; text-align: center; }
        #success-message { color: green; font-size: 1.2em; text-align: center; }
        #results, #review-section, #submission-copy { margin-top: 20px; text-align: left; border: 1px solid #ccc; padding: 15px; border-radius: 5px; background-color: #f9f9f9;}
        #password-section, #login-section { text-align: center; max-width: 400px; margin: 20px auto; padding: 20px; border: 1px solid #ccc; border-radius: 5px; background-color: #f9f9f9;}
        #password-section input[type="password"], #login-section input[type="text"], #login-section input[type="password"] { width: calc(100% - 18px); }
        .question-result { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        #download-pdf, #download-response { margin-top: 10px; }
        #score { font-weight: bold; text-align: center; color: green; font-size: 1.4em; margin-top: 20px; }
        #review-section h2, #submission-copy h2, #results h1 { margin-bottom: 15px; text-align: center; color: #007bff;}
        #review-section button, #submission-copy button, #password-section button, #login-section button, #results button { margin-top: 15px; }
        .choices p { margin: 2px 0 2px 20px; }
    </style>
</head>
<body>
    <div id="login-section">
        <h1>Login to Access Quiz</h1>
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" placeholder="Enter username" required>
        </div>
        <div class="form-group">
            <label for="login-password">Password:</label>
            <input type="password" id="login-password" placeholder="Enter password" required>
        </div>
        <button onclick="checkLogin()">Login</button>
        <p id="login-error" class="hidden">Incorrect username or password. Please try again.</p>
    </div>

    <div id="quiz-form" class="hidden">
        <h1>State, Government & Citizenship Quiz - Chapter 4</h1> <!-- Changed Title -->
        <form id="mcie-quiz"> <!-- ID Kept, but content changed -->
            <!-- Student Information -->
            <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="id_number">ID Number:</label>
                <input type="text" id="id_number" name="id_number" required>
            </div>
            <div class="form-group">
                <label for="section">Section:</label>
                <input type="text" id="section" name="section" required>
            </div>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="phone">Phone Number:</label>
                <input type="tel" id="phone" name="phone" required>
            </div>

            <!-- Chapter 4 Multiple-Choice Questions -->
             <div class="form-group">
                 <label>1. The 'idealist' approach to defining the state, often associated with Hegel, emphasizes the state as:</label>
                 <input type="radio" name="q1" value="A" required> A) An instrument of class oppression.<br>
                 <input type="radio" name="q1" value="B"> B) An ethical community underpinned by mutual sympathy.<br>
                 <input type="radio" name="q1" value="C"> C) A set of institutions for maintaining social order.<br>
                 <input type="radio" name="q1" value="D"> D) An actor on the world stage.
             </div>
             <div class="form-group">
                 <label>2. The 'functionalist' approach defines the state primarily by its role in:</label>
                 <input type="radio" name="q2" value="A" required> A) Promoting individual freedom.<br>
                 <input type="radio" name="q2" value="B"> B) Upholding order and delivering social stability.<br>
                 <input type="radio" name="q2" value="C"> C) Representing the interests of the dominant economic class.<br>
                 <input type="radio" name="q2" value="D"> D) Engaging in international relations.
             </div>
             <div class="form-group">
                 <label>3. Defining the state as the apparatus of government in its broadest sense (public institutions responsible for collective organization) aligns with which approach?</label>
                 <input type="radio" name="q3" value="A" required> A) Idealist<br>
                 <input type="radio" name="q3" value="B"> B) Functionalist<br>
                 <input type="radio" name="q3" value="C"> C) Organizational<br>
                 <input type="radio" name="q3" value="D"> D) International
             </div>
             <div class="form-group">
                 <label>4. The international approach views the state mainly as:</label>
                 <input type="radio" name="q4" value="A" required> A) A mechanism for internal social control.<br>
                 <input type="radio" name="q4" value="B"> B) An ethical ideal.<br>
                 <input type="radio" name="q4" value="C"> C) The primary actor in global politics and international law.<br>
                 <input type="radio" name="q4" value="D"> D) A reflection of domestic class structures.
             </div>
             <div class="form-group">
                 <label>5. Which convention codified the four essential features of a state in international law?</label>
                 <input type="radio" name="q5" value="A" required> A) The Geneva Convention<br>
                 <input type="radio" name="q5" value="B"> B) The Vienna Convention<br>
                 <input type="radio" name="q5" value="C"> C) The Montevideo Convention<br>
                 <input type="radio" name="q5" value="D"> D) The Hague Convention
             </div>
             <div class="form-group">
                 <label>6. According to the Montevideo Convention, the four essential attributes of a state are:</label>
                 <input type="radio" name="q6" value="A" required> A) Democracy, market economy, recognized borders, national language.<br>
                 <input type="radio" name="q6" value="B"> B) Defined territory, permanent population, effective government, sovereignty.<br>
                 <input type="radio" name="q6" value="C"> C) Written constitution, independent judiciary, standing army, homogeneous population.<br>
                 <input type="radio" name="q6" value="D"> D) Common culture, historical legacy, international alliances, economic self-sufficiency.
             </div>
             <div class="form-group">
                 <label>7. The text emphasizes that a state's population:</label>
                 <input type="radio" name="q7" value="A" required> A) Must be homogeneous in terms of religion, language, and culture.<br>
                 <input type="radio" name="q7" value="B"> B) Must exceed one billion people to be considered significant.<br>
                 <input type="radio" name="q7" value="C"> C) Needs to exist for the state to exist, but homogeneity is not a requirement.<br>
                 <input type="radio" name="q7" value="D"> D) Primarily consists of citizens living abroad.
             </div>
             <div class="form-group">
                 <label>8. Government is described as the 'soul' or 'machinery' of the state because it:</label>
                 <input type="radio" name="q8" value="A" required> A) Defines the state's territory.<br>
                 <input type="radio" name="q8" value="B"> B) Represents the state in international law.<br>
                 <input type="radio" name="q8" value="C"> C) Implements the will of the state and maintains law and order.<br>
                 <input type="radio" name="q8" value="D"> D) Determines the state's population size.
             </div>
             <div class="form-group">
                 <label>9. Internal sovereignty implies that the state possesses:</label>
                 <input type="radio" name="q9" value="A" required> A) Recognition from other states.<br>
                 <input type="radio" name="q9" value="B"> B) The final and absolute source of law within its borders.<br>
                 <input type="radio" name="q9" value="C"> C) Membership in the United Nations.<br>
                 <input type="radio" name="q9" value="D"> D) Freedom from all international obligations.
             </div>
             <div class="form-group">
                 <label>10. External sovereignty refers primarily to the state's:</label>
                 <input type="radio" name="q10" value="A" required> A) Ability to control its population.<br>
                 <input type="radio" name="q10" value="B"> B) Freedom from foreign control and its status in the international system.<br>
                 <input type="radio" name="q10" value="C"> C) System of internal government.<br>
                 <input type="radio" name="q10" value="D"> D) Economic self-sufficiency.
             </div>
             <div class="form-group">
                 <label>11. Contemporary theorists often consider which factor as the fifth essential attribute of a state, alongside the Montevideo criteria?</label>
                 <input type="radio" name="q11" value="A" required> A) Economic development<br>
                 <input type="radio" name="q11" value="B"> B) Military strength<br>
                 <input type="radio" name="q11" value="C"> C) Recognition by other states<br>
                 <input type="radio" name="q11" value="D"> D) Cultural homogeneity
             </div>
             <div class="form-group">
                 <label>12. The pluralist theory views the state primarily as:</label>
                 <input type="radio" name="q12" value="A" required> A) An instrument of the ruling class.<br>
                 <input type="radio" name="q12" value="B"> B) A neutral arbiter or 'referee' among competing interests in society.<br>
                 <input type="radio" name="q12" value="C"> C) A self-serving entity seeking expansion ('leviathan').<br>
                 <input type="radio" name="q12" value="D"> D) A tool for upholding patriarchal structures.
             </div>
             <div class="form-group">
                 <label>13. The origins of the pluralist view of the state are often traced to:</label>
                 <input type="radio" name="q13" value="A" required> A) Marxist theory.<br>
                 <input type="radio" name="q13" value="B"> B) Social contract theories of Hobbes and Locke.<br>
                 <input type="radio" name="q13" value="C"> C) Feminist theory.<br>
                 <input type="radio" name="q13" value="D"> D) New Right ideology.
             </div>
             <div class="form-group">
                 <label>14. Neo-pluralists, like Dahl and Lindblom, modified the classical pluralist view by acknowledging that:</label>
                 <input type="radio" name="q14" value="A" required> A) The state is perfectly neutral.<br>
                 <input type="radio" name="q14" value="B"> B) Business interests often enjoy a 'privileged position'.<br>
                 <input type="radio" name="q14" value="C"> C) The state has complete autonomy from society.<br>
                 <input type="radio" name="q14" value="D"> D) Power is distributed absolutely equally among all groups.
             </div>
             <div class="form-group">
                 <label>15. The Marxist (capitalist state) theory views the state in capitalist society fundamentally as:</label>
                 <input type="radio" name="q15" value="A" required> A) A neutral umpire.<br>
                 <input type="radio" name="q15" value="B"> B) An instrument of class oppression serving the bourgeoisie.<br>
                 <input type="radio" name="q15" value="C"> C) A necessary evil to prevent anarchy.<br>
                 <input type="radio" name="q15" value="D"> D) A reflection of universal ethical principles.
             </div>
             <div class="form-group">
                 <label>16. In Marxist terms, the state is part of the 'superstructure' determined by the economic 'base', meaning:</label>
                 <input type="radio" name="q16" value="A" required> A) The state controls the economy.<br>
                 <input type="radio" name="q16" value="B"> B) Politics is independent of economics.<br>
                 <input type="radio" name="q16" value="C"> C) The state's nature is conditioned by the dominant mode of production.<br>
                 <input type="radio" name="q16" value="D"> D) The state exists to eliminate class differences.
             </div>
             <div class="form-group">
                 <label>17. The concept of 'relative autonomy' within Marxist theory suggests the state:</label>
                 <input type="radio" name="q17" value="A" required> A) Is directly controlled by individual capitalists at all times.<br>
                 <input type="radio" name="q17" value="B"> B) Can act with some independence from the ruling class to preserve the capitalist system overall.<br>
                 <input type="radio" name="q17" value="C"> C) Is entirely separate from the economic base.<br>
                 <input type="radio" name="q17" value="D"> D) Only serves the interests of the proletariat.
             </div>
             <div class="form-group">
                 <label>18. The 'Leviathan' theory of the state, associated with the New Right, views the state as:</label>
                 <input type="radio" name="q18" value="A" required> A) A minimal protector of rights.<br>
                 <input type="radio" name="q18" value="B"> B) A neutral referee.<br>
                 <input type="radio" name="q18" value="C"> C) A self-serving monster inclined towards expansion and intervention.<br>
                 <input type="radio" name="q18" value="D"> D) An instrument for achieving social justice.
             </div>
             <div class="form-group">
                 <label>19. The New Right argues that state expansion is often driven by:</label>
                 <input type="radio" name="q19" value="A" required> A) The needs of the working class.<br>
                 <input type="radio" name="q19" value="B"> B) International threats.<br>
                 <input type="radio" name="q19" value="C"> C) Demand-side pressures (electoral promises) and supply-side pressures (interests of state officials).<br>
                 <input type="radio" name="q19" value="D"> D) The requirements of socialist ideology.
             </div>
             <div class="form-group">
                 <label>20. The patriarchal theory of the state analyzes the state through the lens of:</label>
                 <input type="radio" name="q20" value="A" required> A) Class conflict.<br>
                 <input type="radio" name="q20" value="B"> B) International relations.<br>
                 <input type="radio" name="q20" value="C"> C) Gender inequality and the subordination of women.<br>
                 <input type="radio" name="q20" value="D"> D) Competition between interest groups.
             </div>
              <div class="form-group">
                 <label>21. Liberal feminists tend to view the state as:</label>
                 <input type="radio" name="q21" value="A" required> A) Inherently patriarchal and beyond reform.<br>
                 <input type="radio" name="q21" value="B"> B) A potential instrument for reform through equal rights and representation.<br>
                 <input type="radio" name="q21" value="C"> C) Irrelevant to gender equality.<br>
                 <input type="radio" name="q21" value="D"> D) Primarily an economic entity.
             </div>
             <div class="form-group">
                 <label>22. Radical feminists often view the state more critically as:</label>
                 <input type="radio" name="q22" value="A" required> A) A neutral arbiter.<br>
                 <input type="radio" name="q22" value="B"> B) An agent upholding the deeper structures of patriarchy in society.<br>
                 <input type="radio" name="q22" value="C"> C) A tool for achieving female supremacy.<br>
                 <input type="radio" name="q22" value="D"> D) A protector of women's interests.
             </div>
             <div class="form-group">
                 <label>23. A 'minimal' or 'night watchman' state primarily focuses on:</label>
                 <input type="radio" name="q23" value="A" required> A) Providing extensive welfare services.<br>
                 <input type="radio" name="q23" value="B"> B) Economic planning and intervention.<br>
                 <input type="radio" name="q23" value="C"> C) Maintaining domestic order, enforcing contracts, and protecting against external attack.<br>
                 <input type="radio" name="q23" value="D"> D) Promoting a specific religious doctrine.
             </div>
             <div class="form-group">
                 <label>24. 'Developmental states' are characterized by:</label>
                 <input type="radio" name="q24" value="A" required> A) Minimal government intervention in the economy.<br>
                 <input type="radio" name="q24" value="B"> B) Strong state intervention to promote economic growth and industrialization.<br>
                 <input type="radio" name="q24" value="C"> C) Complete state ownership of all property.<br>
                 <input type="radio" name="q24" value="D"> D) Focus solely on social welfare redistribution.
             </div>
             <div class="form-group">
                 <label>25. Social-democratic states aim to combine:</label>
                 <input type="radio" name="q25" value="A" required> A) Authoritarian rule with a free market.<br>
                 <input type="radio" name="q25" value="B"> B) Market capitalism with principles of fairness, equality, and social justice (welfare).<br>
                 <input type="radio" name="q25" value="C"> C) State ownership of all industries with minimal social services.<br>
                 <input type="radio" name="q25" value="D"> D) Religious law with democratic procedures.
             </div>
             <div class="form-group">
                 <label>26. Collectivized states, like the former USSR, are characterized by:</label>
                 <input type="radio" name="q26" value="A" required> A) A free market economy.<br>
                 <input type="radio" name="q26" value="B"> B) Complete state control over the economy through central planning.<br>
                 <input type="radio" name="q26" value="C"> C) A minimal role for the state.<br>
                 <input type="radio" name="q26" value="D"> D) A focus on individual liberties above all else.
             </div>
             <div class="form-group">
                 <label>27. Totalitarian states attempt to exert control over:</label>
                 <input type="radio" name="q27" value="A" required> A) Only the economic sphere.<br>
                 <input type="radio" name="q27" value="B"> B) Only the political sphere.<br>
                 <input type="radio" name="q27" value="C"> C) Every aspect of human existence (politics, economy, culture, religion, private life).<br>
                 <input type="radio" name="q27" value="D"> D) Only foreign policy.
             </div>
             <div class="form-group">
                 <label>28. The defining characteristic of a religious state is that:</label>
                 <input type="radio" name="q28" value="A" required> A) It guarantees complete separation of religion and state.<br>
                 <input type="radio" name="q28" value="B"> B) Religion serves as the basis for legitimacy and public policy, often overriding secular law.<br>
                 <input type="radio" name="q28" value="C"> C) It is officially atheistic.<br>
                 <input type="radio" name="q28" value="D"> D) Religious freedom is suppressed entirely.
             </div>
             <div class="form-group">
                 <label>29. Government, in its broadest sense, refers to:</label>
                 <input type="radio" name="q29" value="A" required> A) The population of a state.<br>
                 <input type="radio" name="q29" value="B"> B) The territory of a state.<br>
                 <input type="radio" name="q29" value="C"> C) Any mechanism through which ordered rule is maintained.<br>
                 <input type="radio" name="q29" value="D"> D) The international recognition of a state.
             </div>
             <div class="form-group">
                 <label>30. 'Authority' is defined as:</label>
                 <input type="radio" name="q30" value="A" required> A) The ability to influence behavior through coercion or force.<br>
                 <input type="radio" name="q30" value="B"> B) Legitimate power, based on an acknowledged duty to obey.<br>
                 <input type="radio" name="q30" value="C"> C) The physical territory controlled by a government.<br>
                 <input type="radio" name="q30" value="D"> D) The economic resources of a state.
             </div>
              <div class="form-group">
                 <label>31. 'Legitimacy' refers to:</label>
                 <input type="radio" name="q31" value="A" required> A) The use of physical force by the government.<br>
                 <input type="radio" name="q31" value="B"> B) The government's effectiveness in delivering services.<br>
                 <input type="radio" name="q31" value="C"> C) The belief that the government's rule is rightful and should be obeyed.<br>
                 <input type="radio" name="q31" value="D"> D) The popular acceptance of a specific leader.
             </div>
             <div class="form-group">
                 <label>32. A government lacking legitimacy might face:</label>
                 <input type="radio" name="q32" value="A" required> A) Increased voluntary compliance from citizens.<br>
                 <input type="radio" name="q32" value="B"> B) Stability and widespread support.<br>
                 <input type="radio" name="q32" value="C"> C) Deadlock, collapse, or the need for increased coercion.<br>
                 <input type="radio" name="q32" value="D"> D) Stronger international alliances.
             </div>
             <div class="form-group">
                 <label>33. Which of the following is listed as a primary purpose or function of government?</label>
                 <input type="radio" name="q33" value="A" required> A) Ensuring all citizens have the same opinions.<br>
                 <input type="radio" name="q33" value="B"> B) Self-preservation and the maintenance of order.<br>
                 <input type="radio" name="q33" value="C"> C) Maximizing the profits of government officials.<br>
                 <input type="radio" name="q33" value="D"> D) Promoting a single, official culture.
             </div>
             <div class="form-group">
                 <label>34. Citizenship, in its simplest terms, refers to:</label>
                 <input type="radio" name="q34" value="A" required> A) Holding a high position in government.<br>
                 <input type="radio" name="q34" value="B"> B) Being a legal member of a particular state, owing allegiance and entitled to protection.<br>
                 <input type="radio" name="q34" value="C"> C) Residing temporarily within a state's borders.<br>
                 <input type="radio" name="q34" value="D"> D) Being born within a specific territory.
             </div>
             <div class="form-group">
                 <label>35. T.H. Marshall identified three types of rights associated with citizenship development:</label>
                 <input type="radio" name="q35" value="A" required> A) Economic, social, environmental.<br>
                 <input type="radio" name="q35" value="B"> B) Civil, political, social.<br>
                 <input type="radio" name="q35" value="C"> C) Individual, group, state.<br>
                 <input type="radio" name="q35" value="D"> D) Natural, legal, divine.
             </div>
             <div class="form-group">
                 <label>36. Hohfeld's analysis of rights includes 'Liberty Rights', which entail:</label>
                 <input type="radio" name="q36" value="A" required> A) A duty imposed on others.<br>
                 <input type="radio" name="q36" value="B"> B) Freedom to do something without interference from others.<br>
                 <input type="radio" name="q36" value="C"> C) The ability to change the legal status of others.<br>
                 <input type="radio" name="q36" value="D"> D) Freedom from the control of others.
             </div>
             <div class="form-group">
                 <label>37. 'Claim Rights' in Hohfeld's framework entail:</label>
                 <input type="radio" name="q37" value="A" required> A) Freedom from interference.<br>
                 <input type="radio" name="q37" value="B"> B) A corresponding duty on another person to act or refrain from acting.<br>
                 <input type="radio" name="q37" value="C"> C) The ability to alter existing rights.<br>
                 <input type="radio" name="q37" value="D"> D) Immunity from having one's legal status changed.
             </div>
             <div class="form-group">
                 <label>38. 'Power Rights' refer to the ability to:</label>
                 <input type="radio" name="q38" value="A" required> A) Resist government authority.<br>
                 <input type="radio" name="q38" value="B"> B) Act without interference.<br>
                 <input type="radio" name="q38" value="C"> C) Modify or create rights and duties for oneself or others (e.g., making a contract).<br>
                 <input type="radio" name="q38" value="D"> D) Be exempt from legal obligations.
             </div>
             <div class="form-group">
                 <label>39. 'Immunity Rights' provide bearers with:</label>
                 <input type="radio" name="q39" value="A" required> A) The freedom to act as they please.<br>
                 <input type="radio" name="q39" value="B"> B) A claim on others for resources.<br>
                 <input type="radio" name="q39" value="C"> C) The ability to impose duties on others.<br>
                 <input type="radio" name="q39" value="D"> D) Protection from having their legal rights altered by another party.
             </div>
             <div class="form-group">
                 <label>40. Liberal citizenship theory emphasizes:</label>
                 <input type="radio" name="q40" value="A" required> A) The community as the primary political unit.<br>
                 <input type="radio" name="q40" value="B"> B) The individual person as the primary unit, with a focus on individual rights and freedoms.<br>
                 <input type="radio" name="q40" value="C"> C) Obligations to the state above all else.<br>
                 <input type="radio" name="q40" value="D"> D) The importance of group identity over individual identity.
             </div>
              <div class="form-group">
                 <label>41. A potential criticism of liberal citizenship is its tendency towards:</label>
                 <input type="radio" name="q41" value="A" required> A) Excessive community control.<br>
                 <input type="radio" name="q41" value="B"> B) Ignoring individual rights.<br>
                 <input type="radio" name="q41" value="C"> C) Creating free-riders and neglecting the common good due to individualism.<br>
                 <input type="radio" name="q41" value="D"> D) Suppressing cultural diversity.
             </div>
             <div class="form-group">
                 <label>42. Communitarian citizenship theory emphasizes:</label>
                 <input type="radio" name="q42" value="A" required> A) Individual autonomy and detachment from society.<br>
                 <input type="radio" name="q42" value="B"> B) The importance of shared community life, traditions, and social context in shaping identity and obligations.<br>
                 <input type="radio" name="q42" value="C"> C) Universal, abstract rights.<br>
                 <input type="radio" name="q42" value="D"> D) A minimal role for the state.
             </div>
             <div class="form-group">
                 <label>43. Republican citizenship theory stresses the importance of:</label>
                 <input type="radio" name="q43" value="A" required> A) Withdrawal from public life into private pursuits.<br>
                 <input type="radio" name="q43" value="B"> B) Active participation in public affairs, civic virtue, and commitment to the common good.<br>
                 <input type="radio" name="q43" value="C"> C) Individual self-interest as the primary motivator.<br>
                 <input type="radio" name="q43" value="D"> D) Allegiance to a monarch.
             </div>
             <div class="form-group">
                 <label>44. Multicultural citizenship addresses concerns that:</label>
                 <input type="radio" name="q44" value="A" required> A) Individual rights are sufficient to ensure equality for all groups.<br>
                 <input type="radio" name="q44" value="B"> B) Universal citizenship models may disadvantage minority or marginalized groups.<br>
                 <input type="radio" name="q44" value="C"> C) Group rights undermine national unity.<br>
                 <input type="radio" name="q44" value="D"> D) Citizenship should be based solely on ethnicity.
             </div>
             <div class="form-group">
                 <label>45. Recognizing group-differentiated rights (e.g., cultural or linguistic rights for minorities) is a key feature of:</label>
                 <input type="radio" name="q45" value="A" required> A) Liberal citizenship<br>
                 <input type="radio" name="q45" value="B"> B) Communitarian citizenship<br>
                 <input type="radio" name="q45" value="C"> C) Republican citizenship<br>
                 <input type="radio" name="q45" value="D"> D) Multicultural citizenship
             </div>
             <div class="form-group">
                 <label>46. Acquiring citizenship based on being born within a state's territory is known as:</label>
                 <input type="radio" name="q46" value="A" required> A) Jus Sanguinis<br>
                 <input type="radio" name="q46" value="B"> B) Jus Soli<br>
                 <input type="radio" name="q46" value="C"> C) Naturalization<br>
                 <input type="radio" name="q46" value="D"> D) Descent
             </div>
             <div class="form-group">
                 <label>47. Acquiring citizenship based on parentage ('right of blood') is known as:</label>
                 <input type="radio" name="q47" value="A" required> A) Jus Soli<br>
                 <input type="radio" name="q47" value="B"> B) Jus Sanguinis<br>
                 <input type="radio" name="q47" value="C"> C) Naturalization<br>
                 <input type="radio" name="q47" value="D"> D) Adoption
             </div>
             <div class="form-group">
                 <label>48. The legal process by which foreigners become citizens of another country is called:</label>
                 <input type="radio" name="q48" value="A" required> A) Jus Soli<br>
                 <input type="radio" name="q48" value="B"> B) Jus Sanguinis<br>
                 <input type="radio" name="q48" value="C"> C) Naturalization<br>
                 <input type="radio" name="q48" value="D"> D) Deprivation
             </div>
             <div class="form-group">
                 <label>49. According to the 2003 Ethiopian Nationality Proclamation, Ethiopian nationality can generally be acquired by:</label>
                 <input type="radio" name="q49" value="A" required> A) Investing a certain amount of money.<br>
                 <input type="radio" name="q49" value="B"> B) Owning property in Ethiopia.<br>
                 <input type="radio" name="q49" value="C"> C) Descent or naturalization (including by application, marriage, adoption, etc.).<br>
                 <input type="radio" name="q49" value="D"> D) Proving linguistic proficiency only.
             </div>
             <div class="form-group">
                 <label>50. Statelessness refers to the condition of:</label>
                 <input type="radio" name="q50" value="A" required> A) Holding citizenship in multiple countries.<br>
                 <input type="radio" name="q50" value="B"> B) Having no citizenship or nationality in any country.<br>
                 <input type="radio" name="q50" value="C"> C) Voluntarily renouncing one's citizenship.<br>
                 <input type="radio" name="q50" value="D"> D) Temporarily residing outside one's country of citizenship.
             </div>

            <button type="button" onclick="showReview()">Submit</button>
        </form>
        <div id="error-message" class="hidden">
            <p>Something went wrong. Please try again.</p>
        </div>
    </div>

    <div id="review-section" class="hidden">
        <h2>Review Your Answers</h2>
        <div id="review-content"></div>
        <button onclick="editForm()">Edit</button>
        <button onclick="downloadResponse()" id="download-response">Download My Response</button>
        <button onclick="confirmSubmission()">Confirm Submission</button>
    </div>

    <div id="submission-copy" class="hidden">
        <h2>Your Submitted Answers</h2>
        <div id="submission-content"></div>
        <button onclick="proceedToPassword()">Proceed</button>
    </div>

    <div id="password-section" class="hidden">
        <h1 id="success-message">Your response has been submitted</h1>
        <p>You can view your result (score) by entering the password.</p>
        <input type="password" id="password" placeholder="Enter password">
        <button onclick="checkPassword()">Submit</button>
        <p id="password-error" class="hidden">Incorrect password. Please try again.</p>
    </div>

    <div id="results" class="hidden">
        <h1>Quiz Results</h1>
        <p id="student-info"></p>
        <div id="answers"></div>
        <p id="score"></p>
        <button id="download-pdf" onclick="downloadPDF()">Download Results PDF</button>
    </div>

    <script>
        let quizData = null;
        let formData = null;
        const { jsPDF } = window.jspdf;
        const TOTAL_QUESTIONS = 50; // **** UPDATED Total number of questions ****

        // Valid login credentials (Remains the same)
        const validCredentials = [
            { username: 'section19', password: '123' },
            { username: 'section20', password: '123' },
            { username: 'muzemuza', password: 'moh' },
            { username: 'section21', password: '123' }
            // Add more valid credentials as needed
        ];

        // **** NEW SET: Chapter 4 Questions ****
        const allQuestionsData = {
             q1: { text: "The 'idealist' approach to defining the state, often associated with Hegel, emphasizes the state as:", choices: { A: 'An instrument of class oppression.', B: 'An ethical community underpinned by mutual sympathy.', C: 'A set of institutions for maintaining social order.', D: 'An actor on the world stage.' } },
             q2: { text: "The 'functionalist' approach defines the state primarily by its role in:", choices: { A: 'Promoting individual freedom.', B: 'Upholding order and delivering social stability.', C: 'Representing the interests of the dominant economic class.', D: 'Engaging in international relations.' } },
             q3: { text: 'Defining the state as the apparatus of government in its broadest sense (public institutions responsible for collective organization) aligns with which approach?', choices: { A: 'Idealist', B: 'Functionalist', C: 'Organizational', D: 'International' } },
             q4: { text: 'The international approach views the state mainly as:', choices: { A: 'A mechanism for internal social control.', B: 'An ethical ideal.', C: 'The primary actor in global politics and international law.', D: 'A reflection of domestic class structures.' } },
             q5: { text: 'Which convention codified the four essential features of a state in international law?', choices: { A: 'The Geneva Convention', B: 'The Vienna Convention', C: 'The Montevideo Convention', D: 'The Hague Convention' } },
             q6: { text: 'According to the Montevideo Convention, the four essential attributes of a state are:', choices: { A: 'Democracy, market economy, recognized borders, national language.', B: 'Defined territory, permanent population, effective government, sovereignty.', C: 'Written constitution, independent judiciary, standing army, homogeneous population.', D: 'Common culture, historical legacy, international alliances, economic self-sufficiency.' } },
             q7: { text: "The text emphasizes that a state's population:", choices: { A: 'Must be homogeneous in terms of religion, language, and culture.', B: 'Must exceed one billion people to be considered significant.', C: 'Needs to exist for the state to exist, but homogeneity is not a requirement.', D: 'Primarily consists of citizens living abroad.' } },
             q8: { text: "Government is described as the 'soul' or 'machinery' of the state because it:", choices: { A: "Defines the state's territory.", B: 'Represents the state in international law.', C: 'Implements the will of the state and maintains law and order.', D: "Determines the state's population size." } },
             q9: { text: 'Internal sovereignty implies that the state possesses:', choices: { A: 'Recognition from other states.', B: 'The final and absolute source of law within its borders.', C: 'Membership in the United Nations.', D: 'Freedom from all international obligations.' } },
             q10: { text: "External sovereignty refers primarily to the state's:", choices: { A: 'Ability to control its population.', B: 'Freedom from foreign control and its status in the international system.', C: 'System of internal government.', D: 'Economic self-sufficiency.' } },
             q11: { text: 'Contemporary theorists often consider which factor as the fifth essential attribute of a state, alongside the Montevideo criteria?', choices: { A: 'Economic development', B: 'Military strength', C: 'Recognition by other states', D: 'Cultural homogeneity' } },
             q12: { text: 'The pluralist theory views the state primarily as:', choices: { A: 'An instrument of the ruling class.', B: "A neutral arbiter or 'referee' among competing interests in society.", C: "A self-serving entity seeking expansion ('leviathan').", D: 'A tool for upholding patriarchal structures.' } },
             q13: { text: 'The origins of the pluralist view of the state are often traced to:', choices: { A: 'Marxist theory.', B: 'Social contract theories of Hobbes and Locke.', C: 'Feminist theory.', D: 'New Right ideology.' } },
             q14: { text: 'Neo-pluralists, like Dahl and Lindblom, modified the classical pluralist view by acknowledging that:', choices: { A: 'The state is perfectly neutral.', B: "Business interests often enjoy a 'privileged position'.", C: 'The state has complete autonomy from society.', D: 'Power is distributed absolutely equally among all groups.' } },
             q15: { text: 'The Marxist (capitalist state) theory views the state in capitalist society fundamentally as:', choices: { A: 'A neutral umpire.', B: 'An instrument of class oppression serving the bourgeoisie.', C: 'A necessary evil to prevent anarchy.', D: 'A reflection of universal ethical principles.' } },
             q16: { text: "In Marxist terms, the state is part of the 'superstructure' determined by the economic 'base', meaning:", choices: { A: 'The state controls the economy.', B: 'Politics is independent of economics.', C: "The state's nature is conditioned by the dominant mode of production.", D: 'The state exists to eliminate class differences.' } },
             q17: { text: "The concept of 'relative autonomy' within Marxist theory suggests the state:", choices: { A: 'Is directly controlled by individual capitalists at all times.', B: 'Can act with some independence from the ruling class to preserve the capitalist system overall.', C: 'Is entirely separate from the economic base.', D: 'Only serves the interests of the proletariat.' } },
             q18: { text: "The 'Leviathan' theory of the state, associated with the New Right, views the state as:", choices: { A: 'A minimal protector of rights.', B: 'A neutral referee.', C: 'A self-serving monster inclined towards expansion and intervention.', D: 'An instrument for achieving social justice.' } },
             q19: { text: 'The New Right argues that state expansion is often driven by:', choices: { A: 'The needs of the working class.', B: 'International threats.', C: 'Demand-side pressures (electoral promises) and supply-side pressures (interests of state officials).', D: 'The requirements of socialist ideology.' } },
             q20: { text: 'The patriarchal theory of the state analyzes the state through the lens of:', choices: { A: 'Class conflict.', B: 'International relations.', C: 'Gender inequality and the subordination of women.', D: 'Competition between interest groups.' } },
             q21: { text: 'Liberal feminists tend to view the state as:', choices: { A: 'Inherently patriarchal and beyond reform.', B: 'A potential instrument for reform through equal rights and representation.', C: 'Irrelevant to gender equality.', D: 'Primarily an economic entity.' } },
             q22: { text: 'Radical feminists often view the state more critically as:', choices: { A: 'A neutral arbiter.', B: 'An agent upholding the deeper structures of patriarchy in society.', C: 'A tool for achieving female supremacy.', D: "A protector of women's interests." } },
             q23: { text: "A 'minimal' or 'night watchman' state primarily focuses on:", choices: { A: 'Providing extensive welfare services.', B: 'Economic planning and intervention.', C: 'Maintaining domestic order, enforcing contracts, and protecting against external attack.', D: 'Promoting a specific religious doctrine.' } },
             q24: { text: "'Developmental states' are characterized by:", choices: { A: 'Minimal government intervention in the economy.', B: 'Strong state intervention to promote economic growth and industrialization.', C: 'Complete state ownership of all property.', D: 'Focus solely on social welfare redistribution.' } },
             q25: { text: 'Social-democratic states aim to combine:', choices: { A: 'Authoritarian rule with a free market.', B: 'Market capitalism with principles of fairness, equality, and social justice (welfare).', C: 'State ownership of all industries with minimal social services.', D: 'Religious law with democratic procedures.' } },
             q26: { text: 'Collectivized states, like the former USSR, are characterized by:', choices: { A: 'A free market economy.', B: 'Complete state control over the economy through central planning.', C: 'A minimal role for the state.', D: 'A focus on individual liberties above all else.' } },
             q27: { text: 'Totalitarian states attempt to exert control over:', choices: { A: 'Only the economic sphere.', B: 'Only the political sphere.', C: 'Every aspect of human existence (politics, economy, culture, religion, private life).', D: 'Only foreign policy.' } },
             q28: { text: 'The defining characteristic of a religious state is that:', choices: { A: 'It guarantees complete separation of religion and state.', B: 'Religion serves as the basis for legitimacy and public policy, often overriding secular law.', C: 'It is officially atheistic.', D: 'Religious freedom is suppressed entirely.' } },
             q29: { text: 'Government, in its broadest sense, refers to:', choices: { A: 'The population of a state.', B: 'The territory of a state.', C: 'Any mechanism through which ordered rule is maintained.', D: 'The international recognition of a state.' } },
             q30: { text: "'Authority' is defined as:", choices: { A: 'The ability to influence behavior through coercion or force.', B: 'Legitimate power, based on an acknowledged duty to obey.', C: 'The physical territory controlled by a government.', D: 'The economic resources of a state.' } },
             q31: { text: "'Legitimacy' refers to:", choices: { A: 'The use of physical force by the government.', B: "The government's effectiveness in delivering services.", C: "The belief that the government's rule is rightful and should be obeyed.", D: 'The popular acceptance of a specific leader.' } },
             q32: { text: 'A government lacking legitimacy might face:', choices: { A: 'Increased voluntary compliance from citizens.', B: 'Stability and widespread support.', C: 'Deadlock, collapse, or the need for increased coercion.', D: 'Stronger international alliances.' } },
             q33: { text: 'Which of the following is listed as a primary purpose or function of government?', choices: { A: 'Ensuring all citizens have the same opinions.', B: 'Self-preservation and the maintenance of order.', C: 'Maximizing the profits of government officials.', D: 'Promoting a single, official culture.' } },
             q34: { text: 'Citizenship, in its simplest terms, refers to:', choices: { A: 'Holding a high position in government.', B: 'Being a legal member of a particular state, owing allegiance and entitled to protection.', C: "Residing temporarily within a state's borders.", D: 'Being born within a specific territory.' } },
             q35: { text: 'T.H. Marshall identified three types of rights associated with citizenship development:', choices: { A: 'Economic, social, environmental.', B: 'Civil, political, social.', C: 'Individual, group, state.', D: 'Natural, legal, divine.' } },
             q36: { text: "Hohfeld's analysis of rights includes 'Liberty Rights', which entail:", choices: { A: 'A duty imposed on others.', B: 'Freedom to do something without interference from others.', C: 'The ability to change the legal status of others.', D: 'Freedom from the control of others.' } },
             q37: { text: "'Claim Rights' in Hohfeld's framework entail:", choices: { A: 'Freedom from interference.', B: 'A corresponding duty on another person to act or refrain from acting.', C: 'The ability to alter existing rights.', D: "Immunity from having one's legal status changed." } },
             q38: { text: "'Power Rights' refer to the ability to:", choices: { A: 'Resist government authority.', B: 'Act without interference.', C: 'Modify or create rights and duties for oneself or others (e.g., making a contract).', D: 'Be exempt from legal obligations.' } },
             q39: { text: "'Immunity Rights' provide bearers with:", choices: { A: 'The freedom to act as they please.', B: 'A claim on others for resources.', C: 'The ability to impose duties on others.', D: "Protection from having their legal rights altered by another party." } },
             q40: { text: 'Liberal citizenship theory emphasizes:', choices: { A: 'The community as the primary political unit.', B: 'The individual person as the primary unit, with a focus on individual rights and freedoms.', C: 'Obligations to the state above all else.', D: 'The importance of group identity over individual identity.' } },
             q41: { text: 'A potential criticism of liberal citizenship is its tendency towards:', choices: { A: 'Excessive community control.', B: 'Ignoring individual rights.', C: 'Creating free-riders and neglecting the common good due to individualism.', D: 'Suppressing cultural diversity.' } },
             q42: { text: 'Communitarian citizenship theory emphasizes:', choices: { A: 'Individual autonomy and detachment from society.', B: 'The importance of shared community life, traditions, and social context in shaping identity and obligations.', C: 'Universal, abstract rights.', D: 'A minimal role for the state.' } },
             q43: { text: 'Republican citizenship theory stresses the importance of:', choices: { A: 'Withdrawal from public life into private pursuits.', B: 'Active participation in public affairs, civic virtue, and commitment to the common good.', C: 'Individual self-interest as the primary motivator.', D: 'Allegiance to a monarch.' } },
             q44: { text: 'Multicultural citizenship addresses concerns that:', choices: { A: 'Individual rights are sufficient to ensure equality for all groups.', B: 'Universal citizenship models may disadvantage minority or marginalized groups.', C: 'Group rights undermine national unity.', D: 'Citizenship should be based solely on ethnicity.' } },
             q45: { text: 'Recognizing group-differentiated rights (e.g., cultural or linguistic rights for minorities) is a key feature of:', choices: { A: 'Liberal citizenship', B: 'Communitarian citizenship', C: 'Republican citizenship', D: 'Multicultural citizenship' } },
             q46: { text: "Acquiring citizenship based on being born within a state's territory is known as:", choices: { A: 'Jus Sanguinis', B: 'Jus Soli', C: 'Naturalization', D: 'Descent' } },
             q47: { text: "Acquiring citizenship based on parentage ('right of blood') is known as:", choices: { A: 'Jus Soli', B: 'Jus Sanguinis', C: 'Naturalization', D: 'Adoption' } },
             q48: { text: 'The legal process by which foreigners become citizens of another country is called:', choices: { A: 'Jus Soli', B: 'Jus Sanguinis', C: 'Naturalization', D: 'Deprivation' } },
             q49: { text: 'According to the 2003 Ethiopian Nationality Proclamation, Ethiopian nationality can generally be acquired by:', choices: { A: 'Investing a certain amount of money.', B: 'Owning property in Ethiopia.', C: 'Descent or naturalization (including by application, marriage, adoption, etc.).', D: 'Proving linguistic proficiency only.' } },
             q50: { text: 'Statelessness refers to the condition of:', choices: { A: 'Holding citizenship in multiple countries.', B: 'Having no citizenship or nationality in any country.', C: "Voluntarily renouncing one's citizenship.", D: "Temporarily residing outside one's country of citizenship." } }
        };


        // **** NEW SET: Correct answers mapped to letters (Chapter 4) ****
        const correctAnswersMap = {
             q1: 'B',  q2: 'B',  q3: 'C',  q4: 'C',  q5: 'C',
             q6: 'B',  q7: 'C',  q8: 'C',  q9: 'B',  q10: 'B',
             q11: 'C', q12: 'B', q13: 'B', q14: 'B', q15: 'B',
             q16: 'C', q17: 'B', q18: 'C', q19: 'C', q20: 'C',
             q21: 'B', q22: 'B', q23: 'C', q24: 'B', q25: 'B',
             q26: 'B', q27: 'C', q28: 'B', q29: 'C', q30: 'B',
             q31: 'C', q32: 'C', q33: 'B', q34: 'B', q35: 'B',
             q36: 'B', q37: 'B', q38: 'C', q39: 'D', q40: 'B',
             q41: 'C', q42: 'B', q43: 'B', q44: 'B', q45: 'D',
             q46: 'B', q47: 'B', q48: 'C', q49: 'C', q50: 'B'
        };


        // --- Functions below are adjusted for TOTAL_QUESTIONS = 50 and new content ---

        function checkLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            const errorMessage = document.getElementById('login-error');
            const loginSection = document.getElementById('login-section');
            const quizForm = document.getElementById('quiz-form');

            const isValid = validCredentials.some(cred =>
                cred.username === username && cred.password === password
            );

            if (isValid) {
                errorMessage.classList.add('hidden');
                loginSection.classList.add('hidden');
                quizForm.classList.remove('hidden');
            } else {
                errorMessage.classList.remove('hidden');
            }
        }

        function showReview() {
            const form = document.getElementById('mcie-quiz');
            formData = new FormData(form);
            const data = Object.fromEntries(formData);

             // Check if all questions are answered
             let allAnswered = true;
             for (let i = 1; i <= TOTAL_QUESTIONS; i++) { // Loop uses TOTAL_QUESTIONS (now 50)
                 if (!data[`q${i}`]) {
                     allAnswered = false;
                     break;
                 }
             }

             if (!data.name || !data.id_number || !data.section || !data.email || !data.phone || !allAnswered) {
                 alert('Please fill in all personal information and answer all questions before submitting.');
                 return; // Stop the function if validation fails
             }

            // Store quiz data temporarily
            quizData = {
                name: data.name,
                id_number: data.id_number,
                section: data.section,
                email: data.email,
                phone: data.phone,
                answers: {},
                questions: allQuestionsData // Use the updated structure
            };

            // Populate answers dynamically
            let reviewHTML = `
                <p><strong>Name:</strong> ${data.name}</p>
                <p><strong>ID Number:</strong> ${data.id_number}</p>
                <p><strong>Section:</strong> ${data.section}</p>
                <p><strong>Email:</strong> ${data.email}</p>
                <p><strong>Phone Number:</strong> ${data.phone}</p>
                <hr>
                <h3>Your Answers:</h3>
            `;

            for (let i = 1; i <= TOTAL_QUESTIONS; i++) { // Loop uses TOTAL_QUESTIONS (now 50)
                const qKey = `q${i}`;
                const userAnswer = data[qKey];
                quizData.answers[qKey] = userAnswer; // Store answer
                const questionInfo = allQuestionsData[qKey]; // Use updated data
                const answerText = questionInfo.choices[userAnswer] || 'Not Answered';
                reviewHTML += `<p><strong>Question ${i}:</strong> ${questionInfo.text}<br>Your answer: ${userAnswer}) ${answerText}</p>`;
            }

            // Display review content
            const reviewContent = document.getElementById('review-content');
            reviewContent.innerHTML = reviewHTML;

            // Show review section
            document.getElementById('quiz-form').classList.add('hidden');
            document.getElementById('review-section').classList.remove('hidden');
        }

        function editForm() {
            document.getElementById('review-section').classList.add('hidden');
            document.getElementById('quiz-form').classList.remove('hidden');
        }

        function downloadResponse() {
            if (!quizData) return;

            const doc = new jsPDF();
            let y = 10;
            const pageHeight = doc.internal.pageSize.height;
            const pageWidth = doc.internal.pageSize.width;
            const margin = 10;
            const effectiveWidth = pageWidth - margin * 2;


            doc.setFontSize(16);
            doc.text('State, Government & Citizenship Quiz Response - Chapter 4', pageWidth / 2, y, { align: 'center' }); // Updated Title
            y += 10;

            doc.setFontSize(12);
            doc.text(`Name: ${quizData.name}`, margin, y); y += 7;
            doc.text(`ID: ${quizData.id_number}`, margin, y); y += 7;
            doc.text(`Section: ${quizData.section}`, margin, y); y += 7;
            doc.text(`Email: ${quizData.email}`, margin, y); y += 7;
            doc.text(`Phone: ${quizData.phone}`, margin, y); y += 10;

            for (let i = 1; i <= TOTAL_QUESTIONS; i++) { // Loop uses TOTAL_QUESTIONS (now 50)
                 const qKey = `q${i}`;
                 const question = quizData.questions[qKey];
                 const userAnswer = quizData.answers[qKey];
                 const answerText = question.choices[userAnswer] || 'Not Answered';
                 const questionText = question.text;

                 // Estimate space needed for the question + answer
                 const questionLines = doc.splitTextToSize(`Question ${i}: ${questionText}`, effectiveWidth);
                 const answerLines = doc.splitTextToSize(`Your answer: ${userAnswer}) ${answerText}`, effectiveWidth);
                 const spaceNeeded = (questionLines.length * 5) + 2 + (answerLines.length * 5) + 5; // Estimate lines * line height + spacing

                 if (y + spaceNeeded > pageHeight - margin) { // Check if content fits
                    doc.addPage();
                    y = margin;
                 }

                doc.setFont('helvetica', 'bold');
                doc.text(questionLines, margin, y);
                y += (questionLines.length * 5) + 2; // Adjust spacing based on lines
                doc.setFont('helvetica', 'normal');

                if (y > pageHeight - margin) { doc.addPage(); y = margin; } // Re-check just for answer part

                doc.text(answerLines, margin, y);
                y += (answerLines.length * 5) + 5; // Add space after the answer

            }

            doc.save(`state_gov_citizen_ch4_quiz_response_${quizData.id_number}.pdf`); // Updated filename
        }

        // --- MODIFIED: Sends data to your backend ---
        async function confirmSubmission() {
            if (confirm('Are you sure you want to submit your answers?')) {
                if (!quizData || !formData) {
                     console.error("Quiz data or form data is missing.");
                     alert("Error: Cannot submit. Please try filling the form again.");
                     editForm(); // Go back to edit
                     return;
                }

                const data = Object.fromEntries(formData); // Use the stored formData

                // Calculate score
                let score = 0;
                for (let i = 1; i <= TOTAL_QUESTIONS; i++) { // Loop uses TOTAL_QUESTIONS (now 50)
                    const qKey = `q${i}`;
                    if (data[qKey] === correctAnswersMap[qKey]) { // Use updated map
                        score++;
                    }
                }

                // Update quizData with score
                quizData.score = score;

                // Prepare data for YOUR backend
                const submissionData = {
                    name: data.name,
                    id_number: data.id_number,
                    section: data.section,
                    email: data.email,
                    phone: data.phone,
                    score: score,
                    totalQuestions: TOTAL_QUESTIONS, // Now 50
                    quizTitle: "State, Government & Citizenship Quiz - Chapter 4", // **** UPDATED TITLE ****
                    submittedAt: new Date().toISOString()
                    // Add individual answers if needed by backend
                    // answers: quizData.answers
                };

                try {
                    // Show "Submitting..." message or spinner here if desired

                    // --- MODIFIED FETCH CALL ---
                    const response = await fetch('/submit-quiz', { // Point to your backend endpoint
                        method: 'POST',
                        body: JSON.stringify(submissionData), // Send the data as JSON
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json' // Important Header!
                        }
                    });
                    // --- END MODIFIED FETCH CALL ---

                    if (response.ok) {
                        // --- SUCCESS HANDLING (From YOUR backend) ---
                        const result = await response.json(); // Assuming your backend sends JSON back
                        console.log("Submission successful:", result);

                        // Show submission copy (Same as before)
                        const submissionContent = document.getElementById('submission-content');
                         let submissionHTML = `
                            <p><strong>Name:</strong> ${quizData.name}</p>
                            <p><strong>ID Number:</strong> ${quizData.id_number}</p>
                            <p><strong>Section:</strong> ${quizData.section}</p>
                            <p><strong>Email:</strong> ${quizData.email}</p>
                            <p><strong>Phone Number:</strong> ${quizData.phone}</p>
                            <hr>
                            <h3>Submitted Answers:</h3>
                        `;
                         for (let i = 1; i <= TOTAL_QUESTIONS; i++) { // Loop uses TOTAL_QUESTIONS (now 50)
                             const qKey = `q${i}`;
                             const questionInfo = quizData.questions[qKey]; // Use updated data
                             const userAnswer = quizData.answers[qKey];
                             const answerText = questionInfo.choices[userAnswer] || 'Not Answered';
                             submissionHTML += `<p><strong>Question ${i}:</strong> ${questionInfo.text}<br>Your answer: ${userAnswer}) ${answerText}</p>`;
                         }
                        submissionContent.innerHTML = submissionHTML;

                        document.getElementById('review-section').classList.add('hidden');
                        document.getElementById('submission-copy').classList.remove('hidden');
                        // --- END SUCCESS HANDLING ---

                    } else {
                        // --- ERROR HANDLING (From YOUR backend) ---
                        let errorMsg = `Submission failed with status: ${response.status}`;
                        try {
                            const errorData = await response.json();
                            errorMsg = errorData.error || errorData.message || errorMsg;
                        } catch(e) { /* Ignore if response isn't JSON */ }

                        console.error('Backend submission error:', errorMsg);
                        document.getElementById('error-message').innerHTML = `<p>Submission failed: ${errorMsg}. Please try again.</p>`;
                        document.getElementById('error-message').classList.remove('hidden');
                        document.getElementById('review-section').classList.add('hidden');
                        // editForm(); // Optionally go back to edit
                        // --- END ERROR HANDLING ---
                    }
                } catch (error) {
                     // --- NETWORK/OTHER ERROR HANDLING ---
                    console.error('Network/Fetch error:', error);
                    document.getElementById('error-message').innerHTML = `<p>An network error occurred during submission. Please check your connection and try again.</p>`;
                    document.getElementById('error-message').classList.remove('hidden');
                    document.getElementById('review-section').classList.add('hidden');
                    // editForm(); // Optionally go back to edit
                    // --- END NETWORK ERROR HANDLING ---
                } finally {
                     // Hide "Submitting..." message or spinner here
                }
            }
        }


        function proceedToPassword() {
            document.getElementById('submission-copy').classList.add('hidden');
            document.getElementById('password-section').classList.remove('hidden');
        }

        function checkPassword() {
            const passwordInput = document.getElementById('password').value;
            const correctPassword = 'password'; // Keep the simple password
            const errorMessage = document.getElementById('password-error');
            const passwordSection = document.getElementById('password-section');
            const results = document.getElementById('results');

            if (passwordInput === correctPassword) {
                errorMessage.classList.add('hidden');
                passwordSection.classList.add('hidden');
                results.classList.remove('hidden');
                displayResults();
            } else {
                errorMessage.classList.remove('hidden');
            }
        }

        function displayResults() {
            if (!quizData) {
                document.getElementById('results').innerHTML = '<p>Error: No quiz data found. Please complete the quiz first.</p>';
                return;
            }

             // Combine correct answer letter with full text for display
             const displayCorrectAnswers = {};
             for(let i = 1; i <= TOTAL_QUESTIONS; i++) { // Loop uses TOTAL_QUESTIONS (now 50)
                 const qKey = `q${i}`;
                 const correctLetter = correctAnswersMap[qKey]; // Use updated map
                 const correctText = allQuestionsData[qKey].choices[correctLetter]; // Use updated data
                 displayCorrectAnswers[qKey] = `${correctLetter}) ${correctText}`; // Changed format slightly
             }


            document.getElementById('student-info').innerHTML = `<strong>Name:</strong> ${quizData.name}<br><strong>ID:</strong> ${quizData.id_number}<br><strong>Section:</strong> ${quizData.section}<br><strong>Email:</strong> ${quizData.email}<br><strong>Phone:</strong> ${quizData.phone}`;

            const answersDiv = document.getElementById('answers');
            let answersHTML = '<h3>Detailed Results:</h3>';

            for (let i = 1; i <= TOTAL_QUESTIONS; i++) { // Loop uses TOTAL_QUESTIONS (now 50)
                 const qKey = `q${i}`;
                 const question = quizData.questions[qKey]; // Use updated data
                 const userAnswer = quizData.answers[qKey];
                 const userAnswerText = question.choices[userAnswer] || 'Not Answered';
                 const isCorrect = userAnswer === correctAnswersMap[qKey]; // Use updated map

                 answersHTML += `
                    <div class="question-result">
                        <p><strong>Question ${i}:</strong> ${question.text}</p>
                        <div class="choices" style="font-size:0.9em; margin-left: 15px;">
                            <p>A) ${question.choices.A}</p>
                            <p>B) ${question.choices.B}</p>
                            <p>C) ${question.choices.C}</p>
                            <p>D) ${question.choices.D}</p>
                        </div>
                        <p>Your answer: ${userAnswer}) ${userAnswerText} ${isCorrect ? '<span style="color:green; font-weight:bold;">(Correct)</span>' : '<span style="color:red; font-weight:bold;">(Incorrect)</span>'}</p>
                        ${!isCorrect ? `<p style="color:blue;">Correct answer: ${displayCorrectAnswers[qKey]}</p>` : ''}
                    </div>
                `;
            }
            answersDiv.innerHTML = answersHTML;


            document.getElementById('score').textContent = `Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`; // TOTAL_QUESTIONS is now 50
        }

        function downloadPDF() {
            if (!quizData) return;

            const doc = new jsPDF();
            let y = 10;
            const pageHeight = doc.internal.pageSize.height;
            const pageWidth = doc.internal.pageSize.width;
            const margin = 10;
            const effectiveWidth = pageWidth - margin * 2;

             // Combine correct answer letter with full text for display
             const displayCorrectAnswers = {};
             for(let i = 1; i <= TOTAL_QUESTIONS; i++) { // Loop uses TOTAL_QUESTIONS (now 50)
                 const qKey = `q${i}`;
                 const correctLetter = correctAnswersMap[qKey]; // Use updated map
                 const correctText = allQuestionsData[qKey].choices[correctLetter]; // Use updated data
                 displayCorrectAnswers[qKey] = `${correctLetter}) ${correctText}`;
             }

            doc.setFontSize(16);
            doc.text('State, Government & Citizenship Quiz Results - Chapter 4', pageWidth / 2, y, { align: 'center' }); // Updated Title
            y += 10;

            doc.setFontSize(12);
            doc.text(`Name: ${quizData.name}`, margin, y); y += 7;
            doc.text(`ID: ${quizData.id_number}`, margin, y); y += 7;
            doc.text(`Section: ${quizData.section}`, margin, y); y += 7;
            doc.text(`Email: ${quizData.email}`, margin, y); y += 7;
            doc.text(`Phone: ${quizData.phone}`, margin, y); y += 10;

            doc.setFont('helvetica', 'bold');
            doc.text(`Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`, pageWidth / 2, y, { align: 'center' }); // TOTAL_QUESTIONS is now 50
            y += 10;
            doc.setFont('helvetica', 'normal');


            for (let i = 1; i <= TOTAL_QUESTIONS; i++) { // Loop uses TOTAL_QUESTIONS (now 50)
                 const qKey = `q${i}`;
                 const question = quizData.questions[qKey]; // Use updated data
                 const userAnswer = quizData.answers[qKey];
                 const userAnswerText = question.choices[userAnswer] || 'Not Answered';
                 const isCorrect = userAnswer === correctAnswersMap[qKey]; // Use updated map
                 const questionText = question.text;
                 const correctAnswerFull = displayCorrectAnswers[qKey];

                 // Estimate space needed
                 const qLines = doc.splitTextToSize(`Question ${i}: ${questionText}`, effectiveWidth);
                 const choicesLines = 4 * 5; // Estimate for 4 choices
                 const yourAnsLines = doc.splitTextToSize(`Your answer: ${userAnswer}) ${userAnswerText} ${isCorrect ? '(Correct)' : '(Incorrect)'}`, effectiveWidth);
                 const correctAnsLines = isCorrect ? 0 : doc.splitTextToSize(`Correct answer: ${correctAnswerFull}`, effectiveWidth).length * 5;
                 const spaceNeeded = (qLines.length * 5) + 2 + choicesLines + 7 + (yourAnsLines.length * 5) + 7 + correctAnsLines + 5;

                 if (y + spaceNeeded > pageHeight - margin) { // Check if content fits
                    doc.addPage();
                    y = margin;
                }

                doc.setFont('helvetica', 'bold');
                doc.text(qLines, margin, y);
                y += (qLines.length * 5) + 2; // Adjust spacing
                doc.setFont('helvetica', 'normal');

                if (y > pageHeight - margin * 3) { doc.addPage(); y = margin; } // Check space for choices/answers

                doc.setFontSize(10); // Slightly smaller for choices if needed
                doc.text(`  A) ${question.choices.A}`, margin + 5, y); y += 5;
                doc.text(`  B) ${question.choices.B}`, margin + 5, y); y += 5;
                doc.text(`  C) ${question.choices.C}`, margin + 5, y); y += 5;
                doc.text(`  D) ${question.choices.D}`, margin + 5, y); y += 7;
                doc.setFontSize(12); // Reset font size

                if (y > pageHeight - margin * 2) { doc.addPage(); y = margin; } // Check space for answers

                doc.text(`Your answer: ${userAnswer}) ${userAnswerText} ${isCorrect ? '(Correct)' : '(Incorrect)'}`, margin, y); y += 7;

                if (!isCorrect) {
                    doc.setTextColor(0, 0, 255); // Blue for correct answer when user was wrong
                    doc.text(`Correct answer: ${correctAnswerFull}`, margin, y); y += 7;
                    doc.setTextColor(0, 0, 0); // Reset color
                }
                y += 5; // Add space between questions

            }

            // Add score again at the end if needed, especially if it spans pages
            if (y > pageHeight - margin) { doc.addPage(); y = margin; }
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(14);
            doc.text(`Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`, pageWidth / 2, y, { align: 'center' }); // TOTAL_QUESTIONS is now 50

            doc.save(`state_gov_citizen_ch4_quiz_results_${quizData.id_number}.pdf`); // Updated filename
        }
    </script>
</body>
</html>
