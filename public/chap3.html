<!DOCTYPE html>
<html lang="en">
<head>
    <!-- IMPORTANT: Make sure your text editor saves this file with UTF-8 Encoding! -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethical Decision Making Quiz - Chapter 3</title> <!-- Changed Title -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="email"], input[type="tel"], input[type="password"] { width: 100%; padding: 8px; box-sizing: border-box; }
        input[type="radio"] { margin-right: 5px; }
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; cursor: pointer; margin-right: 10px; border-radius: 5px; }
        button:hover { background-color: #0056b3; }
        .hidden { display: none; }
        #error-message, #password-error, #login-error { color: red; font-size: 1.2em; text-align: center; }
        #success-message { color: green; font-size: 1.2em; text-align: center; }
        #results, #review-section, #submission-copy { margin-top: 20px; text-align: left; border: 1px solid #ccc; padding: 15px; border-radius: 5px; background-color: #f9f9f9;}
        #password-section, #login-section { text-align: center; max-width: 400px; margin: 20px auto; padding: 20px; border: 1px solid #ccc; border-radius: 5px; background-color: #f9f9f9;}
        #password-section input[type="password"], #login-section input[type="text"], #login-section input[type="password"] { width: calc(100% - 18px); }
        .question-result { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        #download-pdf, #download-response { margin-top: 10px; }
        #score { font-weight: bold; text-align: center; color: green; font-size: 1.4em; margin-top: 20px; }
        #review-section h2, #submission-copy h2, #results h1 { margin-bottom: 15px; text-align: center; color: #007bff;}
        #review-section button, #submission-copy button, #password-section button, #login-section button, #results button { margin-top: 15px; }
        .choices p { margin: 2px 0 2px 20px; }
    </style>
</head>
<body>
    <div id="login-section">
        <h1>Login to Access Quiz</h1>
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" placeholder="Enter username" required>
        </div>
        <div class="form-group">
            <label for="login-password">Password:</label>
            <input type="password" id="login-password" placeholder="Enter password" required>
        </div>
        <button onclick="checkLogin()">Login</button>
        <p id="login-error" class="hidden">Incorrect username or password. Please try again.</p>
    </div>

    <div id="quiz-form" class="hidden">
        <h1>Ethical Decision Making Quiz - Chapter 3</h1> <!-- Changed Title -->
        <form id="mcie-quiz"> <!-- ID Kept, but content changed -->
            <!-- Student Information -->
            <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="id_number">ID Number:</label>
                <input type="text" id="id_number" name="id_number" required>
            </div>
            <div class="form-group">
                <label for="section">Section:</label>
                <input type="text" id="section" name="section" required>
            </div>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="phone">Phone Number:</label>
                <input type="tel" id="phone" name="phone" required>
            </div>

            <!-- Chapter 3 Multiple-Choice Questions -->
            <div class="form-group">
                 <label>1. A primary function of morality, as described in the chapter introduction, is to:</label>
                 <input type="radio" name="q1" value="A" required> A) Eliminate all personal desires.<br>
                 <input type="radio" name="q1" value="B"> B) Provide guidance in making decisions and resolving conflicts.<br>
                 <input type="radio" name="q1" value="C"> C) Ensure everyone achieves maximum wealth.<br>
                 <input type="radio" name="q1" value="D"> D) Document historical events accurately.
             </div>
             <div class="form-group">
                 <label>2. An 'instrumental good' is valued because:</label>
                 <input type="radio" name="q2" value="A" required> A) Of its inherent nature and worth in itself.<br>
                 <input type="radio" name="q2" value="B"> B) It serves as a means to attain other desired goods.<br>
                 <input type="radio" name="q2" value="C"> C) It is universally desired by all people.<br>
                 <input type="radio" name="q2" value="D"> D) It aligns with religious doctrine.
             </div>
             <div class="form-group">
                 <label>3. An 'intrinsic good' is valued:</label>
                 <input type="radio" name="q3" value="A" required> A) Only for the results it produces.<br>
                 <input type="radio" name="q3" value="B"> B) Because it is mandated by law.<br>
                 <input type="radio" name="q3" value="C"> C) For what it is in itself, regardless of consequences.<br>
                 <input type="radio" name="q3" value="D"> D) Based on its monetary worth.
             </div>
             <div class="form-group">
                 <label>4. Analyzing and critically considering values like sanctity of life, quality of life, and autonomy is identified as a key task of:</label>
                 <input type="radio" name="q4" value="A" required> A) Legal reasoning<br>
                 <input type="radio" name="q4" value="B"> B) Scientific inquiry<br>
                 <input type="radio" name="q4" value="C"> C) Economic forecasting<br>
                 <input type="radio" name="q4" value="D"> D) Ethical reasoning
             </div>
             <div class="form-group">
                 <label>5. Evaluating the adequacy of reasons given for actions, such as the evidence and logic behind them, is described as a central task of:</label>
                 <input type="radio" name="q5" value="A" required> A) Political campaigning<br>
                 <input type="radio" name="q5" value="B"> B) Historical analysis<br>
                 <input type="radio" name="q5" value="C"> C) Ethics<br>
                 <input type="radio" name="q5" value="D"> D) Psychological assessment
             </div>
             <div class="form-group">
                 <label>6. The chapter suggests that resolving complex ethical problems definitively is:</label>
                 <input type="radio" name="q6" value="A" required> A) Always easy with the right formula.<br>
                 <input type="radio" name="q6" value="B"> B) Not always possible, as ethics involves navigating complexity.<br>
                 <input type="radio" name="q6" value="C"> C) The sole responsibility of legal professionals.<br>
                 <input type="radio" name="q6" value="D"> D) Only achievable through religious faith.
             </div>
             <div class="form-group">
                 <label>7. Philosophical ethics encourages individuals to critically reflect on moral sentiments and attitudes, moving beyond:</label>
                 <input type="radio" name="q7" value="A" required> A) Rational arguments.<br>
                 <input type="radio" name="q7" value="B"> B) Influences from family and society.<br>
                 <input type="radio" name="q7" value="C"> C) The consideration of consequences.<br>
                 <input type="radio" name="q7" value="D"> D) The study of different cultures.
             </div>
             <div class="form-group">
                 <label>8. 'Rationalisation' in an ethical context refers to:</label>
                 <input type="radio" name="q8" value="A" required> A) The process of applying strict logical rules to derive moral truths.<br>
                 <input type="radio" name="q8" value="B"> B) Using seemingly rational motives to disguise one's true, underlying reasons.<br>
                 <input type="radio" name="q8" value="C"> C) Justifying actions based on emotional responses alone.<br>
                 <input type="radio" name="q8" value="D"> D) A method for testing the factual accuracy of moral claims.
             </div>
             <div class="form-group">
                 <label>9. Reasoning that explains one thing by comparing it to another similar, yet different, thing is called:</label>
                 <input type="radio" name="q9" value="A" required> A) Deductive reasoning<br>
                 <input type="radio" name="q9" value="B"> B) Inductive reasoning<br>
                 <input type="radio" name="q9" value="C"> C) Reasoning by analogy<br>
                 <input type="radio" name="q9" value="D"> D) Rationalisation
             </div>
             <div class="form-group">
                 <label>10. Applying a general principle to a specific situation (e.g., "All people have rights; you are a person; therefore, you have rights") is an example of:</label>
                 <input type="radio" name="q10" value="A" required> A) Inductive reasoning<br>
                 <input type="radio" name="q10" value="B"> B) Reasoning by analogy<br>
                 <input type="radio" name="q10" value="C"> C) Rationalisation<br>
                 <input type="radio" name="q10" value="D"> D) Deductive reasoning
             </div>
             <div class="form-group">
                 <label>11. Drawing a conclusion or supporting a hypothesis based on accumulated evidence is characteristic of:</label>
                 <input type="radio" name="q11" value="A" required> A) Deductive reasoning<br>
                 <input type="radio" name="q11" value="B"> B) Inductive reasoning<br>
                 <input type="radio" name="q11" value="C"> C) Reasoning by analogy<br>
                 <input type="radio" name="q11" value="D"> D) The common good approach
             </div>
             <div class="form-group">
                 <label>12. The relationship between ethics and religious faith is presented as:</label>
                 <input type="radio" name="q12" value="A" required> A) Completely separate, with no overlap or relevance.<br>
                 <input type="radio" name="q12" value="B"> B) Identical, where ethics is simply religious commandments.<br>
                 <input type="radio" name="q12" value="C"> C) Complex, where faith-based arguments are relevant but rational justification is also emphasized.<br>
                 <input type="radio" name="q12" value="D"> D) Antagonistic, where rational ethics always disproves religious faith.
             </div>
             <div class="form-group">
                 <label>13. The first step suggested in analyzing moral issues within the ethical decision-making framework is:</label>
                 <input type="radio" name="q13" value="A" required> A) Appealing to values.<br>
                 <input type="radio" name="q13" value="B"> B) Getting the facts.<br>
                 <input type="radio" name="q13" value="C"> C) Consulting a religious leader.<br>
                 <input type="radio" name="q13" value="D"> D) Determining the desired outcome.
             </div>
             <div class="form-group">
                 <label>14. The Fairness and Justice Approach, rooted in Aristotle's philosophy, primarily asks:</label>
                 <input type="radio" name="q14" value="A" required> A) Does the action produce the greatest good for the greatest number?<br>
                 <input type="radio" name="q14" value="B"> B) Does the action respect the moral rights of everyone involved?<br>
                 <input type="radio" name="q14" value="C"> C) Does the action treat everyone equally, or does it show undue favoritism or discrimination?<br>
                 <input type="radio" name="q14" value="D"> D) Does the action advance the common good?
             </div>
             <div class="form-group">
                 <label>15. Treating equals equally and unequals unequally is a core principle of the:</label>
                 <input type="radio" name="q15" value="A" required> A) Utilitarian Approach<br>
                 <input type="radio" name="q15" value="B"> B) Rights Approach<br>
                 <input type="radio" name="q15" value="C"> C) Common Good Approach<br>
                 <input type="radio" name="q15" value="D"> D) Fairness and Justice Approach
             </div>
             <div class="form-group">
                 <label>16. The Common Good Approach emphasizes:</label>
                 <input type="radio" name="q16" value="A" required> A) Individual achievement above all else.<br>
                 <input type="radio" name="q16" value="B"> B) The well-being of the community and shared societal conditions.<br>
                 <input type="radio" name="q16" value="C"> C) Adherence to absolute, exceptionless moral rules.<br>
                 <input type="radio" name="q16" value="D"> D) Maximizing personal liberty regardless of impact on others.
             </div>
             <div class="form-group">
                 <label>17. Focusing on social policies, systems, and environments that benefit all members of a community is central to the:</label>
                 <input type="radio" name="q17" value="A" required> A) Rights Approach<br>
                 <input type="radio" name="q17" value="B"> B) Virtue Approach<br>
                 <input type="radio" name="q17" value="C"> C) Common Good Approach<br>
                 <input type="radio" name="q17" value="D"> D) Fairness and Justice Approach
             </div>
             <div class="form-group">
                 <label>18. The Rights Approach, influenced by thinkers like Kant, focuses on:</label>
                 <input type="radio" name="q18" value="A" required> A) The overall consequences of an action for society.<br>
                 <input type="radio" name="q18" value="B"> B) Respecting the fundamental dignity and entitlements of individuals based on their capacity to choose freely.<br>
                 <input type="radio" name="q18" value="C"> C) Developing good character traits.<br>
                 <input type="radio" name="q18" value="D"> D) Ensuring fair distribution of resources.
             </div>
             <div class="form-group">
                 <label>19. An action is considered wrong under the Rights Approach primarily if it:</label>
                 <input type="radio" name="q19" value="A" required> A) Fails to produce maximum happiness.<br>
                 <input type="radio" name="q19" value="B"> B) Violates the fundamental moral rights of individuals.<br>
                 <input type="radio" name="q19" value="C"> C) Goes against traditional customs.<br>
                 <input type="radio" name="q19" value="D"> D) Does not benefit the community as a whole.
             </div>
             <div class="form-group">
                 <label>20. Which aspect of morality refers to a human being's relationship with a supernatural being or beings?</label>
                 <input type="radio" name="q20" value="A" required> A) Social morality<br>
                 <input type="radio" name="q20" value="B"> B) Individual morality<br>
                 <input type="radio" name="q20" value="C"> C) Morality and nature<br>
                 <input type="radio" name="q20" value="D"> D) Religious morality
             </div>
             <div class="form-group">
                 <label>21. Morality concerning a human being's relationship to the non-human world falls under:</label>
                 <input type="radio" name="q21" value="A" required> A) Religious morality<br>
                 <input type="radio" name="q21" value="B"> B) Morality and nature<br>
                 <input type="radio" name="q21" value="C"> C) Individual morality<br>
                 <input type="radio" name="q21" value="D"> D) Social morality
             </div>
             <div class="form-group">
                 <label>22. Individual morality, as described, relates primarily to:</label>
                 <input type="radio" name="q22" value="A" required> A) Interactions between different people.<br>
                 <input type="radio" name="q22" value="B"> B) An individual's relationship and duties to themselves, based on personal conscience.<br>
                 <input type="radio" name="q22" value="C"> C) The laws established by a society.<br>
                 <input type="radio" name="q22" value="D"> D) Obligations towards a divine being.
             </div>
             <div class="form-group">
                 <label>23. The aspect of morality concerning relationships between human beings is:</label>
                 <input type="radio" name="q23" value="A" required> A) Religious morality<br>
                 <input type="radio" name="q23" value="B"> B) Morality and nature<br>
                 <input type="radio" name="q23" value="C"> C) Individual morality<br>
                 <input type="radio" name="q23" value="D"> D) Social morality
             </div>
             <div class="form-group">
                 <label>24. The text argues that moral responsibility, in the current understanding, primarily applies to:</label>
                 <input type="radio" name="q24" value="A" required> A) All living creatures, including plants and animals.<br>
                 <input type="radio" name="q24" value="B"> B) Only supernatural beings.<br>
                 <input type="radio" name="q24" value="C"> C) Human beings, due to their capacity for reasoned choice.<br>
                 <input type="radio" name="q24" value="D"> D) Only those who hold positions of power.
             </div>
             <div class="form-group">
                 <label>25. In evaluating the morality of an action, the term 'motive' refers to:</label>
                 <input type="radio" name="q25" value="A" required> A) The consequences or results of the action.<br>
                 <input type="radio" name="q25" value="B"> B) The agency or instrument used to perform the action.<br>
                 <input type="radio" name="q25" value="C"> C) The intention or the reason why the action was done.<br>
                 <input type="radio" name="q25" value="D"> D) The specific circumstances surrounding the action.
             </div>
             <div class="form-group">
                 <label>26. The 'means' in a moral judgment refers to:</label>
                 <input type="radio" name="q26" value="A" required> A) The ultimate goal or purpose of the action.<br>
                 <input type="radio" name="q26" value="B"> B) The effects or results of the action.<br>
                 <input type="radio" name="q26" value="C"> C) The agency, method, or instrument used to achieve an end.<br>
                 <input type="radio" name="q26" value="D"> D) The character of the person performing the action.
             </div>
             <div class="form-group">
                 <label>27. An action is considered 'moral' (i.e., within the scope of morality, whether good or bad), rather than 'non-moral', if it typically involves:</label>
                 <input type="radio" name="q27" value="A" required> A) An agent, intention, and affects others.<br>
                 <input type="radio" name="q27" value="B"> B) Only natural events.<br>
                 <input type="radio" name="q27" value="C"> C) Actions performed by animals.<br>
                 <input type="radio" name="q27" value="D"> D) Reflexive or involuntary actions.
             </div>
             <div class="form-group">
                 <label>28. The argument from 'enlightened self-interest' for being moral suggests that:</label>
                 <input type="radio" name="q28" value="A" required> A) Morality is solely about self-sacrifice.<br>
                 <input type="radio" name="q28" value="B"> B) Acting morally generally benefits oneself, especially within a cooperative society.<br>
                 <input type="radio" name="q28" value="C"> C) Self-interest is inherently immoral.<br>
                 <input type="radio" name="q28" value="D"> D) Only laws, not self-interest, can motivate moral behavior.
             </div>
             <div class="form-group">
                 <label>29. The argument that common human needs (like friendship, peace, stability) provide a reason to be moral is based on the idea that:</label>
                 <input type="radio" name="q29" value="A" required> A) Morality hinders the fulfillment of these needs.<br>
                 <input type="radio" name="q29" value="B"> B) These needs are best met in a society that follows cooperative moral principles.<br>
                 <input type="radio" name="q29" value="C"> C) Human needs are purely selfish.<br>
                 <input type="radio" name="q29" value="D"> D) Only religion can address human needs.
             </div>
             <div class="form-group">
                 <label>30. According to the chapter summary, ethical theories and principles serve as:</label>
                 <input type="radio" name="q30" value="A" required> A) Definitive algorithms that provide easy answers to all moral questions.<br>
                 <input type="radio" name="q30" value="B"> B) Historical curiosities with no practical relevance.<br>
                 <input type="radio" name="q30" value="C"> C) Foundations and viewpoints for ethical analysis and decision-making.<br>
                 <input type="radio" name="q30" value="D"> D) Replacements for factual investigation.
             </div>


            <button type="button" onclick="showReview()">Submit</button>
        </form>
        <div id="error-message" class="hidden">
            <p>Something went wrong. Please try again.</p>
        </div>
    </div>

    <div id="review-section" class="hidden">
        <h2>Review Your Answers</h2>
        <div id="review-content"></div>
        <button onclick="editForm()">Edit</button>
        <button onclick="downloadResponse()" id="download-response">Download My Response</button>
        <button onclick="confirmSubmission()">Confirm Submission</button>
    </div>

    <div id="submission-copy" class="hidden">
        <h2>Your Submitted Answers</h2>
        <div id="submission-content"></div>
        <button onclick="proceedToPassword()">Proceed</button>
    </div>

    <div id="password-section" class="hidden">
        <h1 id="success-message">Your response has been submitted</h1>
        <p>You can view your result (score) by entering the password.</p>
        <input type="password" id="password" placeholder="Enter password">
        <button onclick="checkPassword()">Submit</button>
        <p id="password-error" class="hidden">Incorrect password. Please try again.</p>
    </div>

    <div id="results" class="hidden">
        <h1>Quiz Results</h1>
        <p id="student-info"></p>
        <div id="answers"></div>
        <p id="score"></p>
        <button id="download-pdf" onclick="downloadPDF()">Download Results PDF</button>
    </div>

        <script>
        let quizData = null;
        let formData = null;
        const { jsPDF } = window.jspdf;
        // **** UPDATED Total number of questions ****
        const TOTAL_QUESTIONS = 30;

        // *** ADD THIS LINE - SET CHAPTER TO 3 ***
        // Define the chapter number for THIS specific quiz file (Chapter 3)
        const CURRENT_QUIZ_CHAPTER = 3;

        // *** ADD THIS LINE ***
        // Define the course code
        const COURSE_CODE = 'MCIE1012';


        // Valid login credentials (Remains the same)
        const validCredentials = [
            { username: 'section19', password: '123' },
            { username: 'section20', password: '123' },
            { username: 'muzemuza', password: 'moh' },
            { username: 'section21', password: '123' }
            // Add more valid credentials as needed
        ];

        // **** UPDATED SET: Chapter 3 Questions (Matches the HTML form questions) ****
        const allQuestionsData = {
             q1: { text: 'A primary function of morality, as described in the chapter introduction, is to:', choices: { A: 'Eliminate all personal desires.', B: 'Provide guidance in making decisions and resolving conflicts.', C: 'Ensure everyone achieves maximum wealth.', D: 'Document historical events accurately.' } },
             q2: { text: "An 'instrumental good' is valued because:", choices: { A: 'Of its inherent nature and worth in itself.', B: 'It serves as a means to attain other desired goods.', C: 'It is universally desired by all people.', D: 'It aligns with religious doctrine.' } },
             q3: { text: "An 'intrinsic good' is valued:", choices: { A: 'Only for the results it produces.', B: 'Because it is mandated by law.', C: 'For what it is in itself, regardless of consequences.', D: 'Based on its monetary worth.' } },
             q4: { text: 'Analyzing and critically considering values like sanctity of life, quality of life, and autonomy is identified as a key task of:', choices: { A: 'Legal reasoning', B: 'Scientific inquiry', C: 'Economic forecasting', D: 'Ethical reasoning' } },
             q5: { text: 'Evaluating the adequacy of reasons given for actions, such as the evidence and logic behind them, is described as a central task of:', choices: { A: 'Political campaigning', B: 'Historical analysis', C: 'Ethics', D: 'Psychological assessment' } },
             q6: { text: 'The chapter suggests that resolving complex ethical problems definitively is:', choices: { A: 'Always easy with the right formula.', B: 'Not always possible, as ethics involves navigating complexity.', C: 'The sole responsibility of legal professionals.', D: 'Only achievable through religious faith.' } },
             q7: { text: 'Philosophical ethics encourages individuals to critically reflect on moral sentiments and attitudes, moving beyond:', choices: { A: 'Rational arguments.', B: 'Influences from family and society.', C: 'The consideration of consequences.', D: 'The study of different cultures.' } },
             q8: { text: "'Rationalisation' in an ethical context refers to:", choices: { A: 'The process of applying strict logical rules to derive moral truths.', B: "Using seemingly rational motives to disguise one's true, underlying reasons.", C: 'Justifying actions based on emotional responses alone.', D: 'A method for testing the factual accuracy of moral claims.' } },
             q9: { text: 'Reasoning that explains one thing by comparing it to another similar, yet different, thing is called:', choices: { A: 'Deductive reasoning', B: 'Inductive reasoning', C: 'Reasoning by analogy', D: 'Rationalisation' } },
             q10: { text: 'Applying a general principle to a specific situation (e.g., "All people have rights; you are a person; therefore, you have rights") is an example of:', choices: { A: 'Inductive reasoning', B: 'Reasoning by analogy', C: 'Rationalisation', D: 'Deductive reasoning' } },
             q11: { text: 'Drawing a conclusion or supporting a hypothesis based on accumulated evidence is characteristic of:', choices: { A: 'Deductive reasoning', B: 'Inductive reasoning', C: 'Reasoning by analogy', D: 'The common good approach' } },
             q12: { text: 'The relationship between ethics and religious faith is presented as:', choices: { A: 'Completely separate, with no overlap or relevance.', B: 'Identical, where ethics is simply religious commandments.', C: 'Complex, where faith-based arguments are relevant but rational justification is also emphasized.', D: 'Antagonistic, where rational ethics always disproves religious faith.' } },
             q13: { text: 'The first step suggested in analyzing moral issues within the ethical decision-making framework is:', choices: { A: 'Appealing to values.', B: 'Getting the facts.', C: 'Consulting a religious leader.', D: 'Determining the desired outcome.' } },
             q14: { text: "The Fairness and Justice Approach, rooted in Aristotle's philosophy, primarily asks:", choices: { A: 'Does the action produce the greatest good for the greatest number?', B: 'Does the action respect the moral rights of everyone involved?', C: 'Does the action treat everyone equally, or does it show undue favoritism or discrimination?', D: 'Does the action advance the common good?' } },
             q15: { text: 'Treating equals equally and unequals unequally is a core principle of the:', choices: { A: 'Utilitarian Approach', B: 'Rights Approach', C: 'Common Good Approach', D: 'Fairness and Justice Approach' } },
             q16: { text: 'The Common Good Approach emphasizes:', choices: { A: 'Individual achievement above all else.', B: 'The well-being of the community and shared societal conditions.', C: 'Adherence to absolute, exceptionless moral rules.', D: 'Maximizing personal liberty regardless of impact on others.' } },
             q17: { text: 'Focusing on social policies, systems, and environments that benefit all members of a community is central to the:', choices: { A: 'Rights Approach', B: 'Virtue Approach', C: 'Common Good Approach', D: 'Fairness and Justice Approach' } },
             q18: { text: 'The Rights Approach, influenced by thinkers like Kant, focuses on:', choices: { A: 'The overall consequences of an action for society.', B: 'Respecting the fundamental dignity and entitlements of individuals based on their capacity to choose freely.', C: 'Developing good character traits.', D: 'Ensuring fair distribution of resources.' } },
             q19: { text: 'An action is considered wrong under the Rights Approach primarily if it:', choices: { A: 'Fails to produce maximum happiness.', B: 'Violates the fundamental moral rights of individuals.', C: 'Goes against traditional customs.', D: 'Does not benefit the community as a whole.' } },
             q20: { text: "Which aspect of morality refers to a human being's relationship with a supernatural being or beings?", choices: { A: 'Social morality', B: 'Individual morality', C: 'Morality and nature', D: 'Religious morality' } },
             q21: { text: "Morality concerning a human being's relationship to the non-human world falls under:", choices: { A: 'Religious morality', B: 'Morality and nature', C: 'Individual morality', D: 'Social morality' } },
             q22: { text: 'Individual morality, as described, relates primarily to:', choices: { A: 'Interactions between different people.', B: "An individual's relationship and duties to themselves, based on personal conscience.", C: 'The laws established by a society.', D: 'Obligations towards a divine being.' } },
             q23: { text: 'The aspect of morality concerning relationships between human beings is:', choices: { A: 'Religious morality', B: 'Morality and nature', C: 'Individual morality', D: 'Social morality' } },
             q24: { text: 'The text argues that moral responsibility, in the current understanding, primarily applies to:', choices: { A: 'All living creatures, including plants and animals.', B: 'Only supernatural beings.', C: 'Human beings, due to their capacity for reasoned choice.', D: 'Only those who hold positions of power.' } },
             q25: { text: "In evaluating the morality of an action, the term 'motive' refers to:", choices: { A: 'The consequences or results of the action.', B: 'The agency or instrument used to perform the action.', C: 'The intention or the reason why the action was done.', D: 'The specific circumstances surrounding the action.' } },
             q26: { text: "The 'means' in a moral judgment refers to:", choices: { A: 'The ultimate goal or purpose of the action.', B: 'The effects or results of the action.', C: 'The agency, method, or instrument used to achieve an end.', D: 'The character of the person performing the action.' } },
             q27: { text: "An action is considered 'moral' (i.e., within the scope of morality, whether good or bad), rather than 'non-moral', if it typically involves:", choices: { A: 'An agent, intention, and affects others.', B: 'Only natural events.', C: 'Actions performed by animals.', D: 'Reflexive or involuntary actions.' } },
             q28: { text: "The argument from 'enlightened self-interest' for being moral suggests that:", choices: { A: 'Morality is solely about self-sacrifice.', B: 'Acting morally generally benefits oneself, especially within a cooperative society.', C: 'Self-interest is inherently immoral.', D: 'Only laws, not self-interest, can motivate moral behavior.' } },
             q29: { text: 'The argument that common human needs (like friendship, peace, stability) provide a reason to be moral is based on the idea that:', choices: { A: 'Morality hinders the fulfillment of these needs.', B: 'These needs are best met in a society that follows cooperative moral principles.', C: 'Human needs are purely selfish.', D: 'Only religion can address human needs.' } },
             q30: { text: 'According to the chapter summary, ethical theories and principles serve as:', choices: { A: 'Definitive algorithms that provide easy answers to all moral questions.', B: 'Historical curiosities with no practical relevance.', C: 'Foundations and viewpoints for ethical analysis and decision-making.', D: 'Replacements for factual investigation.' } }
        };

        // **** UPDATED SET: Correct answers mapped to letters (Chapter 3 - Matches the HTML form answers) ****
        const correctAnswersMap = {
             q1: 'B',  q2: 'B',  q3: 'C',  q4: 'D',  q5: 'C',
             q6: 'B',  q7: 'B',  q8: 'B',  q9: 'C',  q10: 'D',
             q11: 'B', q12: 'C', q13: 'B', q14: 'C', q15: 'D',
             q16: 'B', q17: 'C', q18: 'B', q19: 'B', q20: 'D',
             q21: 'B', q22: 'B', q23: 'D', q24: 'C', q25: 'C',
             q26: 'C', q27: 'A', q28: 'B', q29: 'B', q30: 'C'
        };

        // --- Functions below modified to include chapter and formatted string ---

        function checkLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            const errorMessage = document.getElementById('login-error');
            const loginSection = document.getElementById('login-section');
            const quizForm = document.getElementById('quiz-form');

            const isValid = validCredentials.some(cred =>
                cred.username === username && cred.password === password
            );

            if (isValid) {
                errorMessage.classList.add('hidden');
                loginSection.classList.add('hidden');
                quizForm.classList.remove('hidden');
            } else {
                errorMessage.classList.remove('hidden');
            }
        }

        function showReview() {
            const form = document.getElementById('mcie-quiz');
            formData = new FormData(form);
            const data = Object.fromEntries(formData);

             // Check if all questions are answered
             let allAnswered = true;
             for (let i = 1; i <= TOTAL_QUESTIONS; i++) { // Loop uses TOTAL_QUESTIONS
                 if (!data[`q${i}`]) {
                     allAnswered = false;
                     break;
                 }
             }

             if (!data.name || !data.id_number || !data.section || !data.email || !data.phone || !allAnswered) {
                 alert('Please fill in all personal information and answer all questions before submitting.');
                 return; // Stop the function if validation fails
             }

            // Store quiz data temporarily
            quizData = {
                name: data.name,
                id_number: data.id_number,
                section: data.section,
                email: data.email,
                phone: data.phone,
                answers: {},
                questions: allQuestionsData, // Use the updated structure
                chapter: CURRENT_QUIZ_CHAPTER, // Added chapter to quizData
                courseCode: COURSE_CODE // Added course code to quizData
            };

            // Construct the formatted chapter string for display
             const formattedCourseChapter = `${quizData.courseCode} Chapter ${quizData.chapter}`;


            // Populate answers dynamically
            let reviewHTML = `
                <p><strong>Name:</strong> ${data.name}</p>
                <p><strong>ID Number:</strong> ${data.id_number}</p>
                <p><strong>Section:</strong> ${data.section}</p>
                <p><strong>Email:</strong> ${data.email}</p>
                <p><strong>Phone Number:</strong> ${data.phone}</p>
                 <p><strong>Chapter:</strong> ${quizData.chapter}</p>
                 <p><strong>Course & Chapter:</strong> ${formattedCourseChapter}</p> <!-- Added formatted chapter to review display -->
                <hr>
                <h3>Your Answers:</h3>
            `;

            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                const qKey = `q${i}`;
                const userAnswer = data[qKey];
                quizData.answers[qKey] = userAnswer; // Store answer
                const questionInfo = allQuestionsData[qKey];
                const answerText = questionInfo.choices[userAnswer] || 'Not Answered';
                reviewHTML += `<p><strong>Question ${i}:</strong> ${questionInfo.text}<br>Your answer: ${userAnswer}) ${answerText}</p>`;
            }

            // Display review content
            const reviewContent = document.getElementById('review-content');
            reviewContent.innerHTML = reviewHTML;

            // Show review section
            document.getElementById('quiz-form').classList.add('hidden');
            document.getElementById('review-section').classList.remove('hidden');
        }

        function editForm() {
            document.getElementById('review-section').classList.add('hidden');
            document.getElementById('quiz-form').classList.remove('hidden');
        }

        function downloadResponse() {
            if (!quizData) return;

            const doc = new jsPDF();
            let y = 10;
            const pageHeight = doc.internal.pageSize.height;
            const pageWidth = doc.internal.pageSize.width;
            const margin = 10;
            const effectiveWidth = pageWidth - margin * 2;

             const formattedCourseChapter = `${quizData.courseCode} Chapter ${quizData.chapter}`;


            doc.setFontSize(16);
            doc.text(`${formattedCourseChapter} Quiz Response`, pageWidth / 2, y, { align: 'center' }); // Updated Title
            y += 10;

            doc.setFontSize(12);
            doc.text(`Name: ${quizData.name}`, margin, y); y += 7;
            doc.text(`ID: ${quizData.id_number}`, margin, y); y += 7;
            doc.text(`Section: ${quizData.section}`, margin, y); y += 7;
            doc.text(`Email: ${quizData.email}`, margin, y); y += 7;
            doc.text(`Phone: ${quizData.phone}`, margin, y); y += 7;
            doc.text(`Chapter: ${quizData.chapter}`, margin, y); y += 7;
            doc.text(`Course & Chapter: ${formattedCourseChapter}`, margin, y); y += 10;


            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const question = quizData.questions[qKey];
                 const userAnswer = quizData.answers[qKey];
                 const answerText = question.choices[userAnswer] || 'Not Answered';
                 const questionText = question.text;

                 // Estimate space needed for the question + answer
                 const questionLines = doc.splitTextToSize(`Question ${i}: ${questionText}`, effectiveWidth);
                 const answerLines = doc.splitTextToSize(`Your answer: ${userAnswer}) ${answerText}`, effectiveWidth);
                 const spaceNeeded = (questionLines.length * 5) + 2 + (answerLines.length * 5) + 5;

                 if (y + spaceNeeded > pageHeight - margin) {
                    doc.addPage();
                    y = margin;
                 }

                doc.setFont('helvetica', 'bold');
                doc.text(questionLines, margin, y);
                y += (questionLines.length * 5) + 2;
                doc.setFont('helvetica', 'normal');

                if (y > pageHeight - margin) { doc.addPage(); y = margin; }

                doc.text(answerLines, margin, y);
                y += (answerLines.length * 5) + 5;

            }

            // Updated filename
            doc.save(`${formattedCourseChapter.replace(/ /g, '_')}_response_${quizData.id_number}.pdf`);
        }

        // --- MODIFIED: confirmSubmission Function ---
        async function confirmSubmission() {
            if (confirm('Are you sure you want to submit your answers?')) {
                if (!quizData || !formData) {
                     console.error("Quiz data or form data is missing.");
                     alert("Error: Cannot submit. Please try filling the form again.");
                     editForm(); // Go back to edit
                     return;
                }

                const data = Object.fromEntries(formData);

                // Calculate score
                let score = 0;
                for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                    const qKey = `q${i}`;
                    if (data[qKey] === correctAnswersMap[qKey]) {
                        score++;
                    }
                }

                // Update quizData with score (Optional but good practice)
                quizData.score = score;

                // *** CONSTRUCT THE FORMATTED CHAPTER STRING ***
                const formattedCourseChapter = `${COURSE_CODE} Chapter ${CURRENT_QUIZ_CHAPTER}`;


                // Prepare data for YOUR backend
                const submissionData = {
                    name: data.name,
                    id_number: data.id_number,
                    section: data.section,
                    email: data.email,
                    phone: data.phone,
                    score: score,
                    totalQuestions: TOTAL_QUESTIONS,
                    quizChapter: CURRENT_QUIZ_CHAPTER, // Keep the integer
                    // quizTitle: "Ethical Decision Making Quiz - Chapter 3", // You can keep or remove this
                    // submittedAt: new Date().toISOString(),
                    // answers: quizData.answers // You can add this if your backend table had a jsonb column for answers

                    // *** ADD THE NEW FIELD WITH THE FORMATTED STRING ***
                    course_chapter_formatted: formattedCourseChapter,
                };

                console.log("Submitting quiz data:", submissionData);

                try {
                    // Show "Submitting..." message or spinner here if desired

                    const response = await fetch('/submit-quiz', { // Point to your backend endpoint
                        method: 'POST',
                        body: JSON.stringify(submissionData), // Send the data as JSON
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json' // Important Header!
                        }
                    });

                    if (response.ok) {
                        const result = await response.json();
                        console.log('Submission successful:', result);
                        alert("Quiz submitted successfully!"); // Provide feedback to user

                        // Show submission copy
                        const submissionContent = document.getElementById('submission-content');
                         let submissionHTML = `
                            <p><strong>Name:</strong> ${quizData.name}</p>
                            <p><strong>ID Number:</strong> ${quizData.id_number}</p>
                            <p><strong>Section:</strong> ${quizData.section}</p>
                            <p><strong>Email:</strong> ${quizData.email}</p>
                            <p><strong>Phone Number:</strong> ${quizData.phone}</p>
                            <p><strong>Chapter:</strong> ${quizData.chapter}</p>
                             <p><strong>Course & Chapter:</strong> ${formattedCourseChapter}</p> <!-- Added formatted chapter to submission copy -->
                            <hr>
                            <h3>Submitted Answers:</h3>
                        `;
                         for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                             const qKey = `q${i}`;
                             const questionInfo = quizData.questions[qKey];
                             const userAnswer = quizData.answers[qKey];
                             const answerText = questionInfo.choices[userAnswer] || 'Not Answered';
                             submissionHTML += `<p><strong>Question ${i}:</strong> ${questionInfo.text}<br>Your answer: ${userAnswer}) ${answerText}</p>`;
                         }
                        submissionContent.innerHTML = submissionHTML;

                        document.getElementById('review-section').classList.add('hidden');
                        document.getElementById('submission-copy').classList.remove('hidden');


                    } else {
                        let errorMsg = `Submission failed with status: ${response.status}`;
                        try {
                            const errorData = await response.json();
                            errorMsg = errorData.error || errorData.message || errorMsg;
                        } catch(e) { /* Ignore if response isn't JSON */ }

                        console.error('Backend submission error:', errorMsg);
                        document.getElementById('error-message').innerHTML = `<p>Submission failed: ${errorMsg}. Please try again.</p>`;
                        document.getElementById('error-message').classList.remove('hidden');
                        document.getElementById('review-section').classList.add('hidden');
                    }
                } catch (error) {
                    console.error('Network/Fetch error:', error);
                    document.getElementById('error-message').innerHTML = `<p>An network error occurred during submission. Please check your connection and try again.</p>`;
                    document.getElementById('error-message').classList.remove('hidden');
                    document.getElementById('review-section').classList.add('hidden');
                }
            }
        }


        function proceedToPassword() {
            document.getElementById('submission-copy').classList.add('hidden');
            document.getElementById('password-section').classList.remove('hidden');
        }

        function checkPassword() {
            const passwordInput = document.getElementById('password').value;
            const correctPassword = 'password'; // Keep the simple password
            const errorMessage = document.getElementById('password-error');
            const passwordSection = document.getElementById('password-section');
            const results = document.getElementById('results');

            if (passwordInput === correctPassword) {
                errorMessage.classList.add('hidden');
                passwordSection.classList.add('hidden');
                results.classList.remove('hidden');
                displayResults();
            } else {
                errorMessage.classList.remove('hidden');
            }
        }

        function displayResults() {
            if (!quizData) {
                document.getElementById('results').innerHTML = '<p>Error: No quiz data found. Please complete the quiz first.</p>';
                return;
            }

             // Combine correct answer letter with full text for display
             const displayCorrectAnswers = {};
             for(let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const correctLetter = correctAnswersMap[qKey];
                 const correctText = allQuestionsData[qKey].choices[correctLetter];
                 displayCorrectAnswers[qKey] = `${correctLetter}) ${correctText}`;
             }

            const formattedCourseChapter = `${quizData.courseCode} Chapter ${quizData.chapter}`;

            // Added formatted chapter to results display
            document.getElementById('student-info').innerHTML = `<strong>Name:</strong> ${quizData.name}<br><strong>ID:</strong> ${quizData.id_number}<br><strong>Section:</strong> ${quizData.section}<br><strong>Email:</strong> ${quizData.email}<br><strong>Phone:</strong> ${quizData.phone}<br><strong>Chapter:</strong> ${quizData.chapter}<br><strong>Course & Chapter:</strong> ${formattedCourseChapter}`;


            const answersDiv = document.getElementById('answers');
            let answersHTML = '<h3>Detailed Results:</h3>';

            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const question = quizData.questions[qKey];
                 const userAnswer = quizData.answers[qKey];
                 const userAnswerText = question.choices[userAnswer] || 'Not Answered';
                 const isCorrect = userAnswer === correctAnswersMap[qKey];

                 answersHTML += `
                    <div class="question-result">
                        <p><strong>Question ${i}:</strong> ${question.text}</p>
                        <div class="choices" style="font-size:0.9em; margin-left: 15px;">
                            <p>A) ${question.choices.A}</p>
                            <p>B) ${question.choices.B}</p>
                            <p>C) ${question.choices.C}</p>
                            <p>D) ${question.choices.D}</p>
                        </div>
                        <p>Your answer: ${userAnswer}) ${userAnswerText} ${isCorrect ? '<span style="color:green; font-weight:bold;">(Correct)</span>' : '<span style="color:red; font-weight:bold;">(Incorrect)</span>'}</p>
                        ${!isCorrect ? `<p style="color:blue;">Correct answer: ${displayCorrectAnswers[qKey]}</p>` : ''}
                    </div>
                `;
            }
            answersDiv.innerHTML = answersHTML;


            document.getElementById('score').textContent = `Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`;
        }

        function downloadPDF() {
            if (!quizData) return;

            const doc = new jsPDF();
            let y = 10;
            const pageHeight = doc.internal.pageSize.height;
            const pageWidth = doc.internal.pageSize.width;
            const margin = 10;
            const effectiveWidth = pageWidth - margin * 2;

             // Combine correct answer letter with full text for display
             const displayCorrectAnswers = {};
             for(let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const correctLetter = correctAnswersMap[qKey];
                 const correctText = allQuestionsData[qKey].choices[correctLetter];
                 displayCorrectAnswers[qKey] = `${correctLetter}) ${correctText}`;
             }

            const formattedCourseChapter = `${quizData.courseCode} Chapter ${quizData.chapter}`;

            doc.setFontSize(16);
            doc.text(`${formattedCourseChapter} Quiz Results`, pageWidth / 2, y, { align: 'center' });
            y += 10;

            doc.setFontSize(12);
            doc.text(`Name: ${quizData.name}`, margin, y); y += 7;
            doc.text(`ID: ${quizData.id_number}`, margin, y); y += 7;
            doc.text(`Section: ${quizData.section}`, margin, y); y += 7;
            doc.text(`Email: ${quizData.email}`, margin, y); y += 7;
            doc.text(`Phone: ${quizData.phone}`, margin, y); y += 7;
             // Added formatted chapter to PDF
            doc.text(`Course & Chapter: ${formattedCourseChapter}`, margin, y); y += 10;


            doc.setFont('helvetica', 'bold');
            doc.text(`Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`, pageWidth / 2, y, { align: 'center' });
            y += 10;
            doc.setFont('helvetica', 'normal');


            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const question = quizData.questions[qKey];
                 const userAnswer = quizData.answers[qKey];
                 const userAnswerText = question.choices[userAnswer] || 'Not Answered';
                 const isCorrect = userAnswer === correctAnswersMap[qKey];
                 const questionText = question.text;
                 const correctAnswerFull = displayCorrectAnswers[qKey];

                 // Estimate space needed
                 const qLines = doc.splitTextToSize(`Question ${i}: ${questionText}`, effectiveWidth);
                 const choicesLines = 4 * 5; // Estimate for 4 choices at 5 units per line height
                 const yourAnsLines = doc.splitTextToSize(`Your answer: ${userAnswer}) ${userAnswerText} ${isCorrect ? '(Correct)' : '(Incorrect)'}`, effectiveWidth);
                 const correctAnsLinesHeight = isCorrect ? 0 : doc.splitTextToSize(`Correct answer: ${correctAnswerFull}`, effectiveWidth).length * 5; // Height needed for correct answer if wrong
                 const spaceNeeded = (qLines.length * 5) + 2 + choicesLines + 7 + (yourAnsLines.length * 5) + 7 + correctAnsLinesHeight + 5;


                 if (y + spaceNeeded > pageHeight - margin) {
                    doc.addPage();
                    y = margin;
                }

                doc.setFont('helvetica', 'bold');
                doc.text(qLines, margin, y);
                y += (qLines.length * 5) + 2;
                doc.setFont('helvetica', 'normal');

                 const remainingSpaceAfterQuestion = pageHeight - margin - y;
                 const answersSectionSpace = choicesLines + 7 + (yourAnsLines.length * 5) + 7 + correctAnsLinesHeight + 5;

                 if (answersSectionSpace > remainingSpaceAfterQuestion) {
                     doc.addPage();
                     y = margin;
                 }


                doc.setFontSize(10);
                doc.text(`  A) ${question.choices.A}`, margin + 5, y); y += 5;
                doc.text(`  B) ${question.choices.B}`, margin + 5, y); y += 5;
                doc.text(`  C) ${question.choices.C}`, margin + 5, y); y += 5;
                doc.text(`  D) ${question.choices.D}`, margin + 5, y); y += 7;
                doc.setFontSize(12);


                doc.text(`Your answer: ${userAnswer}) ${userAnswerText} ${isCorrect ? '(Correct)' : '(Incorrect)'}`, margin, y); y += 7;

                if (!isCorrect) {
                    doc.setTextColor(0, 0, 255);
                    doc.text(`Correct answer: ${correctAnswerFull}`, margin, y); y += 7;
                    doc.setTextColor(0, 0, 0);
                }
                y += 5;

            }

            if (y > pageHeight - margin) { doc.addPage(); y = margin; }
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(14);
            doc.text(`Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`, pageWidth / 2, y, { align: 'center' });

            // Updated filename to include formatted chapter
            doc.save(`${formattedCourseChapter.replace(/ /g, '_')}_results_${quizData.id_number}.pdf`);
        }
    </script>
</body>
</html>
