<!DOCTYPE html>
<html lang="en">
<head>
    <!-- IMPORTANT: Make sure your text editor saves this file with UTF-8 Encoding! -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Constitution, Democracy & Human Rights Quiz - Chapter 5</title> <!-- Changed Title -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="email"], input[type="tel"], input[type="password"] { width: 100%; padding: 8px; box-sizing: border-box; }
        input[type="radio"] { margin-right: 5px; }
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; cursor: pointer; margin-right: 10px; border-radius: 5px; }
        button:hover { background-color: #0056b3; }
        .hidden { display: none; }
        #error-message, #password-error, #login-error { color: red; font-size: 1.2em; text-align: center; }
        #success-message { color: green; font-size: 1.2em; text-align: center; }
        #results, #review-section, #submission-copy { margin-top: 20px; text-align: left; border: 1px solid #ccc; padding: 15px; border-radius: 5px; background-color: #f9f9f9;}
        #password-section, #login-section { text-align: center; max-width: 400px; margin: 20px auto; padding: 20px; border: 1px solid #ccc; border-radius: 5px; background-color: #f9f9f9;}
        #password-section input[type="password"], #login-section input[type="text"], #login-section input[type="password"] { width: calc(100% - 18px); }
        .question-result { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        #download-pdf, #download-response { margin-top: 10px; }
        #score { font-weight: bold; text-align: center; color: green; font-size: 1.4em; margin-top: 20px; }
        #review-section h2, #submission-copy h2, #results h1 { margin-bottom: 15px; text-align: center; color: #007bff;}
        #review-section button, #submission-copy button, #password-section button, #login-section button, #results button { margin-top: 15px; }
        .choices p { margin: 2px 0 2px 20px; }
    </style>
</head>
<body>
    <div id="login-section">
        <h1>Login to Access Quiz</h1>
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" placeholder="Enter username" required>
        </div>
        <div class="form-group">
            <label for="login-password">Password:</label>
            <input type="password" id="login-password" placeholder="Enter password" required>
        </div>
        <button onclick="checkLogin()">Login</button>
        <p id="login-error" class="hidden">Incorrect username or password. Please try again.</p>
    </div>

    <div id="quiz-form" class="hidden">
        <h1>Constitution, Democracy & Human Rights Quiz - Chapter 5</h1> <!-- Changed Title -->
        <form id="mcie-quiz"> <!-- ID Kept, but content changed -->
            <!-- Student Information -->
            <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="id_number">ID Number:</label>
                <input type="text" id="id_number" name="id_number" required>
            </div>
            <div class="form-group">
                <label for="section">Section:</label>
                <input type="text" id="section" name="section" required>
            </div>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="phone">Phone Number:</label>
                <input type="tel" id="phone" name="phone" required>
            </div>

            <!-- Chapter 5 Multiple-Choice Questions -->
             <div class="form-group">
                 <label>1. In a political sense, a constitution primarily signifies:</label>
                 <input type="radio" name="q1" value="A" required> A) The physical health of the nation's leader.<br>
                 <input type="radio" name="q1" value="B"> B) The founding document or body of rules for a state's government.<br>
                 <input type="radio" name="q1" value="C"> C) The membership list of a political party.<br>
                 <input type="radio" name="q1" value="D"> D) The bylaws of a trade union.
             </div>
             <div class="form-group">
                 <label>2. A constitution is often described as the 'mother of all laws' because:</label>
                 <input type="radio" name="q2" value="A" required> A) It is the longest legal document.<br>
                 <input type="radio" name="q2" value="B"> B) All other ordinary laws derive from and must conform to it.<br>
                 <input type="radio" name="q2" value="C"> C) It deals primarily with family law.<br>
                 <input type="radio" name="q2" value="D"> D) It was written by the 'founding fathers'.
             </div>
             <div class="form-group">
                 <label>3. The feature of 'Generality' distinguishes constitutions from other laws in that constitutions:</label>
                 <input type="radio" name="q3" value="A" required> A) Provide highly detailed rules for specific situations.<br>
                 <input type="radio" name="q3" value="B"> B) Set out the general framework and fundamental principles of government.<br>
                 <input type="radio" name="q3" value="C"> C) Are only applicable to government officials.<br>
                 <input type="radio" name="q3" value="D"> D) Change frequently based on political whims.
             </div>
             <div class="form-group">
                 <label>4. 'Permanency' as a feature of constitutions suggests they are:</label>
                 <input type="radio" name="q4" value="A" required> A) Meant to be temporary and easily changed.<br>
                 <input type="radio" name="q4" value="B"> B) Intended to be stable and lasting, not subject to frequent or easy alteration.<br>
                 <input type="radio" name="q4" value="C"> C) Only relevant during times of crisis.<br>
                 <input type="radio" name="q4" value="D"> D) Rewritten after every election.
             </div>
             <div class="form-group">
                 <label>5. Constitutional 'Supremacy' means that:</label>
                 <input type="radio" name="q5" value="A" required> A) The legislature can override the constitution at any time.<br>
                 <input type="radio" name="q5" value="B"> B) The constitution is the highest law, taking precedence over all other laws.<br>
                 <input type="radio" name="q5" value="C"> C) The executive branch is superior to the constitution.<br>
                 <input type="radio" name="q5" value="D"> D) International law always supersedes the constitution.
             </div>
             <div class="form-group">
                 <label>6. A 'codified document' refers to a constitution that is:</label>
                 <input type="radio" name="q6" value="A" required> A) Based entirely on unwritten customs.<br>
                 <input type="radio" name="q6" value="B"> B) Written down, often in a single, systematic document.<br>
                 <input type="radio" name="q6" value="C"> C) Secret and known only to rulers.<br>
                 <input type="radio" name="q6" value="D"> D) Composed of various historical traditions.
             </div>
             <div class="form-group">
                 <label>7. One of the major purposes of a constitution is to serve as a framework for government, meaning it:</label>
                 <input type="radio" name="q7" value="A" required> A) Lists all citizens by name.<br>
                 <input type="radio" name="q7" value="B"> B) Details foreign policy objectives.<br>
                 <input type="radio" name="q7" value="C"> C) Organizes the operation and guides the powers of government branches.<br>
                 <input type="radio" name="q7" value="D"> D) Prescribes specific economic policies.
             </div>
             <div class="form-group">
                 <label>8. Constitutions limit the powers of government primarily to:</label>
                 <input type="radio" name="q8" value="A" required> A) Make the government ineffective.<br>
                 <input type="radio" name="q8" value="B"> B) Protect the rights and freedoms of citizens from arbitrary rule.<br>
                 <input type="radio" name="q8" value="C"> C) Ensure the ruling party stays in power indefinitely.<br>
                 <input type="radio" name="q8" value="D"> D) Simplify the process of law-making.
             </div>
             <div class="form-group">
                 <label>9. The Preamble of a constitution, like that of the FDRE Constitution, typically serves to:</label>
                 <input type="radio" name="q9" value="A" required> A) List specific criminal offences.<br>
                 <input type="radio" name="q9" value="B"> B) Outline the fundamental values, goals, and ideological basis of the state.<br>
                 <input type="radio" name="q9" value="C"> C) Detail the procedures for amending the constitution.<br>
                 <input type="radio" name="q9" value="D"> D) Name the members of the judiciary.
             </div>
             <div class="form-group">
                 <label>10. A written constitution is one where:</label>
                 <input type="radio" name="q10" value="A" required> A) Fundamental principles are based only on tradition.<br>
                 <input type="radio" name="q10" value="B"> B) Provisions are embodied in a single formal document or instrument.<br>
                 <input type="radio" name="q10" value="C"> C) Rules can be changed easily by the government.<br>
                 <input type="radio" name="q10" value="D"> D) Courts have no power of interpretation.
             </div>
              <div class="form-group">
                 <label>11. An unwritten constitution, like that of the UK, primarily consists of:</label>
                 <input type="radio" name="q11" value="A" required> A) A single, comprehensive document.<br>
                 <input type="radio" name="q11" value="B"> B) Customs, conventions, traditions, and some written laws bearing constitutional weight.<br>
                 <input type="radio" name="q11" value="C"> C) Rules dictated by the monarch alone.<br>
                 <input type="radio" name="q11" value="D"> D) Laws imposed by international bodies.
             </div>
             <div class="form-group">
                 <label>12. A merit of a written constitution is that it:</label>
                 <input type="radio" name="q12" value="A" required> A) Is highly flexible and adapts instantly to change.<br>
                 <input type="radio" name="q12" value="B"> B) Creates ambiguity and confusion.<br>
                 <input type="radio" name="q12" value="C"> C) Is easily accessible to citizens, providing clarity and definiteness.<br>
                 <input type="radio" name="q12" value="D"> D) Prevents judicial interpretation.
             </div>
             <div class="form-group">
                 <label>13. A demerit of an unwritten constitution can be that it:</label>
                 <input type="radio" name="q13" value="A" required> A) Is too rigid and difficult to change.<br>
                 <input type="radio" name="q13" value="B"> B) Is not easily accessible or clear to the public, potentially leading to confusion.<br>
                 <input type="radio" name="q13" value="C"> C) Prevents gradual adaptation.<br>
                 <input type="radio" name="q13" value="D"> D) Is unsuitable for monarchical systems.
             </div>
             <div class="form-group">
                 <label>14. A 'rigid' constitution is one that:</label>
                 <input type="radio" name="q14" value="A" required> A) Can be amended through the ordinary legislative process.<br>
                 <input type="radio" name="q14" value="B"> B) Requires a special, more difficult procedure for amendment.<br>
                 <input type="radio" name="q14" value="C"> C) Is unwritten.<br>
                 <input type="radio" name="q14" value="D"> D) Has no provision for amendment.
             </div>
             <div class="form-group">
                 <label>15. A 'flexible' constitution allows for amendment through:</label>
                 <input type="radio" name="q15" value="A" required> A) Only a national referendum.<br>
                 <input type="radio" name="q15" value="B"> B) A complex process involving multiple government branches.<br>
                 <input type="radio" name="q15" value="C"> C) The same process used for enacting ordinary laws, often by a simple majority.<br>
                 <input type="radio" name="q15" value="D"> D) Judicial review only.
             </div>
             <div class="form-group">
                 <label>16. An 'effective' constitution is one where:</label>
                 <input type="radio" name="q16" value="A" required> A) The text accurately describes government limits, but these are ignored in practice.<br>
                 <input type="radio" name="q16" value="B"> B) Government practices largely correspond to the provisions of the constitution.<br>
                 <input type="radio" name="q16" value="C"> C) The constitution exists only on paper with no real power.<br>
                 <input type="radio" name="q16" value="D"> D) The amendment process is impossible.
             </div>
             <div class="form-group">
                 <label>17. A 'nominal' constitution exists when:</label>
                 <input type="radio" name="q17" value="A" required> A) The constitution fully controls government behavior.<br>
                 <input type="radio" name="q17" value="B"> B) The text describes limits and principles, but these are largely ignored in practice.<br>
                 <input type="radio" name="q17" value="C"> C) There is no written constitutional document.<br>
                 <input type="radio" name="q17" value="D"> D) The government strictly adheres to the rule of law.
             </div>
             <div class="form-group">
                 <label>18. A federal constitution is characterized by:</label>
                 <input type="radio" name="q18" value="A" required> A) Concentration of all power in the central government.<br>
                 <input type="radio" name="q18" value="B"> B) Distribution of power between central (federal) and regional/state governments.<br>
                 <input type="radio" name="q18" value="C"> C) The absence of a judicial branch.<br>
                 <input type="radio" name="q18" value="D"> D) An unwritten format.
             </div>
             <div class="form-group">
                 <label>19. A unitary constitution features:</label>
                 <input type="radio" name="q19" value="A" required> A) Power divided between national and local units by the constitution.<br>
                 <input type="radio" name="q19" value="B"> B) Concentration of state power primarily in the hands of the central government.<br>
                 <input type="radio" name="q19" value="C"> C) Co-equal status between central and regional governments.<br>
                 <input type="radio" name="q19" value="D"> D) A requirement for all laws to be approved by regional bodies.
             </div>
             <div class="form-group">
                 <label>20. Constitutionalism refers to the doctrine or belief that:</label>
                 <input type="radio" name="q20" value="A" required> A) Governments should have unlimited power.<br>
                 <input type="radio" name="q20" value="B"> B) Governments should be limited by law and accountable under a constitution.<br>
                 <input type="radio" name="q20" value="C"> C) Constitutions are merely symbolic documents.<br>
                 <input type="radio" name="q20" value="D"> D) Rulers are above the law.
             </div>
              <div class="form-group">
                 <label>21. Prior to 1931, Ethiopia's constitutional experience was characterized by:</label>
                 <input type="radio" name="q21" value="A" required> A) A series of modern, written constitutions.<br>
                 <input type="radio" name="q21" value="B"> B) An unwritten form, based on traditional documents and practices.<br>
                 <input type="radio" name="q21" value="C"> C) The complete absence of any form of legal or traditional constraints on rulers.<br>
                 <input type="radio" name="q21" value="D"> D) A system imposed by foreign powers.
             </div>
             <div class="form-group">
                 <label>22. The Fetha Negest (Law of the Kings) served historically in Ethiopia as a:</label>
                 <input type="radio" name="q22" value="A" required> A) Modern democratic constitution.<br>
                 <input type="radio" name="q22" value="B"> B) Religious and secular legal compilation influencing law and governance.<br>
                 <input type="radio" name="q22" value="C"> C) Declaration of independence.<br>
                 <input type="radio" name="q22" value="D"> D) Trade agreement.
             </div>
             <div class="form-group">
                 <label>23. The Kibre Negest (Glory of Kings) is primarily significant for:</label>
                 <input type="radio" name="q23" value="A" required> A) Establishing detailed administrative procedures.<br>
                 <input type="radio" name="q23" value="B"> B) Documenting the mythical origins and legitimizing the Solomonic dynasty.<br>
                 <input type="radio" name="q23" value="C"> C) Outlining modern human rights principles.<br>
                 <input type="radio" name="q23" value="D"> D) Serving as Ethiopia's first written penal code.
             </div>
             <div class="form-group">
                 <label>24. Ethiopia's first written constitution was promulgated in:</label>
                 <input type="radio" name="q24" value="A" required> A) 1889<br>
                 <input type="radio" name="q24" value="B"> B) 1931<br>
                 <input type="radio" name="q24" value="C"> C) 1955<br>
                 <input type="radio" name="q24" value="D"> D) 1987
             </div>
             <div class="form-group">
                 <label>25. The 1931 Constitution of Ethiopia primarily served to:</label>
                 <input type="radio" name="q25" value="A" required> A) Establish a federal democratic republic.<br>
                 <input type="radio" name="q25" value="B"> B) Limit the powers of the nobility.<br>
                 <input type="radio" name="q25" value="C"> C) Centralize state power and legitimize the Emperor's authority.<br>
                 <input type="radio" name="q25" value="D"> D) Grant universal suffrage.
             </div>
             <div class="form-group">
                 <label>26. The 1955 Revised Constitution of Ethiopia, compared to the 1931 version:</label>
                 <input type="radio" name="q26" value="A" required> A) Significantly reduced the Emperor's powers.<br>
                 <input type="radio" name="q26" value="B"> B) Introduced federalism.<br>
                 <input type="radio" name="q26" value="C"> C) Continued to reinforce centralization but included more detailed rights provisions (though largely symbolic).<br>
                 <input type="radio" name="q26" value="D"> D) Abolished the monarchy.
             </div>
             <div class="form-group">
                 <label>27. The 1987 Constitution established the:</label>
                 <input type="radio" name="q27" value="A" required> A) Imperial Ethiopian Government.<br>
                 <input type="radio" name="q27" value="B"> B) Transitional Government of Ethiopia.<br>
                 <input type="radio" name="q27" value="C"> C) People's Democratic Republic of Ethiopia (PDRE).<br>
                 <input type="radio" name="q27" value="D"> D) Federal Democratic Republic of Ethiopia (FDRE).
             </div>
             <div class="form-group">
                 <label>28. A key feature of the 1987 PDRE Constitution was its:</label>
                 <input type="radio" name="q28" value="A" required> A) Embrace of multi-party democracy.<br>
                 <input type="radio" name="q28" value="B"> B) Aim to establish a state based on Marxist-Leninist principles and a one-party system.<br>
                 <input type="radio" name="q28" value="C"> C) Restoration of the monarchy.<br>
                 <input type="radio" name="q28" value="D"> D) Strong emphasis on regional autonomy.
             </div>
             <div class="form-group">
                 <label>29. The current 1995 FDRE Constitution established:</label>
                 <input type="radio" name="q29" value="A" required> A) A unitary state.<br>
                 <input type="radio" name="q29" value="B"> B) A constitutional monarchy.<br>
                 <input type="radio" name="q29" value="C"> C) An ethnic-based federal system and a parliamentary republic.<br>
                 <input type="radio" name="q29" value="D"> D) A presidential system with unlimited executive power.
             </div>
             <div class="form-group">
                 <label>30. Democracy, derived from Greek, literally means:</label>
                 <input type="radio" name="q30" value="A" required> A) Rule by the wealthy.<br>
                 <input type="radio" name="q30" value="B"> B) Rule by the military.<br>
                 <input type="radio" name="q30" value="C"> C) Rule by the people.<br>
                 <input type="radio" name="q30" value="D"> D) Rule by the aristocracy.
             </div>
              <div class="form-group">
                 <label>31. Direct democracy involves citizens:</label>
                 <input type="radio" name="q31" value="A" required> A) Electing representatives to make decisions for them.<br>
                 <input type="radio" name="q31" value="B"> B) Participating directly in making laws and policy decisions.<br>
                 <input type="radio" name="q31" value="C"> C) Obeying the commands of a single ruler.<br>
                 <input type="radio" name="q31" value="D"> D) Having no say in government affairs.
             </div>
             <div class="form-group">
                 <label>32. Indirect or representative democracy involves citizens:</label>
                 <input type="radio" name="q32" value="A" required> A) Voting on every law themselves.<br>
                 <input type="radio" name="q32" value="B"> B) Electing officials to govern on their behalf.<br>
                 <input type="radio" name="q32" value="C"> C) Following rules set by traditional elders.<br>
                 <input type="radio" name="q32" value="D"> D) Living under military rule.
             </div>
             <div class="form-group">
                 <label>33. According to Robert Dahl, a minimal condition for modern democracy includes:</label>
                 <input type="radio" name="q33" value="A" required> A) State control of the media.<br>
                 <input type="radio" name="q33" value="B"> B) Elected officials chosen in frequent and fair elections.<br>
                 <input type="radio" name="q33" value="C"> C) A single-party political system.<br>
                 <input type="radio" name="q33" value="D"> D) Suppression of alternative sources of information.
             </div>
             <div class="form-group">
                 <label>34. The core value of 'Liberty' in democracy emphasizes:</label>
                 <input type="radio" name="q34" value="A" required> A) Government control over personal choices.<br>
                 <input type="radio" name="q34" value="B"> B) Personal and political freedoms, such as freedom from arbitrary arrest and freedom of expression.<br>
                 <input type="radio" name="q34" value="C"> C) The duty to obey all government orders without question.<br>
                 <input type="radio" name="q34" value="D"> D) Economic equality above all else.
             </div>
             <div class="form-group">
                 <label>35. 'Equality' as a democratic principle includes political equality, meaning:</label>
                 <input type="radio" name="q35" value="A" required> A) Equal distribution of wealth.<br>
                 <input type="radio" name="q35" value="B"> B) All citizens having equal standing and rights in the political process (e.g., one person, one vote).<br>
                 <input type="radio" name="q35" value="C"> C) Social hierarchies based on birth.<br>
                 <input type="radio" name="q35" value="D"> D) Different voting rights based on education level.
             </div>
             <div class="form-group">
                 <label>36. Popular Sovereignty implies that:</label>
                 <input type="radio" name="q36" value="A" required> A) The government is the ultimate source of authority.<br>
                 <input type="radio" name="q36" value="B"> B) The ultimate source of political authority resides in the people.<br>
                 <input type="radio" name="q36" value="C"> C) Foreign powers dictate government policy.<br>
                 <input type="radio" name="q36" value="D"> D) Military leaders hold supreme power.
             </div>
             <div class="form-group">
                 <label>37. Constitutional Supremacy as a democratic principle means:</label>
                 <input type="radio" name="q37" value="A" required> A) The constitution can be ignored by the government.<br>
                 <input type="radio" name="q37" value="B"> B) The constitution is the highest law, binding on everyone, including the government.<br>
                 <input type="radio" name="q37" value="C"> C) Laws are made by judges, not the legislature.<br>
                 <input type="radio" name="q37" value="D"> D) The executive branch holds supreme power.
             </div>
             <div class="form-group">
                 <label>38. The 'Rule of Law' requires that:</label>
                 <input type="radio" name="q38" value="A" required> A) Rulers are above the law.<br>
                 <input type="radio" name="q38" value="B"> B) Society is governed by laws that apply equally to everyone, including the government.<br>
                 <input type="radio" name="q38" value="C"> C) Laws can be applied arbitrarily.<br>
                 <input type="radio" name="q38" value="D"> D) Only the wealthy are subject to legal processes.
             </div>
             <div class="form-group">
                 <label>39. Secularism in a democratic context generally implies:</label>
                 <input type="radio" name="q39" value="A" required> A) The establishment of an official state religion.<br>
                 <input type="radio" name="q39" value="B"> B) Separation of state institutions and religious institutions.<br>
                 <input type="radio" name="q39" value="C"> C) Suppression of all religious practice.<br>
                 <input type="radio" name="q39" value="D"> D) Government funding for religious education only.
             </div>
             <div class="form-group">
                 <label>40. The principle of 'Separation of Powers' aims to:</label>
                 <input type="radio" name="q40" value="A" required> A) Concentrate all government power in one branch.<br>
                 <input type="radio" name="q40" value="B"> B) Divide government powers among different branches (legislative, executive, judicial) to prevent tyranny.<br>
                 <input type="radio" name="q40" value="C"> C) Eliminate the judicial branch.<br>
                 <input type="radio" name="q40" value="D"> D) Make government decision-making faster.
             </div>
              <div class="form-group">
                 <label>41. Democratization refers to the:</label>
                 <input type="radio" name="q41" value="A" required> A) Process of transition from authoritarian rule towards a democratic regime.<br>
                 <input type="radio" name="q41" value="B"> B) Consolidation of power by a single leader.<br>
                 <input type="radio" name="q41" value="C"> C) Abandonment of elections.<br>
                 <input type="radio" name="q41" value="D"> D) Establishment of a state-controlled economy.
             </div>
             <div class="form-group">
                 <label>42. Key actors in democratization often include:</label>
                 <input type="radio" name="q42" value="A" required> A) Only the military.<br>
                 <input type="radio" name="q42" value="B"> B) Only international organizations.<br>
                 <input type="radio" name="q42" value="C"> C) Political parties, media, and civil society organizations.<br>
                 <input type="radio" name="q42" value="D"> D) Only the incumbent authoritarian rulers.
             </div>
             <div class="form-group">
                 <label>43. Human rights are generally understood as:</label>
                 <input type="radio" name="q43" value="A" required> A) Privileges granted by governments that can be easily revoked.<br>
                 <input type="radio" name="q43" value="B"> B) Basic entitlements belonging to all individuals simply because they are human.<br>
                 <input type="radio" name="q43" value="C"> C) Rights applicable only to citizens of wealthy nations.<br>
                 <input type="radio" name="q43" value="D"> D) Obligations imposed on citizens by the state.
             </div>
             <div class="form-group">
                 <label>44. The principle of 'Universality' of human rights means they:</label>
                 <input type="radio" name="q44" value="A" required> A) Apply only in certain countries.<br>
                 <input type="radio" name="q44" value="B"> B) Belong equally to everyone, everywhere, regardless of status or location.<br>
                 <input type="radio" name="q44" value="C"> C) Differ based on religious beliefs.<br>
                 <input type="radio" name="q44" value="D"> D) Are determined by economic status.
             </div>
             <div class="form-group">
                 <label>45. The 'Indivisibility' and 'Interdependence' of human rights imply that:</label>
                 <input type="radio" name="q45" value="A" required> A) Civil and political rights are more important than economic and social rights.<br>
                 <input type="radio" name="q45" value="B"> B) Different categories of rights (civil, political, economic, social, cultural) are interconnected and equally important.<br>
                 <input type="radio" name="q45" value="C"> C) Rights can be enjoyed selectively.<br>
                 <input type="radio" name="q45" value="D"> D) Governments can choose which rights to respect.
             </div>
             <div class="form-group">
                 <label>46. Civil and Political Rights (First Generation Rights) typically include:</label>
                 <input type="radio" name="q46" value="A" required> A) Right to education, right to health care.<br>
                 <input type="radio" name="q46" value="B"> B) Right to life, freedom from torture, freedom of speech, right to vote.<br>
                 <input type="radio" name="q46" value="C"> C) Right to development, right to a clean environment.<br>
                 <input type="radio" name="q46" value="D"> D) Right to form trade unions, right to social security.
             </div>
             <div class="form-group">
                 <label>47. Social, Economic, and Cultural Rights (Second Generation Rights) often include:</label>
                 <input type="radio" name="q47" value="A" required> A) Freedom of assembly, freedom of religion.<br>
                 <input type="radio" name="q47" value="B"> B) Right to due process, right to a fair trial.<br>
                 <input type="radio" name="q47" value="C"> C) Right to work, right to education, right to health, right to social security.<br>
                 <input type="radio" name="q47" value="D"> D) Right to self-determination, right to peace.
             </div>
             <div class="form-group">
                 <label>48. Solidarity or Group Rights (Third Generation Rights) focus on collective rights such as:</label>
                 <input type="radio" name="q48" value="A" required> A) Right to property, freedom of contract.<br>
                 <input type="radio" name="q48" value="B"> B) Right to development, right to peace, right to a clean environment.<br>
                 <input type="radio" name="q48" value="C"> C) Freedom from arbitrary arrest, right to privacy.<br>
                 <input type="radio" name="q48" value="D"> D) Right to vote, freedom of expression.
             </div>
             <div class="form-group">
                 <label>49. Derogation of human rights refers to:</label>
                 <input type="radio" name="q49" value="A" required> A) The normal, everyday limitations on rights (e.g., restrictions on free speech for libel).<br>
                 <input type="radio" name="q49" value="B"> B) The temporary suspension of certain rights during a state of emergency.<br>
                 <input type="radio" name="q49" value="C"> C) The permanent abolition of human rights.<br>
                 <input type="radio" name="q49" value="D"> D) Granting additional rights to certain groups.
             </div>
             <div class="form-group">
                 <label>50. Non-derogable rights are those that:</label>
                 <input type="radio" name="q50" value="A" required> A) Can be suspended under any circumstances.<br>
                 <input type="radio" name="q50" value="B"> B) Are considered fundamental and cannot be suspended even during emergencies (e.g., freedom from torture).<br>
                 <input type="radio" name="q50" value="C"> C) Apply only during peacetime.<br>
                 <input type="radio" name="q50" value="D"> D) Are protected only by international law, not domestic law.
             </div>

            <button type="button" onclick="showReview()">Submit</button>
        </form>
        <div id="error-message" class="hidden">
            <p>Something went wrong. Please try again.</p>
        </div>
    </div>

    <div id="review-section" class="hidden">
        <h2>Review Your Answers</h2>
        <div id="review-content"></div>
        <button onclick="editForm()">Edit</button>
        <button onclick="downloadResponse()" id="download-response">Download My Response</button>
        <button onclick="confirmSubmission()">Confirm Submission</button>
    </div>

    <div id="submission-copy" class="hidden">
        <h2>Your Submitted Answers</h2>
        <div id="submission-content"></div>
        <button onclick="proceedToPassword()">Proceed</button>
    </div>

    <div id="password-section" class="hidden">
        <h1 id="success-message">Your response has been submitted</h1>
        <p>You can view your result (score) by entering the password.</p>
        <input type="password" id="password" placeholder="Enter password">
        <button onclick="checkPassword()">Submit</button>
        <p id="password-error" class="hidden">Incorrect password. Please try again.</p>
    </div>

    <div id="results" class="hidden">
        <h1>Quiz Results</h1>
        <p id="student-info"></p>
        <div id="answers"></div>
        <p id="score"></p>
        <button id="download-pdf" onclick="downloadPDF()">Download Results PDF</button>
    </div>

        <script>
        let quizData = null;
        let formData = null;
        const { jsPDF } = window.jspdf;
        const TOTAL_QUESTIONS = 50; // Total number of questions (Matches the form)

        // *** ADD/UPDATE THIS LINE - SET CHAPTER TO 5 ***
        // Define the chapter number for THIS specific quiz file (Chapter 5)
        const CURRENT_QUIZ_CHAPTER = 5;

        // *** ADD THIS LINE ***
        // Define the course code
        const COURSE_CODE = 'MCIE1012';


        // Valid login credentials (Remains the same)
        const validCredentials = [
            { username: 'section19', password: '123' },
            { username: 'section20', password: '123' },
            { username: 'muzemuza', password: 'moh' },
            { username: 'section21', password: '123' }
            // Add more valid credentials as needed
        ];

        // **** Chapter 5 Questions (As provided in your HTML) ****
        const allQuestionsData = {
             q1: { text: 'In a political sense, a constitution primarily signifies:', choices: { A: "The physical health of the nation's leader.", B: "The founding document or body of rules for a state's government.", C: 'The membership list of a political party.', D: 'The bylaws of a trade union.' } },
             q2: { text: "A constitution is often described as the 'mother of all laws' because:", choices: { A: 'It is the longest legal document.', B: 'All other ordinary laws derive from and must conform to it.', C: 'It deals primarily with family law.', D: "It was written by the 'founding fathers'." } },
             q3: { text: "The feature of 'Generality' distinguishes constitutions from other laws in that constitutions:", choices: { A: 'Provide highly detailed rules for specific situations.', B: 'Set out the general framework and fundamental principles of government.', C: 'Are only applicable to government officials.', D: 'Change frequently based on political whims.' } },
             q4: { text: "'Permanency' as a feature of constitutions suggests they are:", choices: { A: 'Meant to be temporary and easily changed.', B: 'Intended to be stable and lasting, not subject to frequent or easy alteration.', C: 'Only relevant during times of crisis.', D: 'Rewritten after every election.' } },
             q5: { text: "Constitutional 'Supremacy' means that:", choices: { A: 'The legislature can override the constitution at any time.', B: 'The constitution is the highest law, taking precedence over all other laws.', C: 'The executive branch is superior to the constitution.', D: 'International law always supersedes the constitution.' } },
             q6: { text: "A 'codified document' refers to a constitution that is:", choices: { A: 'Based entirely on unwritten customs.', B: 'Written down, often in a single, systematic document.', C: 'Secret and known only to rulers.', D: 'Composed of various historical traditions.' } },
             q7: { text: 'One of the major purposes of a constitution is to serve as a framework for government, meaning it:', choices: { A: 'Lists all citizens by name.', B: 'Details foreign policy objectives.', C: 'Organizes the operation and guides the powers of government branches.', D: 'Prescribes specific economic policies.' } },
             q8: { text: 'Constitutions limit the powers of government primarily to:', choices: { A: 'Make the government ineffective.', B: 'Protect the rights and freedoms of citizens from arbitrary rule.', C: 'Ensure the ruling party stays in power indefinitely.', D: 'Simplify the process of law-making.' } },
             q9: { text: 'The Preamble of a constitution, like that of the FDRE Constitution, typically serves to:', choices: { A: 'List specific criminal offences.', B: 'Outline the fundamental values, goals, and ideological basis of the state.', C: 'Detail the procedures for amending the constitution.', D: 'Name the members of the judiciary.' } },
             q10: { text: 'A written constitution is one where:', choices: { A: 'Fundamental principles are based only on tradition.', B: 'Provisions are embodied in a single formal document or instrument.', C: 'Rules can be changed easily by the government.', D: 'Courts have no power of interpretation.' } },
             q11: { text: 'An unwritten constitution, like that of the UK, primarily consists of:', choices: { A: 'A single, comprehensive document.', B: 'Customs, conventions, traditions, and some written laws bearing constitutional weight.', C: 'Rules dictated by the monarch alone.', D: 'Laws imposed by international bodies.' } },
             q12: { text: 'A merit of a written constitution is that it:', choices: { A: 'Is highly flexible and adapts instantly to change.', B: 'Creates ambiguity and confusion.', C: 'Is easily accessible to citizens, providing clarity and definiteness.', D: 'Prevents judicial interpretation.' } },
             q13: { text: 'A demerit of an unwritten constitution can be that it:', choices: { A: 'Is too rigid and difficult to change.', B: 'Is not easily accessible or clear to the public, potentially leading to confusion.', C: 'Prevents gradual adaptation.', D: 'Is unsuitable for monarchical systems.' } },
             q14: { text: "A 'rigid' constitution is one that:", choices: { A: 'Can be amended through the ordinary legislative process.', B: 'Requires a special, more difficult procedure for amendment.', C: 'Is unwritten.', D: 'Has no provision for amendment.' } },
             q15: { text: "A 'flexible' constitution allows for amendment through:", choices: { A: 'Only a national referendum.', B: 'A complex process involving multiple government branches.', C: 'The same process used for enacting ordinary laws, often by a simple majority.', D: 'Judicial review only.' } },
             q16: { text: "An 'effective' constitution is one where:", choices: { A: 'The text accurately describes government limits, but these are ignored in practice.', B: 'Government practices largely correspond to the provisions of the constitution.', C: 'The constitution exists only on paper with no real power.', D: 'The amendment process is impossible.' } },
             q17: { text: "A 'nominal' constitution exists when:", choices: { A: 'The constitution fully controls government behavior.', B: 'The text describes limits and principles, but these are largely ignored in practice.', C: 'There is no written constitutional document.', D: 'The government strictly adheres to the rule of law.' } },
             q18: { text: 'A federal constitution is characterized by:', choices: { A: 'Concentration of all power in the central government.', B: 'Distribution of power between central (federal) and regional/state governments.', C: 'The absence of a judicial branch.', D: 'An unwritten format.' } },
             q19: { text: 'A unitary constitution features:', choices: { A: 'Power divided between national and local units by the constitution.', B: 'Concentration of state power primarily in the hands of the central government.', C: 'Co-equal status between central and regional governments.', D: 'A requirement for all laws to be approved by regional bodies.' } },
             q20: { text: 'Constitutionalism refers to the doctrine or belief that:', choices: { A: 'Governments should have unlimited power.', B: 'Governments should be limited by law and accountable under a constitution.', C: 'Constitutions are merely symbolic documents.', D: 'Rulers are above the law.' } },
             q21: { text: "Prior to 1931, Ethiopia's constitutional experience was characterized by:", choices: { A: 'A series of modern, written constitutions.', B: 'An unwritten form, based on traditional documents and practices.', C: 'The complete absence of any form of legal or traditional constraints on rulers.', D: 'A system imposed by foreign powers.' } },
             q22: { text: 'The Fetha Negest (Law of the Kings) served historically in Ethiopia as a:', choices: { A: 'Modern democratic constitution.', B: 'Religious and secular legal compilation influencing law and governance.', C: 'Declaration of independence.', D: 'Trade agreement.' } },
             q23: { text: 'The Kibre Negest (Glory of Kings) is primarily significant for:', choices: { A: 'Establishing detailed administrative procedures.', B: 'Documenting the mythical origins and legitimizing the Solomonic dynasty.', C: 'Outlining modern human rights principles.', D: "Serving as Ethiopia's first written penal code." } },
             q24: { text: "Ethiopia's first written constitution was promulgated in:", choices: { A: '1889', B: '1931', C: '1955', D: '1987' } },
             q25: { text: 'The 1931 Constitution of Ethiopia primarily served to:', choices: { A: 'Establish a federal democratic republic.', B: 'Limit the powers of the nobility.', C: "Centralize state power and legitimize the Emperor's authority.", D: 'Grant universal suffrage.' } },
             q26: { text: 'The 1955 Revised Constitution of Ethiopia, compared to the 1931 version:', choices: { A: "Significantly reduced the Emperor's powers.", B: 'Introduced federalism.', C: 'Continued to reinforce centralization but included more detailed rights provisions (though largely symbolic).', D: 'Abolished the monarchy.' } },
             q27: { text: 'The 1987 Constitution established the:', choices: { A: 'Imperial Ethiopian Government.', B: 'Transitional Government of Ethiopia.', C: "People's Democratic Republic of Ethiopia (PDRE).", D: 'Federal Democratic Republic of Ethiopia (FDRE).' } },
             q28: { text: 'A key feature of the 1987 PDRE Constitution was its:', choices: { A: 'Embrace of multi-party democracy.', B: 'Aim to establish a state based on Marxist-Leninist principles and a one-party system.', C: 'Restoration of the monarchy.', D: 'Strong emphasis on regional autonomy.' } },
             q29: { text: 'The current 1995 FDRE Constitution established:', choices: { A: 'A unitary state.', B: 'A constitutional monarchy.', C: 'An ethnic-based federal system and a parliamentary republic.', D: 'A presidential system with unlimited executive power.' } },
             q30: { text: 'Democracy, derived from Greek, literally means:', choices: { A: 'Rule by the wealthy.', B: 'Rule by the military.', C: 'Rule by the people.', D: 'Rule by the aristocracy.' } },
             q31: { text: 'Direct democracy involves citizens:', choices: { A: 'Electing representatives to make decisions for them.', B: 'Participating directly in making laws and policy decisions.', C: 'Obeying the commands of a single ruler.', D: 'Having no say in government affairs.' } },
             q32: { text: 'Indirect or representative democracy involves citizens:', choices: { A: 'Voting on every law themselves.', B: 'Electing officials to govern on their behalf.', C: 'Following rules set by traditional elders.', D: 'Living under military rule.' } },
             q33: { text: 'According to Robert Dahl, a minimal condition for modern democracy includes:', choices: { A: 'State control of the media.', B: 'Elected officials chosen in frequent and fair elections.', C: 'A single-party political system.', D: 'Suppression of alternative sources of information.' } },
             q34: { text: "The core value of 'Liberty' in democracy emphasizes:", choices: { A: 'Government control over personal choices.', B: 'Personal and political freedoms, such as freedom from arbitrary arrest and freedom of expression.', C: 'The duty to obey all government orders without question.', D: 'Economic equality above all else.' } },
             q35: { text: "'Equality' as a democratic principle includes political equality, meaning:", choices: { A: 'Equal distribution of wealth.', B: 'All citizens having equal standing and rights in the political process (e.g., one person, one vote).', C: 'Social hierarchies based on birth.', D: 'Different voting rights based on education level.' } },
             q36: { text: 'Popular Sovereignty implies that:', choices: { A: 'The government is the ultimate source of authority.', B: 'The ultimate source of political authority resides in the people.', C: 'Foreign powers dictate government policy.', D: 'Military leaders hold supreme power.' } },
             q37: { text: 'Constitutional Supremacy as a democratic principle means:', choices: { A: 'The constitution can be ignored by the government.', B: 'The constitution is the highest law, binding on everyone, including the government.', C: 'Laws are made by judges, not the legislature.', D: 'The executive branch holds supreme power.' } },
             q38: { text: "The 'Rule of Law' requires that:", choices: { A: 'Rulers are above the law.', B: 'Society is governed by laws that apply equally to everyone, including the government.', C: 'Laws can be applied arbitrarily.', D: 'Only the wealthy are subject to legal processes.' } },
             q39: { text: 'Secularism in a democratic context generally implies:', choices: { A: 'The establishment of an official state religion.', B: 'Separation of state institutions and religious institutions.', C: 'Suppression of all religious practice.', D: 'Government funding for religious education only.' } },
             q40: { text: "The principle of 'Separation of Powers' aims to:", choices: { A: 'Concentrate all government power in one branch.', B: 'Divide government powers among different branches (legislative, executive, judicial) to prevent tyranny.', C: 'Eliminate the judicial branch.', D: 'Make government decision-making faster.' } },
             q41: { text: 'Democratization refers to the:', choices: { A: 'Process of transition from authoritarian rule towards a democratic regime.', B: 'Consolidation of power by a single leader.', C: 'Abandonment of elections.', D: 'Establishment of a state-controlled economy.' } },
             q42: { text: 'Key actors in democratization often include:', choices: { A: 'Only the military.', B: 'Only international organizations.', C: 'Political parties, media, and civil society organizations.', D: 'Only the incumbent authoritarian rulers.' } },
             q43: { text: 'Human rights are generally understood as:', choices: { A: 'Privileges granted by governments that can be easily revoked.', B: 'Basic entitlements belonging to all individuals simply because they are human.', C: 'Rights applicable only to citizens of wealthy nations.', D: 'Obligations imposed on citizens by the state.' } },
             q44: { text: "The principle of 'Universality' of human rights means they:", choices: { A: 'Apply only in certain countries.', B: 'Belong equally to everyone, everywhere, regardless of status or location.', C: 'Differ based on religious beliefs.', D: 'Are determined by economic status.' } },
             q45: { text: "The 'Indivisibility' and 'Interdependence' of human rights imply that:", choices: { A: 'Civil and political rights are more important than economic and social rights.', B: 'Different categories of rights (civil, political, economic, social, cultural) are interconnected and equally important.', C: 'Rights can be enjoyed selectively.', D: 'Governments can choose which rights to respect.' } },
             q46: { text: 'Civil and Political Rights (First Generation Rights) typically include:', choices: { A: 'Right to education, right to health care.', B: 'Right to life, freedom from torture, freedom of speech, right to vote.', C: 'Right to development, right to a clean environment.', D: 'Right to form trade unions, right to social security.' } },
             q47: { text: 'Social, Economic, and Cultural Rights (Second Generation Rights) often include:', choices: { A: 'Freedom of assembly, freedom of religion.', B: 'Right to due process, right to a fair trial.', C: 'Right to work, right to education, right to health, right to social security.', D: 'Right to self-determination, right to peace.' } },
             q48: { text: 'Solidarity or Group Rights (Third Generation Rights) focus on collective rights such as:', choices: { A: 'Right to property, freedom of contract.', B: 'Right to development, right to peace, right to a clean environment.', C: 'Freedom from arbitrary arrest, right to privacy.', D: 'Right to vote, freedom of expression.' } },
             q49: { text: 'Derogation of human rights refers to:', choices: { A: 'The normal, everyday limitations on rights (e.g., restrictions on free speech for libel).', B: 'The temporary suspension of certain rights during a state of emergency.', C: 'The permanent abolition of human rights.', D: 'Granting additional rights to certain groups.' } },
             q50: { text: 'Non-derogable rights are those that:', choices: { A: 'Can be suspended under any circumstances.', B: 'Are considered fundamental and cannot be suspended even during emergencies (e.g., freedom from torture).', C: 'Apply only during peacetime.', D: 'Are protected only by international law, not domestic law.' } }
        };


        // **** Correct answers mapped to letters (Chapter 5 - Matches the HTML form answers) ****
        const correctAnswersMap = {
             q1: 'B',  q2: 'B',  q3: 'B',  q4: 'B',  q5: 'B',
             q6: 'B',  q7: 'C',  q8: 'B',  q9: 'B',  q10: 'B',
             q11: 'B', q12: 'C', q13: 'B', q14: 'B', q15: 'C',
             q16: 'B', q17: 'B', q18: 'B', q19: 'B', q20: 'B',
             q21: 'B', q22: 'B', q23: 'B', q24: 'B', q25: 'C',
             q26: 'C', q27: 'C', q28: 'B', q29: 'C', q30: 'C',
             q31: 'B', q32: 'B', q33: 'B', q34: 'B', q35: 'B',
             q36: 'B', q37: 'B', q38: 'C', q39: 'B', q40: 'B',
             q41: 'A', q42: 'C', q43: 'B', q44: 'B', q45: 'B',
             q46: 'B', q47: 'C', q48: 'B', q49: 'B', q50: 'B'
        };


        // --- Functions below modified to include chapter and formatted string ---

        function checkLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            const errorMessage = document.getElementById('login-error');
            const loginSection = document.getElementById('login-section');
            const quizForm = document.getElementById('quiz-form');

            const isValid = validCredentials.some(cred =>
                cred.username === username && cred.password === password
            );

            if (isValid) {
                errorMessage.classList.add('hidden');
                loginSection.classList.add('hidden');
                quizForm.classList.remove('hidden');
            } else {
                errorMessage.classList.remove('hidden');
            }
        }

        function showReview() {
            const form = document.getElementById('mcie-quiz');
            formData = new FormData(form);
            const data = Object.fromEntries(formData);

             // Check if all questions are answered
             let allAnswered = true;
             for (let i = 1; i <= TOTAL_QUESTIONS; i++) { // Loop uses TOTAL_QUESTIONS
                 if (!data[`q${i}`]) {
                     allAnswered = false;
                     break;
                 }
             }

             if (!data.name || !data.id_number || !data.section || !data.email || !data.phone || !allAnswered) {
                 alert('Please fill in all personal information and answer all questions before submitting.');
                 return; // Stop the function if validation fails
             }

            // Store quiz data temporarily
            quizData = {
                name: data.name,
                id_number: data.id_number,
                section: data.section,
                email: data.email,
                phone: data.phone,
                answers: {},
                questions: allQuestionsData, // Use the updated structure
                chapter: CURRENT_QUIZ_CHAPTER, // Added chapter to quizData
                courseCode: COURSE_CODE // Added course code to quizData
            };

            // Construct the formatted chapter string for display
             const formattedCourseChapter = `${quizData.courseCode} Chapter ${quizData.chapter}`;


            // Populate answers dynamically
            let reviewHTML = `
                <p><strong>Name:</strong> ${data.name}</p>
                <p><strong>ID Number:</strong> ${data.id_number}</p>
                <p><strong>Section:</strong> ${data.section}</p>
                <p><strong>Email:</strong> ${data.email}</p>
                <p><strong>Phone Number:</strong> ${data.phone}</p>
                 <p><strong>Chapter:</strong> ${quizData.chapter}</p>
                 <p><strong>Course & Chapter:</strong> ${formattedCourseChapter}</p> <!-- Added formatted chapter to review display -->
                <hr>
                <h3>Your Answers:</h3>
            `;

            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                const qKey = `q${i}`;
                const userAnswer = data[qKey];
                quizData.answers[qKey] = userAnswer; // Store answer
                const questionInfo = allQuestionsData[qKey];
                const answerText = questionInfo.choices[userAnswer] || 'Not Answered';
                reviewHTML += `<p><strong>Question ${i}:</strong> ${questionInfo.text}<br>Your answer: ${userAnswer}) ${answerText}</p>`;
            }

            // Display review content
            const reviewContent = document.getElementById('review-content');
            reviewContent.innerHTML = reviewHTML;

            // Show review section
            document.getElementById('quiz-form').classList.add('hidden');
            document.getElementById('review-section').classList.remove('hidden');
        }

        function editForm() {
            document.getElementById('review-section').classList.add('hidden');
            document.getElementById('quiz-form').classList.remove('hidden');
        }

        function downloadResponse() {
            if (!quizData) return;

            const doc = new jsPDF();
            let y = 10;
            const pageHeight = doc.internal.pageSize.height;
            const pageWidth = doc.internal.pageSize.width;
            const margin = 10;
            const effectiveWidth = pageWidth - margin * 2;

             const formattedCourseChapter = `${quizData.courseCode} Chapter ${quizData.chapter}`;


            doc.setFontSize(16);
            doc.text(`${formattedCourseChapter} Quiz Response`, pageWidth / 2, y, { align: 'center' }); // Updated Title
            y += 10;

            doc.setFontSize(12);
            doc.text(`Name: ${quizData.name}`, margin, y); y += 7;
            doc.text(`ID: ${quizData.id_number}`, margin, y); y += 7;
            doc.text(`Section: ${quizData.section}`, margin, y); y += 7;
            doc.text(`Email: ${quizData.email}`, margin, y); y += 7;
            doc.text(`Phone: ${quizData.phone}`, margin, y); y += 7;
            doc.text(`Chapter: ${quizData.chapter}`, margin, y); y += 7;
            doc.text(`Course & Chapter: ${formattedCourseChapter}`, margin, y); y += 10;


            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const question = quizData.questions[qKey];
                 const userAnswer = quizData.answers[qKey];
                 const answerText = question.choices[userAnswer] || 'Not Answered';
                 const questionText = question.text;

                 // Estimate space needed for the question + answer
                 const questionLines = doc.splitTextToSize(`Question ${i}: ${questionText}`, effectiveWidth);
                 const answerLines = doc.splitTextToSize(`Your answer: ${userAnswer}) ${answerText}`, effectiveWidth);
                 const spaceNeeded = (questionLines.length * 5) + 2 + (answerLines.length * 5) + 5;

                 if (y + spaceNeeded > pageHeight - margin) {
                    doc.addPage();
                    y = margin;
                 }

                doc.setFont('helvetica', 'bold');
                doc.text(questionLines, margin, y);
                y += (questionLines.length * 5) + 2;
                doc.setFont('helvetica', 'normal');

                if (y > pageHeight - margin) { doc.addPage(); y = margin; }

                doc.text(answerLines, margin, y);
                y += (answerLines.length * 5) + 5;

            }

            // Updated filename
            doc.save(`${formattedCourseChapter.replace(/ /g, '_')}_response_${quizData.id_number}.pdf`);
        }

        // --- MODIFIED: confirmSubmission Function ---
        async function confirmSubmission() {
            if (confirm('Are you sure you want to submit your answers?')) {
                if (!quizData || !formData) {
                     console.error("Quiz data or form data is missing.");
                     alert("Error: Cannot submit. Please try filling the form again.");
                     editForm(); // Go back to edit
                     return;
                }

                const data = Object.fromEntries(formData);

                // Calculate score
                let score = 0;
                for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                    const qKey = `q${i}`;
                    if (data[qKey] === correctAnswersMap[qKey]) {
                        score++;
                    }
                }

                // Update quizData with score (Optional but good practice)
                quizData.score = score;

                // *** CONSTRUCT THE FORMATTED CHAPTER STRING ***
                const formattedCourseChapter = `${COURSE_CODE} Chapter ${CURRENT_QUIZ_CHAPTER}`;


                // Prepare data for YOUR backend
                const submissionData = {
                    name: data.name,
                    id_number: data.id_number,
                    section: data.section,
                    email: data.email,
                    phone: data.phone,
                    score: score,
                    totalQuestions: TOTAL_QUESTIONS,
                    quizChapter: CURRENT_QUIZ_CHAPTER, // Keep the integer
                    // quizTitle: "Constitution, Democracy & Human Rights Quiz - Chapter 5", // You can keep or remove this
                    // submittedAt: new Date().toISOString(),
                    // answers: quizData.answers // You can add this if your backend table had a jsonb column for answers

                    // *** ADD THE NEW FIELD WITH THE FORMATTED STRING ***
                    course_chapter_formatted: formattedCourseChapter,
                };

                console.log("Submitting quiz data:", submissionData);

                try {
                    // Show "Submitting..." message or spinner here if desired

                    const response = await fetch('/submit-quiz', { // Point to your backend endpoint
                        method: 'POST',
                        body: JSON.stringify(submissionData), // Send the data as JSON
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json' // Important Header!
                        }
                    });

                    if (response.ok) {
                        const result = await response.json();
                        console.log('Submission successful:', result);
                        alert("Quiz submitted successfully!"); // Provide feedback to user

                        // Show submission copy
                        const submissionContent = document.getElementById('submission-content');
                         let submissionHTML = `
                            <p><strong>Name:</strong> ${quizData.name}</p>
                            <p><strong>ID Number:</strong> ${quizData.id_number}</p>
                            <p><strong>Section:</strong> ${quizData.section}</p>
                            <p><strong>Email:</strong> ${quizData.email}</p>
                            <p><strong>Phone Number:</strong> ${quizData.phone}</p>
                            <p><strong>Chapter:</strong> ${quizData.chapter}</p>
                             <p><strong>Course & Chapter:</strong> ${formattedCourseChapter}</p> <!-- Added formatted chapter to submission copy -->
                            <hr>
                            <h3>Submitted Answers:</h3>
                        `;
                         for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                             const qKey = `q${i}`;
                             const questionInfo = quizData.questions[qKey];
                             const userAnswer = quizData.answers[qKey];
                             const answerText = questionInfo.choices[userAnswer] || 'Not Answered';
                             submissionHTML += `<p><strong>Question ${i}:</strong> ${questionInfo.text}<br>Your answer: ${userAnswer}) ${answerText}</p>`;
                         }
                        submissionContent.innerHTML = submissionHTML;

                        document.getElementById('review-section').classList.add('hidden');
                        document.getElementById('submission-copy').classList.remove('hidden');


                    } else {
                        let errorMsg = `Submission failed with status: ${response.status}`;
                        try {
                            const errorData = await response.json();
                            errorMsg = errorData.error || errorData.message || errorMsg;
                        } catch(e) { /* Ignore if response isn't JSON */ }

                        console.error('Backend submission error:', errorMsg);
                        document.getElementById('error-message').innerHTML = `<p>Submission failed: ${errorMsg}. Please try again.</p>`;
                        document.getElementById('error-message').classList.remove('hidden');
                        document.getElementById('review-section').classList.add('hidden');
                    }
                } catch (error) {
                    console.error('Network/Fetch error:', error);
                    document.getElementById('error-message').innerHTML = `<p>An network error occurred during submission. Please check your connection and try again.</p>`;
                    document.getElementById('error-message').classList.remove('hidden');
                    document.getElementById('review-section').classList.add('hidden');
                }
            }
        }


        function proceedToPassword() {
            document.getElementById('submission-copy').classList.add('hidden');
            document.getElementById('password-section').classList.remove('hidden');
        }

        function checkPassword() {
            const passwordInput = document.getElementById('password').value;
            const correctPassword = 'password'; // Keep the simple password
            const errorMessage = document.getElementById('password-error');
            const passwordSection = document.getElementById('password-section');
            const results = document.getElementById('results');

            if (passwordInput === correctPassword) {
                errorMessage.classList.add('hidden');
                passwordSection.classList.add('hidden');
                results.classList.remove('hidden');
                displayResults();
            } else {
                errorMessage.classList.remove('hidden');
            }
        }

        function displayResults() {
            if (!quizData) {
                document.getElementById('results').innerHTML = '<p>Error: No quiz data found. Please complete the quiz first.</p>';
                return;
            }

             // Combine correct answer letter with full text for display
             const displayCorrectAnswers = {};
             for(let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const correctLetter = correctAnswersMap[qKey];
                 const correctText = allQuestionsData[qKey].choices[correctLetter];
                 displayCorrectAnswers[qKey] = `${correctLetter}) ${correctText}`;
             }

            const formattedCourseChapter = `${quizData.courseCode} Chapter ${quizData.chapter}`;

            // Added formatted chapter to results display
            document.getElementById('student-info').innerHTML = `<strong>Name:</strong> ${quizData.name}<br><strong>ID:</strong> ${quizData.id_number}<br><strong>Section:</strong> ${quizData.section}<br><strong>Email:</strong> ${quizData.email}<br><strong>Phone:</strong> ${quizData.phone}<br><strong>Chapter:</strong> ${quizData.chapter}<br><strong>Course & Chapter:</strong> ${formattedCourseChapter}`;


            const answersDiv = document.getElementById('answers');
            let answersHTML = '<h3>Detailed Results:</h3>';

            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const question = quizData.questions[qKey];
                 const userAnswer = quizData.answers[qKey];
                 const userAnswerText = question.choices[userAnswer] || 'Not Answered';
                 const isCorrect = userAnswer === correctAnswersMap[qKey];

                 answersHTML += `
                    <div class="question-result">
                        <p><strong>Question ${i}:</strong> ${question.text}</p>
                        <div class="choices" style="font-size:0.9em; margin-left: 15px;">
                            <p>A) ${question.choices.A}</p>
                            <p>B) ${question.choices.B}</p>
                            <p>C) ${question.choices.C}</p>
                            <p>D) ${question.choices.D}</p>
                        </div>
                        <p>Your answer: ${userAnswer}) ${userAnswerText} ${isCorrect ? '<span style="color:green; font-weight:bold;">(Correct)</span>' : '<span style="color:red; font-weight:bold;">(Incorrect)</span>'}</p>
                        ${!isCorrect ? `<p style="color:blue;">Correct answer: ${displayCorrectAnswers[qKey]}</p>` : ''}
                    </div>
                `;
            }
            answersDiv.innerHTML = answersHTML;


            document.getElementById('score').textContent = `Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`;
        }

        function downloadPDF() {
            if (!quizData) return;

            const doc = new jsPDF();
            let y = 10;
            const pageHeight = doc.internal.pageSize.height;
            const pageWidth = doc.internal.pageSize.width;
            const margin = 10;
            const effectiveWidth = pageWidth - margin * 2;

             // Combine correct answer letter with full text for display
             const displayCorrectAnswers = {};
             for(let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const correctLetter = correctAnswersMap[qKey];
                 const correctText = allQuestionsData[qKey].choices[correctLetter];
                 displayCorrectAnswers[qKey] = `${correctLetter}) ${correctText}`;
             }

            const formattedCourseChapter = `${quizData.courseCode} Chapter ${quizData.chapter}`;

            doc.setFontSize(16);
            doc.text(`${formattedCourseChapter} Quiz Results`, pageWidth / 2, y, { align: 'center' });
            y += 10;

            doc.setFontSize(12);
            doc.text(`Name: ${quizData.name}`, margin, y); y += 7;
            doc.text(`ID: ${quizData.id_number}`, margin, y); y += 7;
            doc.text(`Section: ${quizData.section}`, margin, y); y += 7;
            doc.text(`Email: ${quizData.email}`, margin, y); y += 7;
            doc.text(`Phone: ${quizData.phone}`, margin, y); y += 7;
             // Added formatted chapter to PDF
            doc.text(`Course & Chapter: ${formattedCourseChapter}`, margin, y); y += 10;


            doc.setFont('helvetica', 'bold');
            doc.text(`Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`, pageWidth / 2, y, { align: 'center' });
            y += 10;
            doc.setFont('helvetica', 'normal');


            for (let i = 1; i <= TOTAL_QUESTIONS; i++) {
                 const qKey = `q${i}`;
                 const question = quizData.questions[qKey];
                 const userAnswer = quizData.answers[qKey];
                 const userAnswerText = question.choices[userAnswer] || 'Not Answered';
                 const isCorrect = userAnswer === correctAnswersMap[qKey];
                 const questionText = question.text;
                 const correctAnswerFull = displayCorrectAnswers[qKey];

                 // Estimate space needed
                 const qLines = doc.splitTextToSize(`Question ${i}: ${questionText}`, effectiveWidth);
                 const choicesLines = 4 * 5; // Estimate for 4 choices at 5 units per line height
                 const yourAnsLines = doc.splitTextToSize(`Your answer: ${userAnswer}) ${userAnswerText} ${isCorrect ? '(Correct)' : '(Incorrect)'}`, effectiveWidth);
                 const correctAnsLinesHeight = isCorrect ? 0 : doc.splitTextToSize(`Correct answer: ${correctAnswerFull}`, effectiveWidth).length * 5; // Height needed for correct answer if wrong
                 const spaceNeeded = (qLines.length * 5) + 2 + choicesLines + 7 + (yourAnsLines.length * 5) + 7 + correctAnsLinesHeight + 5;


                 if (y + spaceNeeded > pageHeight - margin) {
                    doc.addPage();
                    y = margin;
                }

                doc.setFont('helvetica', 'bold');
                doc.text(qLines, margin, y);
                y += (qLines.length * 5) + 2;
                doc.setFont('helvetica', 'normal');

                 const remainingSpaceAfterQuestion = pageHeight - margin - y;
                 const answersSectionSpace = choicesLines + 7 + (yourAnsLines.length * 5) + 7 + correctAnsLinesHeight + 5;

                 if (answersSectionSpace > remainingSpaceAfterQuestion) {
                     doc.addPage();
                     y = margin;
                 }


                doc.setFontSize(10);
                doc.text(`  A) ${question.choices.A}`, margin + 5, y); y += 5;
                doc.text(`  B) ${question.choices.B}`, margin + 5, y); y += 5;
                doc.text(`  C) ${question.choices.C}`, margin + 5, y); y += 5;
                doc.text(`  D) ${question.choices.D}`, margin + 5, y); y += 7;
                doc.setFontSize(12);


                doc.text(`Your answer: ${userAnswer}) ${userAnswerText} ${isCorrect ? '(Correct)' : '(Incorrect)'}`, margin, y); y += 7;

                if (!isCorrect) {
                    doc.setTextColor(0, 0, 255);
                    doc.text(`Correct answer: ${correctAnswerFull}`, margin, y); y += 7;
                    doc.setTextColor(0, 0, 0);
                }
                y += 5;

            }

            if (y > pageHeight - margin) { doc.addPage(); y = margin; }
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(14);
            doc.text(`Final Score: ${quizData.score} / ${TOTAL_QUESTIONS}`, pageWidth / 2, y, { align: 'center' });

            // Updated filename to include formatted chapter
            doc.save(`${formattedCourseChapter.replace(/ /g, '_')}_results_${quizData.id_number}.pdf`);
        }
    </script>
</body>
</html>
